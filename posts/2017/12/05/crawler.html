<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基于nodejs的爬虫 | Glitz&#39;s Blog</title>
    <meta name="description" content="This is my blog">
    
    
    <link rel="preload" href="/assets/css/0.styles.4982967a.css" as="style"><link rel="preload" href="/assets/js/app.b63f6ec7.js" as="script"><link rel="preload" href="/assets/js/3.d8673601.js" as="script"><link rel="preload" href="/assets/js/34.c3692ebc.js" as="script"><link rel="prefetch" href="/assets/js/1.a5527113.js"><link rel="prefetch" href="/assets/js/10.d0ee39c4.js"><link rel="prefetch" href="/assets/js/100.3525aa51.js"><link rel="prefetch" href="/assets/js/101.38d1dfbe.js"><link rel="prefetch" href="/assets/js/102.20a46dd4.js"><link rel="prefetch" href="/assets/js/11.d8afe31e.js"><link rel="prefetch" href="/assets/js/12.049b70fe.js"><link rel="prefetch" href="/assets/js/13.3322b3a4.js"><link rel="prefetch" href="/assets/js/14.4e29c37a.js"><link rel="prefetch" href="/assets/js/15.0a57d50a.js"><link rel="prefetch" href="/assets/js/16.16f66172.js"><link rel="prefetch" href="/assets/js/17.67f1acd8.js"><link rel="prefetch" href="/assets/js/18.74ece50d.js"><link rel="prefetch" href="/assets/js/19.1dc88663.js"><link rel="prefetch" href="/assets/js/20.9db2f345.js"><link rel="prefetch" href="/assets/js/21.2903a079.js"><link rel="prefetch" href="/assets/js/22.116181fd.js"><link rel="prefetch" href="/assets/js/23.97ae5156.js"><link rel="prefetch" href="/assets/js/24.3d779783.js"><link rel="prefetch" href="/assets/js/25.84f73c43.js"><link rel="prefetch" href="/assets/js/26.5add2dd6.js"><link rel="prefetch" href="/assets/js/27.b867c20d.js"><link rel="prefetch" href="/assets/js/28.ba416de3.js"><link rel="prefetch" href="/assets/js/29.2b4ae3c3.js"><link rel="prefetch" href="/assets/js/30.9b2ff65b.js"><link rel="prefetch" href="/assets/js/31.6f11978e.js"><link rel="prefetch" href="/assets/js/32.d6b8f9be.js"><link rel="prefetch" href="/assets/js/33.35bc56bd.js"><link rel="prefetch" href="/assets/js/35.6d9cee92.js"><link rel="prefetch" href="/assets/js/36.4b382477.js"><link rel="prefetch" href="/assets/js/37.33301b59.js"><link rel="prefetch" href="/assets/js/38.bffdb375.js"><link rel="prefetch" href="/assets/js/39.47f57e0e.js"><link rel="prefetch" href="/assets/js/4.c25d0b2f.js"><link rel="prefetch" href="/assets/js/40.0aa0acd3.js"><link rel="prefetch" href="/assets/js/41.ee8d1b66.js"><link rel="prefetch" href="/assets/js/42.b3de87d5.js"><link rel="prefetch" href="/assets/js/43.0c3310af.js"><link rel="prefetch" href="/assets/js/44.3490ea0d.js"><link rel="prefetch" href="/assets/js/45.dcf1ba56.js"><link rel="prefetch" href="/assets/js/46.40a0c708.js"><link rel="prefetch" href="/assets/js/47.7f7aa579.js"><link rel="prefetch" href="/assets/js/48.a3e1ca48.js"><link rel="prefetch" href="/assets/js/49.34e4b107.js"><link rel="prefetch" href="/assets/js/5.b608309a.js"><link rel="prefetch" href="/assets/js/50.95460f78.js"><link rel="prefetch" href="/assets/js/51.bdec4f45.js"><link rel="prefetch" href="/assets/js/52.0b3185ca.js"><link rel="prefetch" href="/assets/js/53.5392e2ea.js"><link rel="prefetch" href="/assets/js/54.128621ed.js"><link rel="prefetch" href="/assets/js/55.89c87795.js"><link rel="prefetch" href="/assets/js/56.8dfafe25.js"><link rel="prefetch" href="/assets/js/57.35aff20b.js"><link rel="prefetch" href="/assets/js/58.6094f519.js"><link rel="prefetch" href="/assets/js/59.d1442988.js"><link rel="prefetch" href="/assets/js/6.85977037.js"><link rel="prefetch" href="/assets/js/60.8575a821.js"><link rel="prefetch" href="/assets/js/61.24a38c8f.js"><link rel="prefetch" href="/assets/js/62.e0dfefdd.js"><link rel="prefetch" href="/assets/js/63.9c212f60.js"><link rel="prefetch" href="/assets/js/64.2dba71da.js"><link rel="prefetch" href="/assets/js/65.54920520.js"><link rel="prefetch" href="/assets/js/66.db62a942.js"><link rel="prefetch" href="/assets/js/67.a82e42be.js"><link rel="prefetch" href="/assets/js/68.a0e598dd.js"><link rel="prefetch" href="/assets/js/69.e5816338.js"><link rel="prefetch" href="/assets/js/7.e7554be0.js"><link rel="prefetch" href="/assets/js/70.eded29f8.js"><link rel="prefetch" href="/assets/js/71.3ee98e40.js"><link rel="prefetch" href="/assets/js/72.80e70301.js"><link rel="prefetch" href="/assets/js/73.ea939c97.js"><link rel="prefetch" href="/assets/js/74.b24225fa.js"><link rel="prefetch" href="/assets/js/75.1ee70d9e.js"><link rel="prefetch" href="/assets/js/76.f7373d6b.js"><link rel="prefetch" href="/assets/js/77.8ee2a452.js"><link rel="prefetch" href="/assets/js/78.c21a34e1.js"><link rel="prefetch" href="/assets/js/79.d806572f.js"><link rel="prefetch" href="/assets/js/8.f59742e0.js"><link rel="prefetch" href="/assets/js/80.89dcb812.js"><link rel="prefetch" href="/assets/js/81.7aa99999.js"><link rel="prefetch" href="/assets/js/82.e58ea211.js"><link rel="prefetch" href="/assets/js/83.063c4eaa.js"><link rel="prefetch" href="/assets/js/84.c3684cda.js"><link rel="prefetch" href="/assets/js/85.226567f4.js"><link rel="prefetch" href="/assets/js/86.6dcf5e90.js"><link rel="prefetch" href="/assets/js/87.b63e7567.js"><link rel="prefetch" href="/assets/js/88.81eed979.js"><link rel="prefetch" href="/assets/js/89.8405d0f8.js"><link rel="prefetch" href="/assets/js/9.776206fe.js"><link rel="prefetch" href="/assets/js/90.b8a7edaf.js"><link rel="prefetch" href="/assets/js/91.e911840e.js"><link rel="prefetch" href="/assets/js/92.2561bf95.js"><link rel="prefetch" href="/assets/js/93.978b7123.js"><link rel="prefetch" href="/assets/js/94.b827b409.js"><link rel="prefetch" href="/assets/js/95.11efa766.js"><link rel="prefetch" href="/assets/js/96.9d7ac840.js"><link rel="prefetch" href="/assets/js/97.19b9aafb.js"><link rel="prefetch" href="/assets/js/98.0ec82928.js"><link rel="prefetch" href="/assets/js/99.a09c769d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4982967a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-glitzma"><header class="header" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(/assets/img/header-image-05.jpg);" data-v-e4a0ebe0><div data-v-fa5c5f88 data-v-e4a0ebe0><nav class="navbar" data-v-fa5c5f88><div class="container" data-v-fa5c5f88><a href="/" class="router-link-active" data-v-fa5c5f88><span class="navbar-site-name" data-v-fa5c5f88>
          Glitz's Blog
        </span></a> <div class="navbar-toggler" data-v-fa5c5f88><svg class="icon" style="font-size:1.2em;" data-v-fa5c5f88 data-v-fa5c5f88><title data-v-fa5c5f88 data-v-fa5c5f88>menu</title><use xlink:href="#icon-menu" data-v-fa5c5f88 data-v-fa5c5f88></use></svg></div> <div class="navbar-links" data-v-fa5c5f88><a href="/" class="navbar-link" data-v-fa5c5f88>
            欢迎页
          </a><a href="/posts/" class="navbar-link router-link-active" data-v-fa5c5f88>
            帖子
          </a><a href="/custom-pages/" class="navbar-link" data-v-fa5c5f88>
            关于我
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-fa5c5f88></div></div> <div class="banner" data-v-e2d7da12 data-v-e4a0ebe0 data-v-e4a0ebe0><div class="container" data-v-e2d7da12><div class="center" data-v-e2d7da12><h1 class="header-slot-h1" data-v-e2d7da12 data-v-e4a0ebe0>
          基于nodejs的爬虫
        </h1></div></div></div></header> <div class="container clearfix show-aside" data-v-0874e876 data-v-0874e876><main class="main" data-v-0874e876><div class="post" data-v-0874e876 data-v-0874e876><section class="post-meta main-div" data-v-7f7ca342><section class="post-date clearfix" data-v-7f7ca342><span class="create-date" data-v-7f7ca342>
      发布时间 : 2017-12-05
    </span> <span class="update-date" data-v-7f7ca342>
      最后修改 : 2019-04-24
    </span></section> <section class="post-links" data-v-7f7ca342><a href="/posts/2017/12/05/jquery-common-operation.html" class="post-link" data-v-7f7ca342>
      上一篇 : Common operation of jquery
    </a> <a href="/posts/2017/12/05/lashou-masterstation.html" class="post-link" data-v-7f7ca342>
      下一篇 : 曾经做过的东西,可能只是我的回忆...
    </a></section></section> <article class="main-div"><div class="post-content content__default"><h2 id="爬虫是什么？"><a href="#爬虫是什么？" aria-hidden="true" class="header-anchor">#</a> 爬虫是什么？</h2> <p>网络爬虫（又被称为网页蜘蛛，网络机器人，在FOAF社区中间，更经常的称为网页追逐者），是一种按照一定的规则，自动地抓取万维网信息的程序或者脚本</p> <h2 id="爬虫的分类"><a href="#爬虫的分类" aria-hidden="true" class="header-anchor">#</a> 爬虫的分类</h2> <p>网络爬虫按照系统结构和实现技术，大致可以分为以下几种类型：通用网络爬虫（General Purpose Web Crawler）、聚焦网络爬虫（Focused Web Crawler）、增量式网络爬虫（Incremental Web Crawler）、深层网络爬虫（Deep Web Crawler）。 实际的网络爬虫系统通常是几种爬虫技术相结合实现的</p> <h5 id="一、通用网络爬虫"><a href="#一、通用网络爬虫" aria-hidden="true" class="header-anchor">#</a> 一、通用网络爬虫</h5> <p>通用网络爬虫又称全网爬虫（Scalable Web Crawler），<em>爬行对象从一些种子 URL 扩充到整个 Web，主要为门户站点搜索引擎和大型 Web 服务提供商采集数据</em>。 由于商业原因，它们的技术细节很少公布出来。 这类网络爬虫的爬行范围和数量巨大，对于爬行速度和存储空间要求较高，对于爬行页面的顺序要求相对较低，同时由于待刷新的页面太多，通常采用并行工作方式，但需要较长时间才能刷新一次页面。 虽然存在一定缺陷，通用网络爬虫适用于为搜索引擎搜索广泛的主题，有较强的应用价值。
通用网络爬虫的结构大致可以分为页面爬行模块 、页面分析模块、链接过滤模块、页面数据库、URL 队列、初始 URL 集合几个部分。为提高工作效率，通用网络爬虫会采取一定的爬行策略。 常用的爬行策略有：深度优先策略、广度优先策略。</p> <blockquote><ol><li>深度优先策略：其基本方法是按照深度由低到高的顺序，依次访问下一级网页链接，直到不能再深入为止。 爬虫在完成一个爬行分支后返回到上一链接节点进一步搜索其它链接。 当所有链接遍历完后，爬行任务结束。 这种策略比较适合垂直搜索或站内搜索， 但爬行页面内容层次较深的站点时会造成资源的巨大浪费。</li> <li>广度优先策略：此策略按照网页内容目录层次深浅来爬行页面，处于较浅目录层次的页面首先被爬行。 当同一层次中的页面爬行完毕后，爬虫再深入下一层继续爬行。 这种策略能够有效控制页面的爬行深度，避免遇到一个无穷深层分支时无法结束爬行的问题，实现方便，无需存储大量中间节点，不足之处在于需较长时间才能爬行到目录层次较深的页面</li></ol></blockquote> <h5 id="二、聚焦网络爬虫"><a href="#二、聚焦网络爬虫" aria-hidden="true" class="header-anchor">#</a> 二、聚焦网络爬虫</h5> <p>聚焦网络爬虫（Focused Crawler），又称主题网络爬虫（Topical Crawler），是指<em>选择性地爬行那些与预先定义好的主题相关页面的网络爬虫</em>。 和通用网络爬虫相比，聚焦爬虫只需要爬行与主题相关的页面，极大地<em>节省了硬件和网络资源</em>，保存的页面也由于数量少而更新快，还可以很好地满足一些特定人群对特定领域信息的需求 。
聚焦网络爬虫和通用网络爬虫相比，增加了链接评价模块以及内容评价模块。聚焦爬虫爬行策略实现的关键是评价页面内容和链接的重要性，不同的方法计算出的重要性不同，由此导致链接的访问顺序也不同。</p> <blockquote><ol><li>基于内容评价的爬行策略：DeBra将文本相似度的计算方法引入到网络爬虫中，提出了 Fish Search 算法，它将用户输入的查询词作为主题，包含查询词的页面被视为与主题相关，其局限性在于无法评价页面与主题相关 度 的 高 低 。 Herseovic对 Fish Search 算 法 进 行 了 改 进 ，提 出 了 Sharksearch 算法，利用空间向量模型计算页面与主题的相关度大小。</li> <li>基于链接结构评价的爬行策略 ：Web 页面作为一种半结构化文档，包含很多结构信息，可用来评价链接重要性。 PageRank 算法最初用于搜索引擎信息检索中对查询结果进行排序，也可用于评价链接重要性，具体做法就是每次选择 PageRank 值较大页面中的链接来访问。 另一个利用 Web结构评价链接价值的方法是 HITS 方法，它通过计算每个已访问页面的 Authority 权重和 Hub 权重，并以此决定链接的访问顺序。</li> <li>基于增强学习的爬行策略：Rennie 和 McCallum 将增强学习引入聚焦爬虫，利用贝叶斯分类器，根据整个网页文本和链接文本对超链接进行分类，为每个链接计算出重要性，从而决定链接的访问顺序。</li> <li>基于语境图的爬行策略：Diligenti 等人提出了一种通过建立语境图（Context Graphs）学习网页之间的相关度，训练一个机器学习系统，通过该系统可计算当前页面到相关 Web 页面的距离，距离越近的页面中的链接优先访问。印度理工大学（IIT）和 IBM 研究中心的研究人员开发了一个典型的聚焦网络爬虫。 该爬虫对主题的定义既不是采用关键词也不是加权矢量，而是一组具有相同主题的网页。 它包含两个重要模块：一个是分类器，用来计算所爬行的页面与主题的相关度，确定是否与主题相关；另一个是净化器，用来识别通过较少链接连接到大量相关页面的中心页面 。</li></ol></blockquote> <h5 id="三、增量式网络爬虫"><a href="#三、增量式网络爬虫" aria-hidden="true" class="header-anchor">#</a> 三、增量式网络爬虫</h5> <p>增量式网络爬虫（Incremental Web Crawler）是 指 <em>对 已 下 载 网 页 采 取 增 量式更新和只爬行新产生的或者已经发生变化网页的爬虫</em>，它能够在一定程度上<em>保证所爬行的页面是尽可能新的页面</em>。 和周期性爬行和刷新页面的网络爬虫相比，增量式爬虫只会在需要的时候爬行新产生或发生更新的页面 ，并不重新下载没有发生变化的页面，可有效减少数据下载量，及时更新已爬行的网页，减小时间和空间上的耗费，但是增加了爬行算法的复杂度和实现难度。增量式网络爬虫的体系结构[包含爬行模块、排序模块、更新模块、本地页面集、待爬行 URL 集以及本地页面URL 集。
增量式爬虫有两个目标：保持本地页面集中存储的页面为最新页面和提高本地页面集中页面的质量。 为实现第一个目标，增量式爬虫需要通过重新访问网页来更新本地页面集中页面内容，常用的方法有：1) 统一更新法：爬虫以相同的频率访问所有网页，不考虑网页的改变频率；2) 个体更新法：爬虫根据个体网页的改变频率来重新访问各页面；3) 基于分类的更新法：爬虫根据网页改变频率将其分为更新较快网页子集和更新较慢网页子集两类，然后以不同的频率访问这两类网页。
为实现第二个目标，增量式爬虫需要对网页的重要性排序，常用的策略有：广度优先策略、PageRank 优先策略等。IBM 开发的 WebFountain是一个功能强大的增量式网络爬虫，它采用一个优化模型控制爬行过程，并没有对页面变化过程做任何统计假设，而是采用一种自适应的方法根据先前爬行周期里爬行结果和网页实际变化速度对页面更新频率进行调整。北京大学的天网增量爬行系统旨在爬行国内 Web，将网页分为变化网页和新网页两类，分别采用不同爬行策略。 为缓解对大量网页变化历史维护导致的性能瓶颈，它根据网页变化时间局部性规律，在短时期内直接爬行多次变化的网页 ，为尽快获取新网页，它利用索引型网页跟踪新出现网页</p> <h5 id="四、deep-web-爬虫"><a href="#四、deep-web-爬虫" aria-hidden="true" class="header-anchor">#</a> 四、Deep Web 爬虫</h5> <p>Web 页面按存在方式可以分为表层网页（Surface Web）和深层网页（Deep Web，也称 Invisible Web Pages 或 Hidden Web）。 表层网页是指传统搜索引擎可以索引的页面，以超链接可以到达的静态网页为主构成的 Web 页面。Deep Web 是那些<em>大部分内容不能通过静态链接获取的、隐藏在搜索表单后的，只有用户提交一些关键词才能获得的 Web 页面</em>。例如那些用户注册后内容才可见的网页就属于 Deep Web。 2000 年 Bright Planet 指出：Deep Web 中可访问信息容量是 Surface Web 的几百倍，是互联网上最大、发展最快的新型信息资源。
Deep Web 爬虫体系结构包含六个基本功能模块 （爬行控制器、解析器、表单分析器、表单处理器、响应分析器、LVS 控制器）和两个爬虫内部数据结构（URL 列表、LVS 表）。 其中 LVS（Label Value Set）表示标签/数值集合，用来表示填充表单的数据源。
Deep Web 爬虫爬行过程中最重要部分就是表单填写，包含两种类型：</p> <blockquote><ol><li>基于领域知识的表单填写：此方法一般会维持一个本体库，通过语义分析来选取合适的关键词填写表单。 Yiyao Lu等人提出一种获取 Form 表单信息的多注解方法，将数据表单按语义分配到各个组中 ，对每组从多方面注解，结合各种注解结果来预测一个最终的注解标签；郑冬冬等人利用一个预定义的领域本体知识库来识别 Deep Web 页面内容， 同时利用一些来自 Web 站点导航模式来识别自动填写表单时所需进行的路径导航[1]  。</li> <li>基于网页结构分析的表单填写： 此方法一般无领域知识或仅有有限的领域知识，将网页表单表示成 DOM 树，从中提取表单各字段值。 Desouky 等人提出一种 LEHW 方法，该方法将 HTML 网页表示为DOM 树形式，将表单区分为单属性表单和多属性表单，分别进行处理；孙彬等人提出一种基于 XQuery 的搜索系统，它能够模拟表单和特殊页面标记切换，把网页关键字切换信息描述为三元组单元，按照一定规则排除无效表单，将 Web 文档构造成 DOM 树，利用 XQuery 将文字属性映射到表单字段[1]  。
Raghavan 等人提出的 HIWE 系统中，爬行管理器负责管理整个爬行过程，分析下载的页面，将包含表单的页面提交表单处理器处理，表单处理器先从页面中提取表单，从预先准备好的数据集中选择数据自动填充并提交表单，由爬行控制器下载相应的结果页面</li></ol></blockquote> <h2 id="代码（javascript）"><a href="#代码（javascript）" aria-hidden="true" class="header-anchor">#</a> 代码（javascript）</h2> <h6 id="目的获取智联招聘中的招聘信息进行分析"><a href="#目的获取智联招聘中的招聘信息进行分析" aria-hidden="true" class="header-anchor">#</a> 目的获取智联招聘中的招聘信息进行分析</h6> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> cheerio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cheerio'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> request <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&quot;http://sou.zhaopin.com/jobs/searchresult.ashx?jl=%E5%8C%97%E4%BA%AC&amp;kw=%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B7%A5%E7%A8%8B%E5%B8%88&amp;sm=0&amp;sf=10001&amp;st=30000&amp;we=0305&amp;isfilter=1&amp;el=4&amp;sg=6babdaaaf60543a1bc3722d1c98cf3d4&amp;p=2&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//初始url</span>

<span class="token keyword">function</span> <span class="token function">fetchPage</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment">//封装了一层函数</span>
    <span class="token function">startRequest</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">function</span> <span class="token function">startRequest</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//采用http模块向服务器发起一次get请求c</span>
    http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token comment">//用来存储请求网页的整个html内容</span>
        <span class="token keyword">var</span> titles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//防止中文乱码</span>
        <span class="token comment">//监听data事件，每次取一块数据</span>
        res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            html <span class="token operator">+=</span> chunk<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//监听end事件，如果整个网页内容的html都获取完毕，就执行回调函数</span>
        res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">var</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//采用cheerio模块解析html</span>
            <span class="token keyword">var</span> $urlList <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.zwmc a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// console.log($urlList.length);</span>
            <span class="token keyword">var</span> uList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

            $urlList<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// getInfo($($urlList[0]).attr('href'))</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//采用http模块向服务器发起一次get请求c</span>
    http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token comment">//用来存储请求网页的整个html内容</span>
        <span class="token keyword">var</span> titles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//防止中文乱码</span>
        <span class="token comment">//监听data事件，每次取一块数据</span>
        res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            html <span class="token operator">+=</span> chunk<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//监听end事件，如果整个网页内容的html都获取完毕，就执行回调函数</span>
        res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">var</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//采用cheerio模块解析html</span>

            <span class="token keyword">var</span> demand <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.terminal-ul.clearfix strong'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">var</span> news_item <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token comment">//获取文章的标题</span>
                title<span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.fixed-inner-box h1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment">//要求</span>
                demand<span class="token punctuation">:</span> demand<span class="token punctuation">,</span>
                <span class="token comment">//公司</span>
                company<span class="token punctuation">:</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.fixed-inner-box h2 a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment">//主要要求</span>
                mainDemand<span class="token punctuation">:</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.tab-inner-cont'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment">//企业介绍</span>
                companyProfile<span class="token punctuation">:</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.tab-inner-cont'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                author<span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'[title=供稿]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token punctuation">}</span><span class="token punctuation">;</span>

             <span class="token comment">// console.log(news_item);     //招聘信息打印</span>
             <span class="token keyword">var</span> news_title <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.fixed-inner-box h1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.tab-inner-cont'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                x <span class="token operator">+=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
             <span class="token function">savedContent</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>news_title<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//存储每篇文章的内容及文章标题</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token comment">//该函数的作用：在本地存储所爬取的新闻内容资源</span>
<span class="token keyword">function</span> <span class="token function">savedContent</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> news_title</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">//将文本内容一段一段添加到/data文件夹下，并用标题来命名文件</span>
    fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span><span class="token string">'./data/'</span> <span class="token operator">+</span> news_title <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.txt'</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">fetchPage</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//主程序开始运行</span>
</code></pre></div><p>执行完程序后想合并文件，windows下cmd -&gt; 进入目录 -&gt; copy *.txt newName.txt</p></div></article> <section class="post-meta main-div" data-v-7f7ca342><section class="post-date clearfix" data-v-7f7ca342><span class="create-date" data-v-7f7ca342>
      发布时间 : 2017-12-05
    </span> <span class="update-date" data-v-7f7ca342>
      最后修改 : 2019-04-24
    </span></section> <section class="post-links" data-v-7f7ca342><a href="/posts/2017/12/05/jquery-common-operation.html" class="post-link" data-v-7f7ca342>
      上一篇 : Common operation of jquery
    </a> <a href="/posts/2017/12/05/lashou-masterstation.html" class="post-link" data-v-7f7ca342>
      下一篇 : 曾经做过的东西,可能只是我的回忆...
    </a></section></section> <div id="post-comments" class="main-div"><!----></div></div></main> <aside class="aside" data-v-0874e876><div class="info-card main-div" data-v-2bd66a30 data-v-0874e876><div class="info-card-header" data-v-2bd66a30><img src="https://blog.mamingjuan.cn/assets/images/favicon-16.ico" alt="glitzma" class="info-avatar" data-v-2bd66a30></div> <div class="info-card-body" data-v-2bd66a30><section class="info-nickname" data-v-2bd66a30>
      glitzma
    </section> <section class="info-desc" data-v-2bd66a30>Happy Coding<br/>Happy Life</section> <section class="info-contact" data-v-2bd66a30><section data-v-2bd66a30><span title="Beijing City, China" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>Beijing City, China</title><use xlink:href="#icon-location" data-v-2bd66a30 data-v-2bd66a30></use></svg><span class="info-text" data-v-2bd66a30 data-v-2bd66a30>
          Beijing City, China
        </span></span></section> <section data-v-2bd66a30><span title="Hao Wei Lai" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>Hao Wei Lai</title><use xlink:href="#icon-organization" data-v-2bd66a30 data-v-2bd66a30></use></svg><span class="info-text" data-v-2bd66a30 data-v-2bd66a30>
          Hao Wei Lai
        </span></span></section> <section data-v-2bd66a30><a href="mailto:glitteringma@gmail.com" title="glitteringma@gmail.com" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>glitteringma@gmail.com</title><use xlink:href="#icon-email" data-v-2bd66a30 data-v-2bd66a30></use></svg><span class="info-text" data-v-2bd66a30 data-v-2bd66a30>
          glitteringma@gmail.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-2bd66a30><section class="info-sns clearfix" data-v-2bd66a30><a href="https://github.com/glitzma" target="_blank" class="sns-link" data-v-2bd66a30><span title="GitHub: glitzma" class="sns-icon" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1.5em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>GitHub: glitzma</title><use xlink:href="#icon-github" data-v-2bd66a30 data-v-2bd66a30></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-0874e876><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span>文章目录</span> <div class="post-nav-toc"><ul><li><a href="/posts/2017/12/05/crawler.html#爬虫是什么？">爬虫是什么？</a></li><li><a href="/posts/2017/12/05/crawler.html#爬虫的分类">爬虫的分类</a></li><li><a href="/posts/2017/12/05/crawler.html#代码（javascript）">代码（javascript）</a></li></ul></div></div> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/posts/2017/12/05/crawler.html#post-comments">
      评论
    </a></div></div></aside></div> <footer class="footer" data-v-e361d3ee><p class="sns-links" data-v-e361d3ee><a href="https://github.com/glitzma" target="_blank" class="sns-link" data-v-e361d3ee><span title="GitHub: glitzma" class="sns-icon" data-v-e361d3ee data-v-e361d3ee><svg class="icon" style="font-size:25px;" data-v-e361d3ee data-v-e361d3ee><title data-v-e361d3ee data-v-e361d3ee>GitHub: glitzma</title><use xlink:href="#icon-github" data-v-e361d3ee data-v-e361d3ee></use></svg></span></a></p> <p data-v-e361d3ee><span data-v-e361d3ee>Powered by </span> <a href="https://vuepress.vuejs.org" target="_blank" data-v-e361d3ee>
      Vuepress
    </a></p></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.b63f6ec7.js" defer></script><script src="/assets/js/3.d8673601.js" defer></script><script src="/assets/js/34.c3692ebc.js" defer></script>
  </body>
</html>
