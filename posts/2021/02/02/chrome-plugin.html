<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>chrome插件 | 马明娟</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="This is my blog">
    
    <link rel="preload" href="/assets/css/0.styles.7ae9fe33.css" as="style"><link rel="preload" href="/assets/js/app~d0ae3f07.7ae9fe33.js" as="script"><link rel="preload" href="/assets/css/styles.43f6a87c.css" as="style"><link rel="preload" href="/assets/js/app~db300d2f.43f6a87c.js" as="script"><link rel="preload" href="/assets/css/9.styles.d80ec364.css" as="style"><link rel="preload" href="/assets/js/9.d80ec364.js" as="script"><link rel="preload" href="/assets/js/39.6d3334f8.js" as="script"><link rel="prefetch" href="/assets/css/10.styles.06714614.css"><link rel="prefetch" href="/assets/css/2.styles.c30b94c6.css"><link rel="prefetch" href="/assets/css/3.styles.78e857d7.css"><link rel="prefetch" href="/assets/css/4.styles.c6dd9a10.css"><link rel="prefetch" href="/assets/css/5.styles.a4cf2d4b.css"><link rel="prefetch" href="/assets/css/6.styles.a463c4a0.css"><link rel="prefetch" href="/assets/css/7.styles.a4f00c88.css"><link rel="prefetch" href="/assets/css/8.styles.e03eae99.css"><link rel="prefetch" href="/assets/js/10.06714614.js"><link rel="prefetch" href="/assets/js/11.42360893.js"><link rel="prefetch" href="/assets/js/12.9f882609.js"><link rel="prefetch" href="/assets/js/13.2968004d.js"><link rel="prefetch" href="/assets/js/14.997d4d9d.js"><link rel="prefetch" href="/assets/js/15.9a1cff14.js"><link rel="prefetch" href="/assets/js/16.a08a4d85.js"><link rel="prefetch" href="/assets/js/17.cd2757aa.js"><link rel="prefetch" href="/assets/js/18.da85c0e1.js"><link rel="prefetch" href="/assets/js/19.24e158f5.js"><link rel="prefetch" href="/assets/js/2.c30b94c6.js"><link rel="prefetch" href="/assets/js/20.7c2536fb.js"><link rel="prefetch" href="/assets/js/21.cc3dd757.js"><link rel="prefetch" href="/assets/js/22.d938a8f2.js"><link rel="prefetch" href="/assets/js/23.7a6361f9.js"><link rel="prefetch" href="/assets/js/24.659ddf4b.js"><link rel="prefetch" href="/assets/js/25.8af94c70.js"><link rel="prefetch" href="/assets/js/26.6d7e92d3.js"><link rel="prefetch" href="/assets/js/27.fadaee63.js"><link rel="prefetch" href="/assets/js/28.5c72fff4.js"><link rel="prefetch" href="/assets/js/29.f469b58b.js"><link rel="prefetch" href="/assets/js/3.78e857d7.js"><link rel="prefetch" href="/assets/js/30.513f826d.js"><link rel="prefetch" href="/assets/js/31.b2394dec.js"><link rel="prefetch" href="/assets/js/32.039a18f0.js"><link rel="prefetch" href="/assets/js/33.cc6aa218.js"><link rel="prefetch" href="/assets/js/34.14b5948c.js"><link rel="prefetch" href="/assets/js/35.a976251a.js"><link rel="prefetch" href="/assets/js/36.842d5ddf.js"><link rel="prefetch" href="/assets/js/37.504f3e6b.js"><link rel="prefetch" href="/assets/js/38.0df49f45.js"><link rel="prefetch" href="/assets/js/4.c6dd9a10.js"><link rel="prefetch" href="/assets/js/40.85aeb0ed.js"><link rel="prefetch" href="/assets/js/41.8d146200.js"><link rel="prefetch" href="/assets/js/42.361bd65a.js"><link rel="prefetch" href="/assets/js/43.c424591e.js"><link rel="prefetch" href="/assets/js/44.3327afe0.js"><link rel="prefetch" href="/assets/js/45.efcf1686.js"><link rel="prefetch" href="/assets/js/46.dea3e576.js"><link rel="prefetch" href="/assets/js/47.84876b51.js"><link rel="prefetch" href="/assets/js/48.193dab24.js"><link rel="prefetch" href="/assets/js/49.9d6913b4.js"><link rel="prefetch" href="/assets/js/5.a4cf2d4b.js"><link rel="prefetch" href="/assets/js/6.a463c4a0.js"><link rel="prefetch" href="/assets/js/7.a4f00c88.js"><link rel="prefetch" href="/assets/js/8.e03eae99.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7ae9fe33.css"><link rel="stylesheet" href="/assets/css/styles.43f6a87c.css"><link rel="stylesheet" href="/assets/css/9.styles.d80ec364.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-glitzma"><header class="header" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(/assets/img/header-image-03.jpg);" data-v-e4a0ebe0><div data-v-6654f004 data-v-e4a0ebe0><nav class="navbar" data-v-6654f004><div class="container" data-v-6654f004><a href="/" class="router-link-active" data-v-6654f004><span class="navbar-site-name" data-v-6654f004>
          马明娟
        </span></a> <div class="navbar-toggler" data-v-6654f004><svg class="icon" style="font-size:1.2em;" data-v-6654f004 data-v-6654f004><title data-v-6654f004 data-v-6654f004>menu</title><use xlink:href="#icon-menu" data-v-6654f004 data-v-6654f004></use></svg></div> <div class="navbar-links" data-v-6654f004><a href="/" class="navbar-link" data-v-6654f004>
            Home
          </a><a href="/posts/" class="navbar-link router-link-active" data-v-6654f004>
            Search
          </a><a href="/custom-pages/" class="navbar-link" data-v-6654f004>
            About
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-6654f004></div></div> <div class="banner" data-v-e2d7da12 data-v-e4a0ebe0 data-v-e4a0ebe0><div class="container" data-v-e2d7da12><div class="center" data-v-e2d7da12></div></div></div></header> <div class="container clearfix show-aside" data-v-0874e876 data-v-0874e876><main class="main" data-v-0874e876><div class="post" data-v-0874e876 data-v-0874e876><section class="post-meta main-div" data-v-12a4d4fc><section class="post-date clearfix" data-v-12a4d4fc><span class="create-date" data-v-12a4d4fc>
      发布于 : 2021-02-02
    </span> <span class="update-date" data-v-12a4d4fc>
      修改于 : 2021-11-15
    </span></section> <section class="post-links" data-v-12a4d4fc><a href="/posts/2021/02/26/react-basics.html" class="post-link" data-v-12a4d4fc>
      下一篇 : react基础知识
    </a> <a href="/posts/2020/10/13/seek.html" class="post-link" data-v-12a4d4fc>
      上一篇 : 查找
    </a></section></section> <article class="main-div"><div class="post-content content__default"><p><a href="https://juejin.cn/post/6939872514927493156" target="_blank" rel="noopener noreferrer">这是别人开发chrome插件的过程,原文章地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.cn/post/6922815205575491597#heading-9" target="_blank" rel="noopener noreferrer">5分钟上手开发浏览器插件——油猴脚手架wokoo(使用篇)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://zhuanlan.zhihu.com/p/99390731" target="_blank" rel="noopener noreferrer">知乎找到的<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="说明">说明</h2> <p>如果直接开发油猴插件，开发者需要费时搭建vue或react基础项目，还需要对油猴脚本区域做对应的配置，开发体验差。</p> <p>wokoo可以一键式生成基础项目，并且提供基础Tampermonkey配置。</p> <p>主要提供的功能有：</p> <ul><li>命令行式创建脚手架初始项目</li> <li>根据用户选择，生成vue、react的基本项目</li> <li>tampermonkey.js 文件中提供Tampermonkey配置</li></ul> <p>关于油猴插件和wokoo的具体使用可以阅读 <a href="https://juejin.cn/post/6922815205575491597" target="_blank" rel="noopener noreferrer">5分钟上手开发浏览器插件——油猴脚手架wokoo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>这里是wokoo脚手架代码：<a href="https://github.com/kinyaying/wokoo" target="_blank" rel="noopener noreferrer">wokoo脚手架github仓库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>使用wokoo开发<a href="https://greasyfork.org/zh-CN/scripts/421189-movesearch" target="_blank" rel="noopener noreferrer">MoveSearch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（划词搜索插件）</p> <p>wokoo脚手架的设计参考了<a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener noreferrer">create-react-app<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，我也曾经写过一篇分析cra源码的文章，感兴趣的同学可以阅读这篇👉<a href="https://juejin.cn/post/6916531902773985294" target="_blank" rel="noopener noreferrer">create-react-app核心源码解读<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="手把手教搭建过程">手把手教搭建过程</h2> <ul><li>lerna: 进行项目管理</li> <li>wokoo-scripts: 和用户交互，拉取 wokoo-template，生成对应的初始项目</li> <li>wokoo-template: 提供模板来初始化一个有基础配置的油猴项目。模板有两种：react 和 vue</li></ul> <p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf77f0701b274c7483a0d6aaba207640~tplv-k3u1fbpfcp-watermark.image?imageslim" alt="img"></p> <ol><li>安装lerna</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i lerna -g
</code></pre></div><ol start="2"><li>创建项目目录，初始化</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> wokoo
<span class="token builtin class-name">cd</span> wokoo
lerna init
</code></pre></div><ol start="3"><li>开启workspace，在package.json中增加<code>workspaces</code>配置</li></ol> <div class="language- extra-class"><pre class="language-text"><code>&quot;workspaces&quot;: [
	&quot;packages/*&quot;
],
</code></pre></div><ol start="4"><li>创建子项目</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code>lerna create wokoo-scripts
lerna create wokoo-template
</code></pre></div><h2 id="wokoo-scripts编写">wokoo-scripts编写</h2> <p>wokoo-scripts的主要功能有：</p> <ul><li>commander 获取shell中用户键入的projectName</li> <li>fs.writeFile创建文件路径</li> <li>安装wokoo-template模板</li> <li>读取模板指定后缀文件.md, .js，将ejs语法进行替换</li> <li>删除多余内容</li> <li>卸载模板</li></ul> <p><strong>1.创建入口</strong></p> <p>进入<code>packages/wokoo-scripts</code>，创建<code>bin/www</code>文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token hashbang comment">#! /usr/bin/env node</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../index.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>修改package.json，增加<code>bin</code>字段配置</p> <div class="language-json extra-class"><pre class="language-json"><code> <span class="token property">&quot;bin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;wokoo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./bin/www&quot;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>在wokoo-scripts下创建index.js文件作为项目入口。</p> <p><strong>2.安装依赖模块</strong></p> <p>介绍下用到的第三方模块：</p> <ul><li><p><a href="https://www.npmjs.com/package/chalk" target="_blank" rel="noopener noreferrer">chalk<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 粉笔，丰富控制台显示的字颜色</p></li> <li><p><a href="https://www.npmjs.com/package/cross-spawn" target="_blank" rel="noopener noreferrer">cross-spawn<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 开启子线程</p></li> <li><p><a href="https://www.npmjs.com/package/commander" target="_blank" rel="noopener noreferrer">commander<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 解析命令行中的命令</p></li> <li><p><a href="https://www.npmjs.com/package/fs-extra" target="_blank" rel="noopener noreferrer">fs-extra<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>  操作文件</p></li> <li><p><a href="https://www.npmjs.com/package/inquirer" target="_blank" rel="noopener noreferrer">inquirer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>  交互式命令行工具，有他就可以实现命令行的选择功能</p></li> <li><p><a href="https://www.npmjs.com/package/metalsmith" target="_blank" rel="noopener noreferrer">metalsmith<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>  读取所有文件,实现模板渲染</p></li> <li><p><a href="https://www.npmjs.com/package/consolidate" target="_blank" rel="noopener noreferrer">consolidate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 统一模板引擎</p></li></ul> <p>安装依赖，添加软链</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> chalk cross-spawn commander fs-extra inquirer metalsmith consolidate ejs  -S
<span class="token function">npm</span> <span class="token function">link</span>
</code></pre></div><p><strong>3.实现init方法，读取命令行指令</strong></p> <p>主要使用<a href="https://www.npmjs.com/package/commander" target="_blank" rel="noopener noreferrer">commander<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>来读取命令行中用户输入的项目名，此时在命令行执行<code>wokoo my-app</code>，能够在代码中获取到项目名my-app</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> spawn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cross-spawn'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Command <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs-extra'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> inquirer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inquirer'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> packageJson <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./package.json'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> program <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Command</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 程序入口，读取命令行脚本，获得项目名称</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> projectName
  program
    <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span>packageJson<span class="token punctuation">.</span>version<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">arguments</span><span class="token punctuation">(</span><span class="token string">'&lt;project-directory&gt;'</span><span class="token punctuation">)</span> <span class="token comment">// 项目目录名 参数格式：&lt;必选&gt; [可选]</span>
    <span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;project-directory&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      projectName <span class="token operator">=</span> name
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'projectName:'</span><span class="token punctuation">,</span> projectName<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token comment">// [node路径，脚本路径，参数]</span>
		<span class="token keyword">await</span> <span class="token function">createApp</span><span class="token punctuation">(</span>projectName<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>4.createApp方法，根据项目名生成项目</strong></p> <p>在run方法中调createApp方法，传入projectName。createApp主要实现了创建文件夹，写入package.json的功能。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token parameter">appName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> root <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>appName<span class="token punctuation">)</span> <span class="token comment">// 要生成的项目的绝对路径</span>
  fs<span class="token punctuation">.</span><span class="token function">ensureDirSync</span><span class="token punctuation">(</span>appName<span class="token punctuation">)</span> <span class="token comment">// 没有则创建文件夹</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">create a new app in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token comment">// 初始化package.json</span>
  <span class="token keyword">const</span> packageJson <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> appName<span class="token punctuation">,</span>
    version<span class="token operator">:</span> <span class="token string">'0.0.1'</span><span class="token punctuation">,</span>
    <span class="token keyword">private</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    scripts<span class="token operator">:</span> <span class="token punctuation">{</span>
      start<span class="token operator">:</span> <span class="token string">'cross-env NODE_ENV=development webpack serve'</span><span class="token punctuation">,</span>
      build<span class="token operator">:</span> <span class="token string">'webpack'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 写入package.json</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>
    path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token string">'package.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>packageJson<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token comment">// 改变工作目录，进入项目目录</span>
  process<span class="token punctuation">.</span><span class="token function">chdir</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">run</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> appName<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>5. run：复制项目模板到当前项目下，生成基础项目</strong></p> <p>createApp最后要调用run方法。run主要做了以下几点👇：</p> <ol><li>安装wokoo-template</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> templateName <span class="token operator">=</span> <span class="token string">'wokoo-template'</span> <span class="token comment">// 对应的wokoo模板</span>
<span class="token keyword">const</span> allDependencies <span class="token operator">=</span> <span class="token punctuation">[</span>templateName<span class="token punctuation">]</span>
<span class="token comment">// 安装wokoo-template包</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Installing packages. This might take a couple of minutes'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Installing </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span>templateName<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">doAction</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> allDependencies<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Installing </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span>templateName<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> failed ...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>根据用户选择的模板类型复制相应模板文件到临时文件夹temp，替换其中的ejs模板，然后删除临时文件夹temp</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 选择模板</span>
  <span class="token keyword">const</span> repos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token string">'react'</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> targetTemplate <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> inquirer<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'targetTemplate'</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
    message<span class="token operator">:</span> <span class="token string">'which template do you prefer?'</span><span class="token punctuation">,</span>
    choices<span class="token operator">:</span> repos<span class="token punctuation">,</span> <span class="token comment">// 选择模式</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> templatePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>
    require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>templateName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/package.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> paths<span class="token operator">:</span> <span class="token punctuation">[</span>root<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>

  <span class="token comment">// 复制文件到项目目录</span>
  <span class="token keyword">const</span> scriptsConfigDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">,</span> <span class="token string">'webpack.config.js'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> gitIgnoreDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">,</span> <span class="token string">'.npmignore'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> publicDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> tempDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token string">'temp'</span><span class="token punctuation">)</span> <span class="token comment">// 临时模板路径</span>
  <span class="token keyword">const</span> templateDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>targetTemplate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-template</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token comment">// 从wokoo-template中拷贝模板到项目目录</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将templateDir内模板拷贝到temp文件，并修改模板文件中的ejs配置项</span>
    <span class="token keyword">await</span> <span class="token function">modifyTemplate</span><span class="token punctuation">(</span>templateDir<span class="token punctuation">,</span> <span class="token string">'temp'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      projectName<span class="token operator">:</span> appName<span class="token punctuation">,</span>
      basicProject<span class="token operator">:</span> targetTemplate<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    fs<span class="token punctuation">.</span><span class="token function">copySync</span><span class="token punctuation">(</span>tempDir<span class="token punctuation">,</span> root<span class="token punctuation">)</span> <span class="token comment">// 源 目标</span>
    fs<span class="token punctuation">.</span><span class="token function">copySync</span><span class="token punctuation">(</span>publicDir<span class="token punctuation">,</span> root <span class="token operator">+</span> <span class="token string">'/public'</span><span class="token punctuation">)</span>
    fs<span class="token punctuation">.</span><span class="token function">copyFileSync</span><span class="token punctuation">(</span>scriptsConfigDir<span class="token punctuation">,</span> root <span class="token operator">+</span> <span class="token string">'/webpack.config.js'</span><span class="token punctuation">)</span>
    fs<span class="token punctuation">.</span><span class="token function">copyFileSync</span><span class="token punctuation">(</span>gitIgnoreDir<span class="token punctuation">,</span> root <span class="token operator">+</span> <span class="token string">'/.gitignore'</span><span class="token punctuation">)</span>
    <span class="token function">deleteFolder</span><span class="token punctuation">(</span>tempDir<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Could not locate supplied template: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>此处，我将复制的功能封装到modifyTemplate.js中。利用MetalSmith提供的方法遍历源路径下文件，利用consolidate.ejs将文件中的ejs语法替换后，将内容写入新的临时文件夹temp中。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> MetalSmith <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'metalsmith'</span><span class="token punctuation">)</span> <span class="token comment">// 遍历文件夹</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> render <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'consolidate'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ejs
<span class="token keyword">const</span> <span class="token punctuation">{</span> promisify <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
render <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span> <span class="token comment">// 包装渲染方法</span>

<span class="token comment">/**
 *
 * @param {*} fromPath 源路径
 * @param {*} toPath 目标路径
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleTemplate</span><span class="token punctuation">(</span><span class="token parameter">fromPath<span class="token punctuation">,</span> toPath<span class="token punctuation">,</span> config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resovle<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">MetalSmith</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>fromPath<span class="token punctuation">)</span> <span class="token comment">// 遍历下载的目录</span>
      <span class="token punctuation">.</span><span class="token function">destination</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> toPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 输出渲染后的结果</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">files<span class="token punctuation">,</span> metal<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// result 替换模板内数据</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">{</span>
          license<span class="token operator">:</span> <span class="token string">'MIT'</span><span class="token punctuation">,</span>
          version<span class="token operator">:</span> <span class="token string">'0.0.1'</span><span class="token punctuation">,</span>
          <span class="token operator">...</span>config<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> metal<span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token comment">// 将询问的结果放到metadata中保证在下一个中间件中可以获取到</span>
        <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">files<span class="token punctuation">,</span> metal<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        Reflect<span class="token punctuation">.</span><span class="token function">ownKeys</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> content <span class="token operator">=</span> files<span class="token punctuation">[</span>file<span class="token punctuation">]</span><span class="token punctuation">.</span>contents<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 获取文件中的内容</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>
            file<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'.js'</span><span class="token punctuation">)</span> <span class="token operator">||</span>
            file<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'.json'</span><span class="token punctuation">)</span> <span class="token operator">||</span>
            file<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'.txt'</span><span class="token punctuation">)</span> <span class="token operator">||</span>
            file<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'.md'</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果是md或者txt才有可能是模板</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'&lt;%'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// 文件中用&lt;% 我才需要编译</span>
              content <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">render</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> metal<span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 用数据渲染模板</span>
              files<span class="token punctuation">[</span>file<span class="token punctuation">]</span><span class="token punctuation">.</span>contents <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token comment">// 渲染好的结果替换即可</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 执行中间件</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">resovle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> handleTemplate
</code></pre></div><ol start="3"><li>合并template.json和package.json，生成新的package.json并再次执行<code>npm install</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 合并template.json和package.json</span>
  <span class="token keyword">let</span> tempPkg <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>root <span class="token operator">+</span> <span class="token string">'/template.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> pkg <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>root <span class="token operator">+</span> <span class="token string">'/package.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> tempPkgJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>tempPkg<span class="token punctuation">)</span>
  <span class="token keyword">const</span> pkgJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>pkg<span class="token punctuation">)</span>

  pkgJson<span class="token punctuation">.</span>dependencies <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>pkgJson<span class="token punctuation">.</span>dependencies<span class="token punctuation">,</span>
    <span class="token operator">...</span>tempPkgJson<span class="token punctuation">.</span>package<span class="token punctuation">.</span>dependencies<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  pkgJson<span class="token punctuation">.</span>devDependencies <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>tempPkgJson<span class="token punctuation">.</span>package<span class="token punctuation">.</span>devDependencies<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 编写package.json</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>
    path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token string">'package.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>pkgJson<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  fs<span class="token punctuation">.</span><span class="token function">unlinkSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token string">'template.json'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 删除template.json文件</span>

  <span class="token comment">// 再次根据dependenciesToInstall执行npm install</span>
  <span class="token keyword">const</span> dependenciesToInstall <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>pkgJson<span class="token punctuation">.</span>dependencies<span class="token punctuation">,</span>
    <span class="token operator">...</span>pkgJson<span class="token punctuation">.</span>devDependencies<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> newDependencies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>dependenciesToInstall<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    newDependencies <span class="token operator">=</span> newDependencies<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>
      dependenciesToInstall<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>dependency<span class="token punctuation">,</span> version<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dependency<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">await</span> <span class="token function">doAction</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> newDependencies<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token string">'Installing succeed!'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</code></pre></div><ol start="4"><li><p>卸载wokoo-template</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">await</span> <span class="token function">doAction</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token string">'wokoo-template'</span><span class="token punctuation">,</span> <span class="token string">'uninstall'</span><span class="token punctuation">)</span>
</code></pre></div></li></ol> <p>流程上的实现介绍完了，下面两个方法是我封装的功能性方法</p> <p><strong>doAction：使用npm安装或卸载项目依赖</strong></p> <p>使用<a href="https://www.npmjs.com/package/cross-spawn" target="_blank" rel="noopener noreferrer">cross-spawn<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>开启子线程，在子线程中执行<code>npm install</code> 或 <code>npm uninstall</code>的命令</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">doAction</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> allDependencies<span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">'install'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">typeof</span> allDependencies <span class="token operator">===</span> <span class="token string">'string'</span>
    <span class="token operator">?</span> <span class="token punctuation">(</span>allDependencies <span class="token operator">=</span> <span class="token punctuation">[</span>allDependencies<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> command <span class="token operator">=</span> <span class="token string">'npm'</span>
    <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span>
      action<span class="token punctuation">,</span>
      <span class="token string">'--save'</span><span class="token punctuation">,</span>
      <span class="token string">'--save-exact'</span><span class="token punctuation">,</span>
      <span class="token string">'--loglevel'</span><span class="token punctuation">,</span>
      <span class="token string">'error'</span><span class="token punctuation">,</span>
      <span class="token operator">...</span>allDependencies<span class="token punctuation">,</span>
      <span class="token string">'--cwd'</span><span class="token punctuation">,</span>
      root<span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    <span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token punctuation">{</span> stdio<span class="token operator">:</span> <span class="token string">'inherit'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    child<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span> <span class="token comment">// 安装成功后触发resolve</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>deleteFolder: 递归删除文件、文件夹，入参是path文件路径</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">deleteFolder</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// path是文件，直接删除</span>
      fs<span class="token punctuation">.</span><span class="token function">unlinkSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 删除文件夹</span>
      files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
      files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> curPath <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> file
        <span class="token function">deleteFolder</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      fs<span class="token punctuation">.</span><span class="token function">rmdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="wokoo-template编写">wokoo-template编写</h2> <ul><li>分为vue-template和react-template</li> <li>vue-template和react-template分别对应webpack配置的一个vue或react基础项目</li> <li>使用ejs模板，实现wokoo-scripts注入变量</li></ul> <p>template相对来说比较简单，使用webpack+vue或react分别搭建了一个轻量级项目。</p> <p>具体代码可看👉<a href="https://github.com/kinyaying/wokoo/tree/master/packages/wokoo-template" target="_blank" rel="noopener noreferrer">wokoo/wokoo-template<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="发布wokoo">发布wokoo</h2> <p>在执行<code>lerna publish</code>之前，先看下自己的项目下用到的文件或文件夹是否在package.json <code>files</code>字段中。只有在files中的文件或文件夹才会真正的被发布上去。</p> <ol><li>在wokoo-scripts的package.json的<code>files</code>字段中增加&quot;modifyTemplate.js&quot;</li> <li>在wokoo-template的package.json的<code>files</code>字段中增加&quot;react-template&quot;, &quot;vue-template&quot;,&quot;public&quot;,&quot;webpack.config.js&quot;,&quot;.gitignore&quot;</li></ol> <p>我之前就忘记往files字段添加，导致publish上去后发现丢文件了。具有问题可阅读：https://stackoverflow.com/questions/27049192/npm-publish-isnt-including-all-my-files</p> <p>最后一步就大功告成了！🎉</p> <div class="language-shell extra-class"><pre class="language-shell"><code>lerna publish
</code></pre></div><h2 id="wokoo使用">wokoo使用</h2> <p>具体使用过程可以阅读<a href="https://juejin.cn/post/6922815205575491597" target="_blank" rel="noopener noreferrer">油猴脚手架wokoo使用说明<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="_1-1-项目安装-初始化配置">1.1 项目安装 &amp; 初始化配置</h3> <div class="language-js extra-class"><pre class="language-js"><code>npm i wokoo <span class="token operator">-</span>g
wokoo zhihu<span class="token operator">-</span>help
</code></pre></div><p>选择模板</p> <ul><li>[ ] vue</li> <li>[ ] react</li></ul> <p>这里选择react，等待项目安装。项目安装完成后，根据提示执行下命令：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> zhihu-helper
<span class="token function">npm</span> start
</code></pre></div><ul><li>打开油猴脚本编辑器，把tampermonkey.js的内容复制进去。</li></ul> <img width="50%" src="/assets/img/tampermonkey/tampermonkey.png"> <img width="100%" src="/assets/img/tampermonkey/copy-tampermonkey.png"> <ul><li>打开网页<a href="https://zhuanlan.zhihu.com/mandy" target="_blank" rel="noopener noreferrer">知乎专栏<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，右上角出现一只猴子图标，说明项目已跑通。</li></ul> <p><strong>补充说明</strong></p> <p>此处有的浏览器不会出现猴子图标。打开控制台可见报错：</p> <img width="100%" src="/assets/img/tampermonkey/zhihu-error.png"> <p>原因是知乎使用了csp内容安全策略，只允许加载指定域名的js。具体情况可阅读 👉 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP" target="_blank" rel="noopener noreferrer">内容安全策略( CSP )<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <img width="100%" src="/assets/img/tampermonkey/zhihu-1.png"> <p><strong>如何绕过此安全策略，此处给两个方法：</strong></p> <ol><li>安装插件<a href="https://chrome.pictureknow.com/extension?id=5b80153e8db143afa59310bc0f282f1f" target="_blank" rel="noopener noreferrer">Disable Content-Security-Policy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, 在调试知乎页面时开启插件，自动把content-security-policy给设置为空。</li></ol> <img width="100%" src="/assets/img/tampermonkey/zhihu-2.png"> <ol start="2"><li>会配置charles的同学，可以设置一条转发规则</li></ol> <img width="100%" src="/assets/img/tampermonkey/zhihu-3.png"> <img width="100%" src="/assets/img/tampermonkey/zhihu-4.png"> <img width="100%" src="/assets/img/tampermonkey/zhihu-5.png"> <p>这两种方法都可以绕过安全策略。</p> <p>遇到这中csp内容安全策略的网页，在上线到油猴商店的时候不能用托管cdn的方式，要将代码复制到编辑框中。</p> <h3 id="_1-2-开发基本功能">1.2 开发基本功能</h3> <p>整理思路</p> <ol><li>绘制左侧抽屉弹窗</li> <li>弹窗弹出时请求知乎列表接口，拿到列表数据</li> <li>下拉时实现加载更多的功能</li></ol> <p>下面我们来逐步实现吧~</p> <p><strong>步骤1. 绘制左侧抽屉弹窗</strong></p> <p>主要通过this.state.show控制弹窗的显示隐藏。此步骤挺简单的，可以直接看代码:<a href="https://github.com/kinyaying/wokoo/blob/master/example/zhihu-helper/src/step1.js" target="_blank" rel="noopener noreferrer">step1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，可以将index.js入口里的app替换成step1查看效果。</p> <p><strong>步骤2. 请求<a href="https://www.zhihu.com/api/v4/columns" target="_blank" rel="noopener noreferrer">知乎列表<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>接口，获取列表数据</strong></p> <ul><li>安装axios，并引入</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> axios
</code></pre></div><ul><li>计算请求参数</li></ul> <p>分析请求的url可知，请求接口为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://www.zhihu.com/api/v4/columns</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>queryName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/items?limit=20&amp;offset=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>offset<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
</code></pre></div><p>其中this.queryName是专栏名称，当页面为<a href="https://zhuanlan.zhihu.com/mandy" target="_blank" rel="noopener noreferrer">专栏列表页<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>时就是pathname; 当页面为<a href="https://zhuanlan.zhihu.com/p/348005704" target="_blank" rel="noopener noreferrer">专栏详情页<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>时，需要通过类名为<code>ColumnPageHeader-TitleColumn</code>的a标签的href来获取。</p> <img width="100%" src="/assets/img/tampermonkey/zhihu.png"> <img width="100%" src="/assets/img/tampermonkey/zhihu1.png"> <p>通过这两张图应该更好理解getQueryName方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">getQueryName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> pathname <span class="token operator">=</span> location<span class="token punctuation">.</span>pathname
    <span class="token keyword">let</span> detailRegExp <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/p\/\d+</span><span class="token regex-delimiter">/</span></span>
    <span class="token keyword">let</span> queryName <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token comment">// 专栏详情页</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>detailRegExp<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>pathname<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> aTage <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span>
        <span class="token string">'ColumnPageHeader-TitleColumn'</span>
      <span class="token punctuation">)</span>
      <span class="token keyword">let</span> url <span class="token operator">=</span> aTage<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>href
      queryName <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 专栏列表页</span>
      <span class="token comment">// http://zhuanlan.zhihu和http://zhihu/column两种情况都是专栏</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'/column'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pathname <span class="token operator">=</span> pathname<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token string">'/column'</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      queryName <span class="token operator">=</span> pathname
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>queryName <span class="token operator">=</span> queryName
  <span class="token punctuation">}</span>
</code></pre></div><p>而列表页又存在两种域名：https://www.zhihu.com/column/mandy    和 https://zhuanlan.zhihu.com/mandy  所以在<code>else</code>逻辑里针对<code>https://www.zhihu.com/column/mandy</code>做了处理，只保留/mandy</p> <p>通过getQueryName方法，我们获取到了请求参数</p> <ul><li>发送请求，拉取目录列表</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">getList</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasMore<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> offset <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
    <span class="token keyword">let</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://www.zhihu.com/api/v4/columns</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>queryName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/items?limit=20&amp;offset=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>offset<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span>
    <span class="token keyword">let</span> list <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token operator">:</span> i<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
      url<span class="token operator">:</span> i<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
      id<span class="token operator">:</span> i<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
      commentCount<span class="token operator">:</span> i<span class="token punctuation">.</span>comment_count<span class="token punctuation">,</span>
      voteupCount<span class="token operator">:</span> i<span class="token punctuation">.</span>voteup_count<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>paging<span class="token punctuation">.</span>is_end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hasMore<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    offset <span class="token operator">+=</span> limit

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">,</span> <span class="token operator">...</span>list<span class="token punctuation">]</span><span class="token punctuation">,</span>
      offset<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>第二步的过程实现完了，代码在这里👉<a href="https://github.com/kinyaying/wokoo/blob/master/example/zhihu-helper/src/step2.js" target="_blank" rel="noopener noreferrer">step2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，可以将index.js入口里的app替换成step2查看效果。</p> <p>这时插件的效果是这样的，除了没有下拉加载功能，其他基本完工了。</p> <img width="100%" src="/assets/img/tampermonkey/image-20210206004837608.png"> <p><strong>步骤3. 下拉时实现加载更多的功能</strong></p> <p>无限滚动的组件引了第三方库<a href="https://www.npmjs.com/package/react-infinite-scroll-component" target="_blank" rel="noopener noreferrer">react-infinite-scroll-component<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> react-infinite-scroll-component
</code></pre></div><p>主要是在render函数里增加InfiniteScroll组件，注意InfiniteScroll的height需要通过计算给一个固定的值，否则无法触发滚动。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>ul className<span class="token operator">=</span><span class="token string">&quot;list-ul&quot;</span> onMouseLeave<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleMouseLeave<span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>InfiniteScroll
		dataLength<span class="token operator">=</span><span class="token punctuation">{</span>list<span class="token punctuation">.</span>length<span class="token punctuation">}</span>
		next<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleInfiniteOnLoad<span class="token punctuation">}</span>
		hasMore<span class="token operator">=</span><span class="token punctuation">{</span>hasMore<span class="token punctuation">}</span>
		loader<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>h4<span class="token operator">&gt;</span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span><span class="token punctuation">}</span>
    height<span class="token operator">=</span><span class="token punctuation">{</span>document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientHeight <span class="token operator">-</span> <span class="token number">53</span><span class="token punctuation">}</span>
		endMessage<span class="token operator">=</span><span class="token punctuation">{</span>
  		<span class="token operator">&lt;</span>p style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> textAlign<span class="token operator">:</span> <span class="token string">'center'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
    		<span class="token operator">&lt;</span>b<span class="token operator">&gt;</span>到底了，没内容啦<span class="token operator">~</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
		<span class="token punctuation">}</span>
  <span class="token operator">&gt;</span>
    <span class="token punctuation">{</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>li className<span class="token operator">=</span><span class="token string">&quot;list-li&quot;</span> key<span class="token operator">=</span><span class="token punctuation">{</span>i<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">...</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>InfiniteScroll<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
</code></pre></div><p>此时功能已经开发完成，具体代码查看 👉<a href="https://github.com/kinyaying/wokoo/blob/master/example/zhihu-helper/src/app.js" target="_blank" rel="noopener noreferrer">app.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="三、部署插件到油猴商店">三、部署插件到油猴商店</h2> <p><strong>3.1 构建</strong></p> <p>执行命令</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> run build
</code></pre></div><p><strong>3.2 确认油猴脚本文件tampermonkey.js</strong></p> <p>此文件中被注释掉的//@xxx 都有含义，可以对应着 <a href="https://www.tampermonkey.net/documentation.php?version=4.6&amp;ext=dhdg" target="_blank" rel="noopener noreferrer">tampermonkey开发文档 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 理解。</p> <ul><li><p>@description 插件描述</p></li> <li><p>@match 指定某些域名下开启此插件，默认配了两条，<code>// @match https://*/*</code>和<code>// @match https://*/*</code>表示在所有域名下都开启。但是此处希望只在zhihu专栏里使用此插件，所以要修改@math字段。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @match        https://zhuanlan.zhihu.com/*</span>
<span class="token comment">// @match        https://www.zhihu.com/column/*</span>
</code></pre></div></li> <li><p>@require 油猴脚本内部帮忙引入第三方资源，比如jquery，react等。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @require https://unpkg.com/react@17/umd/react.production.min.js</span>
<span class="token comment">// @require https://unpkg.com/react-dom@17/umd/react-dom.production.min.js</span>
</code></pre></div></li></ul> <p><strong>3.3 发布插件到油猴市场</strong></p> <p>发布油猴市场的优点是不用审核，即发即用，非常方便。</p> <ol><li>将/dist/app.bundle.js 文件部署到 cdn 上，获取到对应 url。</li></ol> <p><strong>注意：</strong></p> <ul><li><p>js文件可放到 github 上，如果托管到 github 上最好做 cdn 加速（我使用cdn.jsdelivr.net进行cdn加速）。</p></li> <li><p>如果没有cdn服务器可跳过此步骤，在步骤4直接将app.bundle.js复制到油猴脚本编辑器中</p></li></ul> <ol start="2"><li><p>登录<a href="https://greasyfork.org/" target="_blank" rel="noopener noreferrer">油猴市场<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，谷歌账号或 github 账号都可使用。</p></li> <li><p>点击账号名称，再点击「发布你编写的脚本」</p></li></ol> <img width="100%" src="/assets/img/tampermonkey/wokoo-tamp3.png"> <img width="100%" src="/assets/img/tampermonkey/wokoo-tamp4.png"> <ol start="4"><li><p>进入编辑页，将 tampermonkey.js 里的内容复制到编辑框中</p> <p>注意：</p> <ul><li><p>步骤1中如果托管了cdn，需要将代码中的<code>localhost:8080</code>网址替换成静态资源 url</p></li> <li><p>步骤1中没有托管cdn，不能直接将/dist/app.bundle.js文件里的内容复制编辑框。因为编辑框内代码有最大限制，我们构建的app.bundle.js把react等三方库构建进去超过最大限制了。</p> <p>需要对构建结果进行拆包</p> <p>4.1 修改  tampermonkey.js ，通过@require方式引入react和react-dom</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ==UserScript==</span>
<span class="token comment">// @name         zhihu-helper</span>
<span class="token comment">// @namespace    http://tampermonkey.net/</span>
<span class="token comment">// @version      0.0.1</span>
<span class="token comment">// @description  知乎目录</span>
<span class="token comment">// @author       xx</span>
<span class="token comment">// @match        https://zhuanlan.zhihu.com/*</span>
<span class="token comment">// @match        https://www.zhihu.com/column/*</span>
<span class="token comment">// @require https://unpkg.com/react@17/umd/react.production.min.js</span>
<span class="token comment">// @require https://unpkg.com/react-dom@17/umd/react-dom.production.min.js</span>

<span class="token comment">// ==/UserScript==</span>

<span class="token comment">// app.bundle.js构建好的代码</span>
</code></pre></div><p>4.2 修改webpack.config.base.js的entry字段</p> <div class="language-js extra-class"><pre class="language-js"><code>entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    app<span class="token operator">:</span> <span class="token string">'/src/index.js'</span><span class="token punctuation">,</span>
    vendor<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 将react和react-dom这些单独打包出来，减小打包文件体积</span>
      <span class="token string">'react'</span><span class="token punctuation">,</span>
      <span class="token string">'react-dom'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>4.3 重新执行<code>npm run build</code> 构建出新的app.bundle.js，复制到油猴市场的编辑框内。</p></li></ul></li></ol> <img width="100%" src="/assets/img/tampermonkey/zhihu-tampermonkey.png"> <ol start="5"><li>点击 「发布脚本」即可</li></ol></div></article> <section class="post-meta main-div" data-v-12a4d4fc><section class="post-date clearfix" data-v-12a4d4fc><span class="create-date" data-v-12a4d4fc>
      发布于 : 2021-02-02
    </span> <span class="update-date" data-v-12a4d4fc>
      修改于 : 2021-11-15
    </span></section> <section class="post-links" data-v-12a4d4fc><a href="/posts/2021/02/26/react-basics.html" class="post-link" data-v-12a4d4fc>
      下一篇 : react基础知识
    </a> <a href="/posts/2020/10/13/seek.html" class="post-link" data-v-12a4d4fc>
      上一篇 : 查找
    </a></section></section> <div id="post-comments" class="main-div"><!----></div></div></main> <aside class="aside" data-v-0874e876><div class="info-card main-div" data-v-2bd66a30 data-v-0874e876><div class="info-card-header" data-v-2bd66a30><img src="https://www.mamingjuan.cn/assets/img/avatar.jpeg" alt="Glitr" class="info-avatar" data-v-2bd66a30></div> <div class="info-card-body" data-v-2bd66a30><section class="info-nickname" data-v-2bd66a30>
      Glitr
    </section> <section class="info-desc" data-v-2bd66a30>Enjoy coding,<br/>Enjoy life:)</section> <section class="info-contact" data-v-2bd66a30><section data-v-2bd66a30><span title="Beijing City, China" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>Beijing City, China</title><use xlink:href="#icon-location" data-v-2bd66a30 data-v-2bd66a30></use></svg><span class="info-text" data-v-2bd66a30 data-v-2bd66a30>
          Beijing City, China
        </span></span></section> <section data-v-2bd66a30><span title="Secrecy" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>Secrecy</title><use xlink:href="#icon-organization" data-v-2bd66a30 data-v-2bd66a30></use></svg><span class="info-text" data-v-2bd66a30 data-v-2bd66a30>
          Secrecy
        </span></span></section> <section data-v-2bd66a30><a href="mailto:glitteringma@gmail.com" title="glitteringma@gmail.com" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>glitteringma@gmail.com</title><use xlink:href="#icon-email" data-v-2bd66a30 data-v-2bd66a30></use></svg><span class="info-text" data-v-2bd66a30 data-v-2bd66a30>
          glitteringma@gmail.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-2bd66a30><section class="info-sns clearfix" data-v-2bd66a30><a href="https://github.com/happy760690" target="_blank" class="sns-link" data-v-2bd66a30><span title="GitHub: glitzma" class="sns-icon" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1.5em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>GitHub: glitzma</title><use xlink:href="#icon-github" data-v-2bd66a30 data-v-2bd66a30></use></svg></span></a><a href="https://twitter.com/x0BKGuGTNoqZ0F7" target="_blank" class="sns-link" data-v-2bd66a30><span title="Twitter: x0BKGuGTNoqZ0F7" class="sns-icon" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1.5em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>Twitter: x0BKGuGTNoqZ0F7</title><use xlink:href="#icon-twitter" data-v-2bd66a30 data-v-2bd66a30></use></svg></span></a><a href="https://www.instagram.com/glitz9558/?hl=en" target="_blank" class="sns-link" data-v-2bd66a30><span title="Instagram: glitz9558" class="sns-icon" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1.5em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>Instagram: glitz9558</title><use xlink:href="#icon-instagram" data-v-2bd66a30 data-v-2bd66a30></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-0874e876><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span>文章目录</span> <div class="post-nav-toc"><ul><li><a href="/posts/2021/02/02/chrome-plugin.html#说明">说明</a></li><li><a href="/posts/2021/02/02/chrome-plugin.html#手把手教搭建过程">手把手教搭建过程</a></li><li><a href="/posts/2021/02/02/chrome-plugin.html#wokoo-scripts编写">wokoo-scripts编写</a></li><li><a href="/posts/2021/02/02/chrome-plugin.html#wokoo-template编写">wokoo-template编写</a></li><li><a href="/posts/2021/02/02/chrome-plugin.html#发布wokoo">发布wokoo</a></li><li><a href="/posts/2021/02/02/chrome-plugin.html#wokoo使用">wokoo使用</a><ul><li><a href="/posts/2021/02/02/chrome-plugin.html#_1-1-项目安装-初始化配置">1.1 项目安装 &amp; 初始化配置</a></li><li><a href="/posts/2021/02/02/chrome-plugin.html#_1-2-开发基本功能">1.2 开发基本功能</a></li></ul></li><li><a href="/posts/2021/02/02/chrome-plugin.html#三、部署插件到油猴商店">三、部署插件到油猴商店</a></li></ul></div></div> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/posts/2021/02/02/chrome-plugin.html#post-comments">
      评论
    </a></div></div></aside></div> <footer class="footer" data-v-e3c69672><p class="sns-links" data-v-e3c69672><a href="https://github.com/happy760690" target="_blank" class="sns-link" data-v-e3c69672><span title="GitHub: glitzma" class="sns-icon" data-v-e3c69672 data-v-e3c69672><svg class="icon" style="font-size:25px;" data-v-e3c69672 data-v-e3c69672><title data-v-e3c69672 data-v-e3c69672>GitHub: glitzma</title><use xlink:href="#icon-github" data-v-e3c69672 data-v-e3c69672></use></svg></span></a><a href="https://twitter.com/x0BKGuGTNoqZ0F7" target="_blank" class="sns-link" data-v-e3c69672><span title="Twitter: x0BKGuGTNoqZ0F7" class="sns-icon" data-v-e3c69672 data-v-e3c69672><svg class="icon" style="font-size:25px;" data-v-e3c69672 data-v-e3c69672><title data-v-e3c69672 data-v-e3c69672>Twitter: x0BKGuGTNoqZ0F7</title><use xlink:href="#icon-twitter" data-v-e3c69672 data-v-e3c69672></use></svg></span></a><a href="https://www.instagram.com/glitz9558/?hl=en" target="_blank" class="sns-link" data-v-e3c69672><span title="Instagram: glitz9558" class="sns-icon" data-v-e3c69672 data-v-e3c69672><svg class="icon" style="font-size:25px;" data-v-e3c69672 data-v-e3c69672><title data-v-e3c69672 data-v-e3c69672>Instagram: glitz9558</title><use xlink:href="#icon-instagram" data-v-e3c69672 data-v-e3c69672></use></svg></span></a></p> <div class="copyright" data-v-e3c69672>
    © 2014 –
    <span itemprop="copyrightYear" data-v-e3c69672>2021</span> <span class="post-meta-divider" data-v-e3c69672>|</span> <span itemprop="copyrightHolder" class="author" data-v-e3c69672>Glitr</span></div></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app~d0ae3f07.7ae9fe33.js" defer></script><script src="/assets/js/9.d80ec364.js" defer></script><script src="/assets/js/39.6d3334f8.js" defer></script><script src="/assets/js/app~db300d2f.43f6a87c.js" defer></script>
  </body>
</html>
