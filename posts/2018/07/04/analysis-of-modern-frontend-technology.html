<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>现在前端技术解析读后感 | 马明娟</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="This is my blog">
    
    <link rel="preload" href="/assets/css/0.styles.acb7b805.css" as="style"><link rel="preload" href="/assets/js/app~d0ae3f07.acb7b805.js" as="script"><link rel="preload" href="/assets/css/styles.8cf06c55.css" as="style"><link rel="preload" href="/assets/js/app~db300d2f.8cf06c55.js" as="script"><link rel="preload" href="/assets/css/9.styles.b58e7c8c.css" as="style"><link rel="preload" href="/assets/js/9.b58e7c8c.js" as="script"><link rel="preload" href="/assets/js/81.68d4ec15.js" as="script"><link rel="prefetch" href="/assets/css/10.styles.ec9d1688.css"><link rel="prefetch" href="/assets/css/2.styles.898232b5.css"><link rel="prefetch" href="/assets/css/3.styles.8acdd097.css"><link rel="prefetch" href="/assets/css/4.styles.35401f2b.css"><link rel="prefetch" href="/assets/css/5.styles.c499630f.css"><link rel="prefetch" href="/assets/css/6.styles.c4a89d24.css"><link rel="prefetch" href="/assets/css/7.styles.63d3ab20.css"><link rel="prefetch" href="/assets/css/8.styles.8108d241.css"><link rel="prefetch" href="/assets/js/10.ec9d1688.js"><link rel="prefetch" href="/assets/js/100.cc9a575d.js"><link rel="prefetch" href="/assets/js/101.97781d27.js"><link rel="prefetch" href="/assets/js/102.9e3c1205.js"><link rel="prefetch" href="/assets/js/103.8006bc71.js"><link rel="prefetch" href="/assets/js/104.1f210ceb.js"><link rel="prefetch" href="/assets/js/105.30b6fe36.js"><link rel="prefetch" href="/assets/js/106.2adae347.js"><link rel="prefetch" href="/assets/js/107.a3424fec.js"><link rel="prefetch" href="/assets/js/108.20c6d5d9.js"><link rel="prefetch" href="/assets/js/109.9d76da2c.js"><link rel="prefetch" href="/assets/js/11.6c1d38d9.js"><link rel="prefetch" href="/assets/js/110.125f20d2.js"><link rel="prefetch" href="/assets/js/111.23ecd526.js"><link rel="prefetch" href="/assets/js/112.4fb09f48.js"><link rel="prefetch" href="/assets/js/113.76f07fcc.js"><link rel="prefetch" href="/assets/js/114.060d6cf3.js"><link rel="prefetch" href="/assets/js/115.8781d48b.js"><link rel="prefetch" href="/assets/js/116.2d470b68.js"><link rel="prefetch" href="/assets/js/117.df053a5a.js"><link rel="prefetch" href="/assets/js/118.a2924127.js"><link rel="prefetch" href="/assets/js/119.30976ef0.js"><link rel="prefetch" href="/assets/js/12.b9ae8214.js"><link rel="prefetch" href="/assets/js/120.15abd251.js"><link rel="prefetch" href="/assets/js/121.87d54bc4.js"><link rel="prefetch" href="/assets/js/122.b4c5a2fc.js"><link rel="prefetch" href="/assets/js/123.14c033d1.js"><link rel="prefetch" href="/assets/js/124.bb39c58d.js"><link rel="prefetch" href="/assets/js/125.bbbb1c31.js"><link rel="prefetch" href="/assets/js/126.208b553e.js"><link rel="prefetch" href="/assets/js/127.bf95ca95.js"><link rel="prefetch" href="/assets/js/128.3d32f694.js"><link rel="prefetch" href="/assets/js/129.073474cf.js"><link rel="prefetch" href="/assets/js/13.61da442e.js"><link rel="prefetch" href="/assets/js/130.1eecf8a2.js"><link rel="prefetch" href="/assets/js/131.fc2ad263.js"><link rel="prefetch" href="/assets/js/132.9c18972a.js"><link rel="prefetch" href="/assets/js/133.a826723e.js"><link rel="prefetch" href="/assets/js/134.c7f2f924.js"><link rel="prefetch" href="/assets/js/135.e433b43f.js"><link rel="prefetch" href="/assets/js/136.8a828ee7.js"><link rel="prefetch" href="/assets/js/14.6d70c6ca.js"><link rel="prefetch" href="/assets/js/15.8c368c65.js"><link rel="prefetch" href="/assets/js/16.83e8aed7.js"><link rel="prefetch" href="/assets/js/17.a29b5fa4.js"><link rel="prefetch" href="/assets/js/18.ee471714.js"><link rel="prefetch" href="/assets/js/19.62b05862.js"><link rel="prefetch" href="/assets/js/2.898232b5.js"><link rel="prefetch" href="/assets/js/20.adce5504.js"><link rel="prefetch" href="/assets/js/21.93607b23.js"><link rel="prefetch" href="/assets/js/22.0e7d1282.js"><link rel="prefetch" href="/assets/js/23.052d43f2.js"><link rel="prefetch" href="/assets/js/24.d512ca1d.js"><link rel="prefetch" href="/assets/js/25.07707757.js"><link rel="prefetch" href="/assets/js/26.907b05b0.js"><link rel="prefetch" href="/assets/js/27.7a547ee8.js"><link rel="prefetch" href="/assets/js/28.017bd5f0.js"><link rel="prefetch" href="/assets/js/29.6f06d06c.js"><link rel="prefetch" href="/assets/js/3.8acdd097.js"><link rel="prefetch" href="/assets/js/30.c1ea282d.js"><link rel="prefetch" href="/assets/js/31.7c83cbf7.js"><link rel="prefetch" href="/assets/js/32.07bc189a.js"><link rel="prefetch" href="/assets/js/33.023d8786.js"><link rel="prefetch" href="/assets/js/34.739d1acb.js"><link rel="prefetch" href="/assets/js/35.afdff421.js"><link rel="prefetch" href="/assets/js/36.b063c22b.js"><link rel="prefetch" href="/assets/js/37.ed6c2e3a.js"><link rel="prefetch" href="/assets/js/38.c1e81f64.js"><link rel="prefetch" href="/assets/js/39.5c19653d.js"><link rel="prefetch" href="/assets/js/4.35401f2b.js"><link rel="prefetch" href="/assets/js/40.37ca0022.js"><link rel="prefetch" href="/assets/js/41.47c21fdd.js"><link rel="prefetch" href="/assets/js/42.73c818c1.js"><link rel="prefetch" href="/assets/js/43.b81f053e.js"><link rel="prefetch" href="/assets/js/44.df10e439.js"><link rel="prefetch" href="/assets/js/45.b87bb250.js"><link rel="prefetch" href="/assets/js/46.c45cdcc5.js"><link rel="prefetch" href="/assets/js/47.0ac040cb.js"><link rel="prefetch" href="/assets/js/48.16f873f7.js"><link rel="prefetch" href="/assets/js/49.2b298c9a.js"><link rel="prefetch" href="/assets/js/5.c499630f.js"><link rel="prefetch" href="/assets/js/50.6e1df6cc.js"><link rel="prefetch" href="/assets/js/51.3146ac08.js"><link rel="prefetch" href="/assets/js/52.269e7a99.js"><link rel="prefetch" href="/assets/js/53.1667373c.js"><link rel="prefetch" href="/assets/js/54.b2b268a4.js"><link rel="prefetch" href="/assets/js/55.ba08cd26.js"><link rel="prefetch" href="/assets/js/56.025c6636.js"><link rel="prefetch" href="/assets/js/57.d2255b37.js"><link rel="prefetch" href="/assets/js/58.a890fa6b.js"><link rel="prefetch" href="/assets/js/59.43859e29.js"><link rel="prefetch" href="/assets/js/6.c4a89d24.js"><link rel="prefetch" href="/assets/js/60.fbf3756b.js"><link rel="prefetch" href="/assets/js/61.69682e0c.js"><link rel="prefetch" href="/assets/js/62.27f94ed0.js"><link rel="prefetch" href="/assets/js/63.de1404b9.js"><link rel="prefetch" href="/assets/js/64.1296db6e.js"><link rel="prefetch" href="/assets/js/65.4a5d33e0.js"><link rel="prefetch" href="/assets/js/66.a56b07e1.js"><link rel="prefetch" href="/assets/js/67.a7b4f299.js"><link rel="prefetch" href="/assets/js/68.9e382db2.js"><link rel="prefetch" href="/assets/js/69.181faff5.js"><link rel="prefetch" href="/assets/js/7.63d3ab20.js"><link rel="prefetch" href="/assets/js/70.50d8b77b.js"><link rel="prefetch" href="/assets/js/71.ad9aed61.js"><link rel="prefetch" href="/assets/js/72.459d24ba.js"><link rel="prefetch" href="/assets/js/73.563a4ab0.js"><link rel="prefetch" href="/assets/js/74.07c22a4f.js"><link rel="prefetch" href="/assets/js/75.45ce6f81.js"><link rel="prefetch" href="/assets/js/76.b485a4a5.js"><link rel="prefetch" href="/assets/js/77.d1017cb2.js"><link rel="prefetch" href="/assets/js/78.a97d5e8c.js"><link rel="prefetch" href="/assets/js/79.e0418ba0.js"><link rel="prefetch" href="/assets/js/8.8108d241.js"><link rel="prefetch" href="/assets/js/80.3a6ebea7.js"><link rel="prefetch" href="/assets/js/82.67c5ad03.js"><link rel="prefetch" href="/assets/js/83.643ca670.js"><link rel="prefetch" href="/assets/js/84.885245ab.js"><link rel="prefetch" href="/assets/js/85.dfe6f35d.js"><link rel="prefetch" href="/assets/js/86.f641a425.js"><link rel="prefetch" href="/assets/js/87.a80a460c.js"><link rel="prefetch" href="/assets/js/88.9fc3fd2f.js"><link rel="prefetch" href="/assets/js/89.8701264f.js"><link rel="prefetch" href="/assets/js/90.9673669a.js"><link rel="prefetch" href="/assets/js/91.c2e16e43.js"><link rel="prefetch" href="/assets/js/92.290a5cc2.js"><link rel="prefetch" href="/assets/js/93.ba39d1bd.js"><link rel="prefetch" href="/assets/js/94.59715da0.js"><link rel="prefetch" href="/assets/js/95.e377ba5a.js"><link rel="prefetch" href="/assets/js/96.b4fa3c86.js"><link rel="prefetch" href="/assets/js/97.e2c00ce4.js"><link rel="prefetch" href="/assets/js/98.5498ace6.js"><link rel="prefetch" href="/assets/js/99.538b0d60.js">
    <link rel="stylesheet" href="/assets/css/0.styles.acb7b805.css"><link rel="stylesheet" href="/assets/css/styles.8cf06c55.css"><link rel="stylesheet" href="/assets/css/9.styles.b58e7c8c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-glitzma"><header class="header" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(/assets/img/header-image-04.jpg);" data-v-e4a0ebe0><div data-v-6654f004 data-v-e4a0ebe0><nav class="navbar" data-v-6654f004><div class="container" data-v-6654f004><a href="/" class="router-link-active" data-v-6654f004><span class="navbar-site-name" data-v-6654f004>
          马明娟
        </span></a> <div class="navbar-toggler" data-v-6654f004><svg class="icon" style="font-size:1.2em;" data-v-6654f004 data-v-6654f004><title data-v-6654f004 data-v-6654f004>menu</title><use xlink:href="#icon-menu" data-v-6654f004 data-v-6654f004></use></svg></div> <div class="navbar-links" data-v-6654f004><a href="/" class="navbar-link" data-v-6654f004>
            欢迎页
          </a><a href="/posts/" class="navbar-link router-link-active" data-v-6654f004>
            帖子
          </a><a href="/custom-pages/" class="navbar-link" data-v-6654f004>
            关于
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-6654f004></div></div> <div class="banner" data-v-e2d7da12 data-v-e4a0ebe0 data-v-e4a0ebe0><div class="container" data-v-e2d7da12><div class="center" data-v-e2d7da12></div></div></div></header> <div class="container clearfix show-aside" data-v-0874e876 data-v-0874e876><main class="main" data-v-0874e876><div class="post" data-v-0874e876 data-v-0874e876><section class="post-meta main-div" data-v-7f7ca342><section class="post-date clearfix" data-v-7f7ca342><span class="create-date" data-v-7f7ca342>
      发布时间 : 2018-07-04
    </span> <span class="update-date" data-v-7f7ca342>
      最后修改 : 2019-06-26
    </span></section> <section class="post-links" data-v-7f7ca342><a href="/posts/2018/06/27/cross-development.html" class="post-link" data-v-7f7ca342>
      上一篇 : 开发中请求接口跨域问题
    </a> <a href="/posts/2018/07/10/component-based.html" class="post-link" data-v-7f7ca342>
      下一篇 : 探索组件化相关课题遇到的问题
    </a></section></section> <article class="main-div"><div class="post-content content__default"><h2 id="简介">简介</h2> <p>这是一本以现代前端技术思想与理论为主要内容的书。前端技术发展迅速，涉及的技术点很多，我们往往需要阅读很多书籍才能理解前端技术的知识体系。<code>《现代前端技术解析》</code>在前端知识体系上做了很好的总结和梳理，涵盖了现代前端技术绝大部分的知识内容，起到一个启蒙作用，能帮助读者快速把握前端技术的整个脉络，培养更完善的体系化思维，掌握更多灵活的前端代码架构方法，使读者获得成为高级前端工程师或架构师所必须具备的思维和能力。</p> <h2 id="第一章">第一章</h2> <p>前后端开发模式的演变</p> <p>静态黄页 <code>==》</code> 服务器组装动态网页数据 <code>==》</code> 后端为主的MVC <code>==》</code> 前后端分离 <code>==》</code> 纯前端MV<code>*</code>为主、中间层直出 <code>==》</code> 前端Virtual DOM、MNV<code>*</code>、前后端同构</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 解释</span>
<span class="token comment">// MV* 分为：MVC、MVP、MVVM</span>
<span class="token comment">// 1. MVC（Model-View-Controller）</span>
<span class="token comment">// 2. MVP (Model-View-Presenter)</span>
<span class="token comment">// 3. MVVM</span>
</code></pre></div><h3 id="_1-1、mvc">1.1、MVC</h3> <blockquote><p>总结：</p> <ol><li>通过controller 根据前端条件调用不同的Model给View渲染不同的数据内容</li> <li>Controller 只进行修改操作指令的分发，数据 的渲染一般是在View层来完成</li></ol></blockquote> <p>MVC 可以认为是一种开发设计模式，其基本思路是将DOM交互的内容分为数据模型、视图和事件控制函数三个部分，并对它们进行统一管理。Model用来存放请求的数据结果和数据对象，View用于页面DOM的更新与修改，Controller则用于根据前端路由条件（例如不同的HASH路由）来调用不同的Model给View渲染不同的数据内容。常用页面路由的实现也很简单，代码如下，其主要思咱是让URL地址内容匹配对应的字符串然后进行相应的操作。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">get</span> <span class="token punctuation">(</span>match<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> url <span class="token operator">=</span> location<span class="token punctuation">.</span>href<span class="token punctuation">,</span>
            routeReg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>match<span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>routeReg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>rul<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'#index'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">_loadIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册hash含有#index 的路由执行对应的操作</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'#detail'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">_loadDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册hash含有#detail的路由执行对应的操作</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>另外我们也可以使用HTML5的pushState来实现路由。<code>history.pushState(state,title,url)</code>方法可以改变当前页面的url而不发生跳转，并将不同的state数据和对应的url对应起来。如果页面显示的内容是根据不同的数据状态来自动完成的，这样根据state的内容来加载不同的组件就很有用了。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>page<span class="token operator">:</span><span class="token string">'A'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'page A'</span><span class="token punctuation">,</span> <span class="token string">'a.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>history<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {page: 'A'}对象</span>

history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>page<span class="token operator">:</span> <span class="token string">'B'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'page B'</span><span class="token punctuation">,</span> <span class="token string">'b.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>history<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {page: 'B'}</span>

history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>page<span class="token operator">:</span> <span class="token string">'C'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'page C'</span><span class="token punctuation">,</span> <span class="token string">'c.html'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>history<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {page: 'C'}</span>
</code></pre></div><p>这里访问不同URL地址<code>a.html、b.html、c.html</code>,页面不会发生跳转刷新，而是改变了当前的<code>history.state</code>内容，我们使用<code>hisotry.state</code>数据的改变来动态改变页面DOM的内容这种方式来实现SPA就很方便了。</p> <p>使用路由后，如果将SPA中的每个路由或用户操作加载的页面内容都看成是一个组件，那么之前的做法是每个组件独立完成各自的数据请求操作、渲染和数据绑定，一旦组件多了，每个组件自行处理就会造成逻辑混乱。到了MVC里面，所有的组件数据请求、渲染、页面逻辑操作都分别使用<code>Model、View、Controller</code>来注册调用。通俗地讲，就像是组件交出了自己的控制权给统一的控制对象来调用一样。</p> <p><code>// 放图</code></p> <p>如上图所示，前端应用页面加载完成后，根据不同的用户操作，页面会执行不同的响应。例如用户操作或URL哈希改变时会去调用与之对应的ControllerA方法，ControllerA方法会请求获取对应的数据ModelA,ModelA很可能是前端AJAX请求返回的一个接口数据，然后将ModelA传递给视图模板ViewA并将最终内容渲染到浏览器中，这样就完成了用户的一次交互操作，用户下一次操作的过程也是一样的。同时如果用户的操作需要进行DOM结构修改，那么会传到到Controller中，通过Controller获取数据并控制View的更新。对其中的一个组件A的实现操作代码如下.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>A<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript">Controller<span class="token punctuation">.</span><span class="token constant">A</span><span class="token punctuation">.</span>event<span class="token punctuation">.</span>change</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> Controller <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Model <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> View <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

View<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> tpl <span class="token operator">=</span> <span class="token string">'&lt;input id=&quot;input&quot; type=&quot;text&quot; value=&quot;{{text}}&quot;&gt;&lt;span id=&quot;showText&quot;&gt;{{text}}&lt;/span&gt;'</span><span class="token punctuation">;</span>
    
    <span class="token comment">//调用模板渲染数据获取HTML片段    </span>
    <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>tpl<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> html<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Model<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    text<span class="token operator">:</span> <span class="token string">'ViewA 渲染完成'</span>
<span class="token punctuation">}</span>

Controller<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    View<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 用户操作一般通过改变Hash完成，并触发Controller来改变Model和View</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'window'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'hashChange'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        model<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text <span class="token operator">=</span> location<span class="token punctuation">.</span>hash<span class="token punctuation">;</span>
        View<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token comment">// 点击事件可以直接触发Controller改变Model并重新渲染view</span>
    self<span class="token punctuation">.</span>event<span class="token punctuation">[</span><span class="token string">'change'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        model<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">'新的ViewA渲染完成'</span><span class="token punctuation">;</span>
        View<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p>为了方便大家理解，这里采用了一个最直接的实现方式，而且没有对<code>A、B、C</code>组件进行单独管理，而是将它的调用内容分为<code>Controller、Model、View</code>并放在一起统一管理，相互之间的调用是直接进行的。成熟的MVC框架一般是通过事件监听或者观察者模式来实现的，这里只是为了让读者更好的理解MVC的原理。当然这样的组件如果多了也比较混乱。所以通过改进宋史以将页面分成不同的小模块来处理，同时考虑到代码复用性，因此可以使用继承的方式来定义这三个组件，继续以A组件为例，我们一般看到的主流MVC框架的组件定义代码如下。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>A<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token constant">A</span><span class="token punctuation">.</span>event<span class="token punctuation">.</span>change</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//可能有一个公用的Component基类</span>
<span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token constant">A</span> <span class="token operator">=</span> component<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    $el<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    model<span class="token operator">:</span> <span class="token punctuation">{</span>
        text<span class="token operator">:</span> <span class="token string">'viewA 渲染完成'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">View</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> tpl <span class="token operator">=</span> <span class="token string">'&lt;input id=&quot;input&quot; type=&quot;text&quot; value=&quot;{{text}}&quot;&gt;&lt;span id=&quot;showText&quot;&gt;{{text}}&lt;/span&gt;'</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 调用模板渲染数据获取HTML片段</span>
        <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>tpl<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">controller</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 调用model数据传入view中渲染内容</span>
        self<span class="token punctuation">.</span><span class="token function">view</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 用户操作一般通过Hash来出发Controller改变Model和View</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'window'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'hashchange'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>text <span class="token operator">=</span> localtion<span class="token punctuation">.</span>hash<span class="token punctuation">;</span>
          self<span class="token punctuation">.</span><span class="token function">view</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        <span class="token comment">// 点击事件可以直接触发Model改变并重新渲染View</span>
        self<span class="token punctuation">.</span>event<span class="token punctuation">[</span><span class="token string">'change'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">'新的ViewA渲染完成'</span><span class="token punctuation">;</span>
          self<span class="token punctuation">.</span><span class="token function">view</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>尽管这里写法不太一样，但实现的功能和上面一段代码是相同的。当Model或View复杂后，我们可以考虑将<code>Model、View、Controller</code>拆分成不同文件导入引用。这段代码就是MVC基础原型的设计和实现，需要注意的是，用户操作引起的DOM修改操作主要是通过Controller来直接控制的，但是Controller只进行修改操作指令的分发，数据的渲染一般是在View层来完成。</p> <h3 id="_1-2-mvp">1.2 MVP</h3> <blockquote><p>总结：</p> <ol><li>MVP 中的Presenter与controller有点相似，但不同的是，用户在进行DOM修改操作时通过View上的行为触发修改通知给Presenter完后Model修改和其它View的更新，Presenter和View的操作绑定通常是双向的，View的改变一般会触发Presenter的动作，Presenter的动作也会改变View</li> <li>View 与 Model 只用于提供视图模板和数据而不做任何逻辑的处理，Presenter负责逻辑操作，职责清晰。但这样Presenter层的内容就可能变得很重了，另外用户在View上操作会反馈到Presenter中进行Model修改，并更新其它对应部分的View内容</li></ol></blockquote> <p>MVP和MVC一样，M就是Model，V就是View,而p代表Presenter,它与Controller有点相似，但不同的是，用户在进行DOM修改操作时将通过View上的行为出发，然后将修改通知给Presenter来完成后面的Model修改和其它的View的更新，而MVC模式下，用户的操作是直接通过Controller来控制的，Presenter和View的操作绑定通常是双向的，View的改变一般会触发Presenter的动作，Presenter的动作也会改变View。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>A<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token constant">A</span><span class="token punctuation">.</span>event<span class="token punctuation">.</span>change</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 可能有一个公用的Component基类</span>
<span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token constant">A</span> <span class="token operator">=</span> component<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
$el<span class="token operator">:</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
model<span class="token operator">:</span><span class="token punctuation">{</span>
    text<span class="token operator">:</span> <span class="token string">'ViewA 渲染完成'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
view<span class="token operator">:</span> <span class="token string">'&lt;input id=&quot;input&quot; type=&quot;text&quot; value=&quot;{{text}}&quot;&gt;&lt;span id=&quot;showText&quot;&gt;{{text}}&lt;span&gt;'</span><span class="token punctuation">,</span>
<span class="token function">presenter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 调用模板渲染数据获取HTML片段</span>
    <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>view<span class="token punctuation">,</span>self<span class="token punctuation">.</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// View上的改变将通知Presenter改变Model和其它的View</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      html <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'{{text}}'</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#showText'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Controller上的操作处理和MVC的方式类似</span>
    self<span class="token punctuation">.</span>event<span class="token punctuation">[</span><span class="token string">'change'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">'新的ViewA渲染完成'</span><span class="token punctuation">;</span>
        html <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'{{text}}'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#showText'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可以看出,这时View和Model主要用于提供视图模板和数据而不做任何逻辑处理，这是有好处的，因为我们现在只要关注Presenter上面的逻辑操作就可以了，它的职责很清晰，Presenter作为为间部分连接Model和View的通信交互完成所有的逻辑操作，但这样Presenter层的仙鹤就可能变得很重了。另外用户在View上的操作会反馈到Presenter中进行Model修改，并更新其它对应部分的View内容。</p> <h3 id="_1-3-mvvm-模式">1.3 MVVM 模式</h3> <p>MVVM则可以认为是一个自动化的MVP框架，并且使用ViewModel代替了Presenter，即数据Model的调用和模板内容的渲染不需要我们主动操作，而是ViewModel自动来触发完成，任何用户的操作也都是通过ViewModel的改变来驱动的。</p> <p>MVVM设计的一个很大的好处是将MVP中的Presenter的工作拆分成多个小的指令步骤，然后绑定到相对应的元素中，根据相对应的数据变化来驱动出发，自动管理交互操作，同时也免去了查看Presenter中事件列表的工作，而且一般ViewModel初始化时会自动进行数据绑定，并将页面中所有的同类操作复用，大大节省了我们自己进行内容渲染和事件绑定的代码。用MVVM模式实现的代码如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>A<span class="token punctuation">&quot;</span></span> <span class="token attr-name">q-on</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>click: change<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">q-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">q-html</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> viewModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VM</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    $el<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
        text<span class="token operator">:</span> <span class="token string">'View 渲染完成'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">'新的ViewA渲染完成'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>整体上简洁了很多，模板数据的渲染和数据绑定可以通过q-html或q-click等特殊的属性来控制完成，这些特殊的元素标签属性就是我们所说的Directive,当然不同的MVVM框架作用的Directive前缀不一样，但作用是类似的。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">q-html</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">q-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">q-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">q-mydo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>number | getValue<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">q-on</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>click: submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> viewModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VM</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    $el<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'form'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
        label<span class="token operator">:</span> <span class="token string">'用户名'</span><span class="token punctuation">,</span>
        value<span class="token operator">:</span> <span class="token string">'输入初始值'</span><span class="token punctuation">,</span>
        number<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">submit</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// doSubmit</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    directive<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">mydo</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    filter<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">getValue</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">++</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在这段代码中，ViewModel初始化时自动进行了数据填充、数据双向绑定和事件绑定。我们再来看一下执行new VM()时进行ViewModel初始化所完成的事情。</p> <p>首先javaScript会找到<code>document.getElementById('form')</code>这个元素并开始扫描元素节点，对这个元素的属性节点attributes和所有子节点中的attributes进行便利，一旦便利到名称中含有q-开头的属性时，就认为是MVVM框架定义的Directive,此时会执行相对应的操作。例如便利到q-html=&quot;label&quot;时，就将ViewModel初始化时默认数据对象data中的label值赋给这个元素的innerHTML;遍历到<code>q-on=&quot;click:submit&quot;</code>时，就在这个元素上绑定click事件，事件函数名为submit;也可以自定义<code>q-mydo</code>的指令，便利到该节点属性时，调用Directive中的mydo方法，输入参数为data中getValue方法的返回值，这里getValue()将输入number值自动加1并返回，getValue函数则一般被称为过滤器。用户在View层操作时会自动改变改变ViewModel的数据，然后ViewModel会检测数据变化，重新遍历扫描节点属性，执行对应的Directive,渲染HTML视图或做事件绑定。</p> <p>这里还要知道的是,q-开头的标签属性被称为指令，这是框架约定的，不同的框架约定的通常不一样，例如<code>ng-、v- 、ms-</code>，相信大家也见过甚至用过。这里ViewModel创建并进行视图渲染和事件绑定的过程非常简单，按照这个思路去扩充，我们就可以自己实现一个简单的MVVM框架了。当然完整的框架东西远比这要多，如含有丰富的<code>directive、filter、表达式、ViewModel</code>中完善的API，甚至包含一些浏览器兼容性处理等。</p> <p><code>directive、filter</code>具体是什么呢？我们结合MVVM框架设计的相关内容来具体了解一下。</p> <blockquote><p>Directive。 翻译为指令，简单地说就是自定义的执行函数，例如：<code>q-html、q-calss、q-on、q-show、q-attr</code>等封装了DOM的一些基本可复用性的操作函数API。</p></blockquote> <blockquote><p>Filter。 也叫过滤器，如<code>bool、upperCase、lowerCase</code>等，指用户希望对传入的初始数据进行处理，然后再将这个处理的结果交给Directive或下一个Filter.例如，ViewModel初始化时传入的是一个时间戳time转化为时间格式的Filter函数</p></blockquote> <blockquote><p>表达式设计。如if...else等，类似前端普通的页面模板表达式，其作用也是控制页面内容按照具体条件来显示</p></blockquote> <blockquote><p>ViewModel设计。是实现传入的Model数据在内在中存放的环节，通常ViewModel也会提供一些基本的操作API,方便开发者对数据进行读取或修改</p></blockquote> <blockquote><p>数据变更检测，我们上面讲到了MVVM通常是通过数据改变来驱动的，这样就需要进行数据的双向绑定。一般若要根据View层的变化来改变Model，是通过一些特殊元素（例如<code>&lt;input&gt;、&lt;select&gt;、&lt;textarea&gt;</code>等元素）的onchange事件来触发修改JavaScript中的ViewModel对象数据的内容来实现的，这点比较容易理解。另一方面是ViewModel修改，如何触发View的自动更新或得新渲染呢。这种根据数据的变化来自动触发其它操作的机制就是我们说的数据变更检测，实现数据变更检测的方法主要有手动触发绑定、脏数据检测、对象劫持、proxy等。下面来具体分析</p></blockquote> <h3 id="_1-3-1-数据变更检测示例">1.3.1 数据变更检测示例</h3> <h4 id="手动触发绑定">手动触发绑定</h4> <p>手动触发指令绑定是比较直接的实现方式，主要思路是通过在数据对象上定义get()方法和set()方法（当然也可以使用其它命名方法），调用时手动出发get()或set()函数来获取、修改数据，改变数据后会主动触发get()和get()函数中View层的重新渲染功能。前面提到了，根据视图View来驱动ViewModel变化的常见主要应用于<code>&lt;input&gt;、&lt;select&gt;、&lt;textarea&gt;</code>等元素中，当入内容变化时，通过监听DOM的change、select、keyup等事件来触发操作改变ViewModel的数据。我们来看一个简单的数据双向绑定的例子</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>data-binding-method-set<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">q-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>input<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">q-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>el<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">let</span> elems <span class="token operator">=</span> <span class="token punctuation">[</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'el'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    value<span class="token operator">:</span> <span class="token string">'hello'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 定义Directive</span>
<span class="token keyword">let</span> directive <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">text</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 数据绑定监听</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>addEventListener<span class="token punctuation">)</span><span class="token punctuation">{</span>
    elems<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">ViewModelSet</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>      
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    elems<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">'onkeyup'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">ViewModelSet</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 事件监听的第三个值,是可选的，默认为false，且只有在部分浏览器中支持，true表明该事件监听器绑定在捕获阶段（和目标阶段），false则表明绑定在冒泡阶段（和目标阶段）。</span>

<span class="token comment">// 开始扫描节点</span>
<span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//设置页面2秒后自动改变数据更新视图</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">ViewModelSet</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">,</span> <span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 扫描带指令的节点属性</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> elem <span class="token keyword">of</span> elems<span class="token punctuation">)</span><span class="token punctuation">{</span>
      elem<span class="token punctuation">.</span>directive <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> attr <span class="token keyword">of</span> elem<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>attr<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'q-'</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              <span class="token comment">// 调用属性指令</span>
              directive<span class="token punctuation">[</span>attr<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>elem<span class="token punctuation">,</span> data<span class="token punctuation">[</span>attr<span class="token punctuation">.</span>nodeValue<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              elem<span class="token punctuation">.</span>directive<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 设置数据改变后扫描节点</span>
<span class="token keyword">function</span> <span class="token function">ViewModelSet</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>通过浏览器加载执行这个页面结构，ViewModel的变化会自动改变输入框的内容，同样，输入内容的变化也会驱动ViewModel数据的变化。我们通过ViewModelSet()方法改变iewModel的数据后，需要主动调用scan()方法重新扫描HTML页面上的节点，并在需要的地方重新渲染HTML结构。</p> <h3 id="_1-3-2-脏检测机制">1.3.2 脏检测机制</h3> <blockquote><p>总结：
与手动触发绑定不同的是，脏检测只针对可能修改的元素进行扫描，这样提高了ViewModel内容变化后扫描视图渲染的效率</p></blockquote> <p>以典型的MVVM框架Angularjs为例，Angularjs是通过检查脏数据来进行View层操作更新的，但我们并不针对某个框架来分析脏数据检测的机制，因为成熟框架的实现考虑了很多全面的东西，比较复杂，我们需要的是通过简洁明了的代码演示脏数据检测的实现原理。脏检测的实现原理是在ViewModel对象的某个属性值发生变化时代到这个属性值相关的所有元素，然后再比较数据变化，如果变化则进行Directive指令调用，对这个元素进行重新扫描渲染。用这种方法实现上面的例，代码如下</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>data-binding-dirty-check<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">qg-event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">qg-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>input<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">qg-event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">qg-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>el<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">let</span> elems <span class="token operator">=</span> <span class="token punctuation">[</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'el'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token string">'hello'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 定义Directive</span>
    <span class="token keyword">let</span> directive <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">text</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> str<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 初始化扫描节点</span>

    <span class="token function">scan</span><span class="token punctuation">(</span>elems<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">$digest</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 输入框数据绑定监听
     */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>addEventListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        elems<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            data<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token function">$digest</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'qg-bind'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        elems<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">'onkeyup'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            data<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token function">$digest</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'qg-bind'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'hello world'</span><span class="token punctuation">;</span>
        <span class="token function">$digest</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">scan</span><span class="token punctuation">(</span><span class="token parameter">elems</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 扫描带指令的节点属性</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">let</span> elem <span class="token keyword">of</span> elems<span class="token punctuation">)</span><span class="token punctuation">{</span>
            elem<span class="token punctuation">.</span>directive <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 可以理解为数据劫持监听</span>
    <span class="token keyword">function</span> <span class="token function">$digest</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> list <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'[qg-bind='</span><span class="token operator">+</span> value <span class="token operator">+</span> <span class="token string">']'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">digest</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 脏数据循环检测</span>
    <span class="token keyword">function</span> <span class="token function">digest</span><span class="token punctuation">(</span><span class="token parameter">elems</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> elems<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> elem <span class="token operator">=</span> elems<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span>len1<span class="token operator">=</span> elem<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len1<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">let</span> attr <span class="token operator">=</span> elem<span class="token punctuation">.</span>attributes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>attr<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'qg-event'</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">// 调用属性指令</span>
                    <span class="token keyword">let</span> dataKey <span class="token operator">=</span> elem<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'qg-bind'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
                    <span class="token comment">// 进行脏数据检测,如果数据改变,则重新执行指令,否则跳过</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span> elem<span class="token punctuation">.</span>directive<span class="token punctuation">[</span>attr<span class="token punctuation">.</span>nodeValue<span class="token punctuation">]</span> <span class="token operator">!==</span> data<span class="token punctuation">[</span>dataKey<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        directive<span class="token punctuation">[</span>attr<span class="token punctuation">.</span>nodeValue<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>elem<span class="token punctuation">,</span>data<span class="token punctuation">[</span>dataKey<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 给DOM赋值</span>
                        elem<span class="token punctuation">.</span>directive<span class="token punctuation">[</span>attr<span class="token punctuation">.</span>nodeValue<span class="token punctuation">]</span> <span class="token operator">==</span> data<span class="token punctuation">[</span>dataKey<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>其实这里的和手动绑定扫描节点的方式类似，不同的是，脏检测只针对可能修改的元素进行扫描，这样就提高了ViewModel内容变化后扫描视图渲染的效率</p> <h3 id="_1-3-3-前端数据对象劫持-hijacking">1.3.3 前端数据对象劫持(Hijacking)</h3> <p>数据劫持是目前使用比较广泛的方式。其基本思路是使用 <code>Object.defineProperty</code>和<code>Object.defineProperies</code> 对ViewModel数据对象进行属性get()和set()的监听，当有数据读取和赋值操作时则扫描元素节点，运行指定对应节点的Directive指令，这样ViewModel使用通用的等号赋值就可以了。具体例子如下。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>data-binding-hijacking<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">q-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>input<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">q-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>el<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">let</span> elems <span class="token operator">=</span> <span class="token punctuation">[</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'el'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token string">'hello'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 定义Directive</span>
    <span class="token keyword">let</span> directive <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">text</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 初始化扫描节点</span>

    <span class="token keyword">let</span> bValue<span class="token punctuation">;</span>
    <span class="token function">scan</span><span class="token punctuation">(</span>elems<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 可以理解为数据劫持监听</span>
    <span class="token function">defineGetAndSet</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 输入框数据绑定监听
     */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>addEventListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        elems<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            data<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        elems<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">'onkeyup'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            data<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'hello world'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 扫描带指令的节点属性</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">let</span> elem <span class="token keyword">of</span> elems<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            elem<span class="token punctuation">.</span>directive <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">let</span> attr <span class="token keyword">of</span> elem<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>attr<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'q-'</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">// 调用属性指令</span>
                    directive<span class="token punctuation">[</span>attr<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>elem<span class="token punctuation">,</span> data<span class="token punctuation">[</span>attr<span class="token punctuation">.</span>nodeValue<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    elem<span class="token punctuation">.</span>directive<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 定义对象属性调协劫持</span>
    <span class="token keyword">function</span> <span class="token function">defineGetAndSet</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span>propName</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>propName<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> bValue<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                bValue <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
                <span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            configurable<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>需要注意的是,defineProperty只支持Internet Explorer 8 以上和Chrome等标准的浏览器，且Internet Explorer 8 浏览器中需要使用es5-shim 来提供支持。Firefox浏览器不支持该方法，需要使用<code>__defineGetter__</code>和<code>__defineSetter__</code>来代替，这里为了让大家理解其中的原理，所有直接使用了defineProperty来实现</p> <h3 id="_1-3-4-ecmascript-6-proxy">1.3.4 ECMAScript 6 Proxy</h3> <p>Proxy可以用于在已有对象基础上定义一个对象，并重新定义对象原型上的方法，包括get()方法和set()方法，同时我们也可以将它和defineProperty进行了比较自己学习一下，下面来看一下使用Proxy如何进行数据的变更检测。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>data-binding-proxy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">q-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>input<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">q-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>el<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

    <span class="token string">'use strict'</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> elems <span class="token operator">=</span> <span class="token punctuation">[</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'el'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 定义Directive</span>
    <span class="token keyword">let</span> directive <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">text</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 设置data的访问Proxy</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          target<span class="token punctuation">.</span>value<span class="token operator">=</span> value<span class="token punctuation">;</span>
          <span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    data<span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
    <span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 输入框数据绑定监听
     */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>addEventListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        elems<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            data<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        elems<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">'onkeyup'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            data<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'hello world'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 扫描带指令的节点属性</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">let</span> elem <span class="token keyword">of</span> elems<span class="token punctuation">)</span><span class="token punctuation">{</span>
            elem<span class="token punctuation">.</span>directive <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">let</span> attr <span class="token keyword">of</span> elem<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>attr<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'q-'</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">// 调用属性指令</span>
                    directive<span class="token punctuation">[</span>attr<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>elem<span class="token punctuation">,</span> data<span class="token punctuation">[</span>attr<span class="token punctuation">.</span>nodeValue<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    elem<span class="token punctuation">.</span>directive<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>attr<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这里通过简单的代码体现了MVVM双向数据绑定的基本原理，关于MVVM的数据变更检测介绍的比较多，因为可以认为这是MVVM设计实现的最关键的部分，如果处理得好会大大提升MVVM框架的效率，否则会有较多重复的元素扫描过程而拖累代码执行速度。到守里相信大家也对MVVM的设计原理有了较深的了解，自己可以实现一个类似的框架。</p> <p>总结来看，前端框架从直接DOM操作到MVC设计模式，然后到MVP，再到MVVM框架，前端设计模式的改进原则一直向着高效、易实现、易维护、易扩展的方向发展，虽然目前前端各类框架也已经成熟并开始向高版本迭代，但是还没有结束，我们现在的变成对象依然没有脱离DOM编程的基本套路，一次次框架的改进大大提高了开发效率，但是DOM元素运行的效率仍然没有变。要解决这个问题，就必须了解下一切中介绍的前端Virtual DOM.</p> <h2 id="_1-4-virtual-dom-交互模式">1.4 Virtual DOM 交互模式</h2> <h3 id="_1-4-1-virtual-dom设计理念">1.4.1 Virtual DOM设计理念</h3> <p>MVVM的前端交互模式大大提高了变成效率，自动双向数据绑定让我们可以将页面逻辑实现的核心转移到数据层的修改操作上，而不再是在页面中直接操作DOM。但实际上，通过上一切的内容可以看出，尽管MVVM改变了前端开发的逻辑方式，但是最终数据层反应到页面上View层的渲染和改变仍是通过对应的指令进行DOM操作来完成的，而且通常一次ViewModel的变化可能会触发页面上多个指令操作DOM的变化，带来大量页面结构层DOM操作或渲染。先来看下面这个应用场景</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">q-repeat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">q-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>固定文本<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> viewModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VM</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    $el<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
        list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>value<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>value<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>value<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>使用MVVM框架时就生成了一个数字列表,此时如果需要显示的内容变成了<code>[{value:0},{value:1},{value:2},{value:3}]</code>,在MVVM框架中一般会重新渲染整个列表，包括列表中无须改变的部分也会重新渲染一次。但实际上如果直接操作改变DOM的话，只需要在<code>&lt;ul&gt;</code>子元素前插入一个新的<code>&lt;li&gt;</code>元素就可以了。但在一般的MVVM框架中，我们通常不会这样做。毫无疑问，这种情况下MVVM的View层更新模式就消耗了更多没必要的性能</p> <p>那么该如何对ViewModel进行改进，让浏览器知道实际上只是增加了一个元素呢？通过对比两个数组，我们发现只了一个<code>{value:0}</code>,那么该怎样将这个的数据反映到View层上呢？我们可以这样想，将新的Model data和旧的Model data进行对比，然后记录ViewModel的方式和位置，就知道了这次View层应该怎样去更新，这样比直接重新渲染整个列表高效得多。</p> <p>这里其实可以理解为，ViewModel里的数据就是描述页面View内容的另一种数据结构标识，不过需要结合特定的MVVM描述语法编译来生成完整的DOM结构。根据差异性描述的对象，可以很执迷不悟就地创建出变更的DOM结构，完成这次HTML DOM结构的修改，而不是直接对整个更表重新渲染。</p> <p>Virtual DOM是一个能够直接描述一段HTML DOM的javascript对象，浏览器可以根据它的结构按照 一定规则创建出确定唯 一的HTML DOM。整体来看Virtual DOM 的交互模式减少了MVVM或其它框架中对DOM的扫描或操作次数，并且在数据发生改变后只在合适的地方根据JavaScript对象来进行最小化的页面DOM操作，避免大量重新渲染</p> <h3 id="_1-4-2-virtual-dom的核心实现">1.4.2 Virtual DOM的核心实现</h3> <p>核心操作可以抽象成三个步骤:创建Virtual DOM;对比两个Virtual DOM成生差异化 Virtual DOM ; 将差异化Virtual DOM 到页面上。</p> <div class="language- extra-class"><pre class="language-text"><code>1.创建Virtual DOM
    把一段HTML字符串文本解析成一个能够描述它的javascript 对象
    
    &lt;ul id=&quot;root&quot;&gt;
        &lt;li&gt;
            &lt;span&gt;1&lt;/span&gt;
            &lt;span&gt;固定文本&lt;/span&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
    
    let ulElement = {
        tagName: 'ul',
        attribute:[{
            id: 'root'
        }],
        children:[{
            tagName:'li',children:[{
                tagName: 'span',
                nodeText: 1
            },{
                tagName: 'span',
                nodeText: '固定文本'
           }]
        }]
    }
 2.对比Virtual DOM
 3.渲染差异化Virtual DOM
</code></pre></div><h2 id="_1-5-mnv-模式">1.5 MNV*模式</h2> <p>如果说Virtul DOM 减少了DOM的交互次数，那么<code>MNV*</code>想要做的一件事情就是完全抛弃使用DOM，而交互数据的操作依然可以使用<code>ViewModel、Virtual DOM</code>或者直接的Model来实现。这种模式目前只适用于移动端Hybrid应用，因为需要以来原生应用控件调用支持，而只有这种特殊的应用场景才满足条件。</p> <p>我们知道javaScript 可以借助通用协议来调用原生应用的方法，然后按照标准的JSBridge协议将Model和Directive封装成协议串<code>jsbridge://DOMRender:success/createView?{&quot;text&quot;:&quot;hello&quot;,&quot;element&quot;:&quot;TextView&quot;}</code>的形式，通过Prompt(android),IOS上使用iframe发送到客户端，这里调用的是解析DOMRender的creatView方法创建一个TextView,TextView是android原生系统上的一个内置文本控件的基类，和HTML的</p><p>标签类似，可以用来创建移动端上的一个文本域展示一段文字。此时客户端会解析到这段协议串，调用原生应用动态创建文本空间TextView的界面内容碎片(类似于HTML的文档碎片documentFragment或一段XML片段),这里Android中TextView的控件内容描述通过地XML规范。</p> <p>整体上设计实现一个Native渲染机制思路并不难，但是要实现好JavaScript端和Native端的封装，难度就比较大了。MNV*框架端的主要任务是解析Model、ViewModel或Virtual DOM 组成JSBridge协议串并发关，而Native端的实现将会比较复杂，而要处理不同的标签元素解析，例 如遇到<code>&lt;TextView&gt;</code>标签则创建TextView空间，遇到<code>&lt;Layout&gt;</code>标签创建Layout空间，还可能需要处理事件的绑定等，即将JavaScript事件通过Native事件来实现。整体上像是使用移动端原生的方式来解析HTML上需 要实现的就用功能。</p> <p><code>MNV*</code>的基本原理主要是将JSBridge和DOM变成的方式进行结合，让前端能够快速构建开发原生界面的应用，从而脱离DOM的交互模式。目前MNV*开发模式也正处一直一个推广应用极端，相信未来会更加普及。</p> <h2 id="到这里第一个话题终于说完了">到这里第一个话题终于说完了</h2> <h2 id="下面言归正传">下面言归正传</h2> <h2 id="_2-浏览器基础应用">2 浏览器基础应用</h2> <p>在介绍浏览器组成结构之前我们先来看一个经常被问到的问题：从我们打开浏览器输入一个网址到页面展示网面内容的这段时间内，浏览器和服务端发生了什么事情？我们直接来看一个相对简介但比较清晰的过程描述</p> <div class="language- extra-class"><pre class="language-text"><code>- 在接收到用户输入的网址后，浏览器会开启一个线程来处理这个请求，对用户输入的URL地址进行分析判断，如果是HTTP协议就按照HTTP方式来处理。
- 调用浏览器引擎中对应方法，比如WebView中的loadUrl方法，分木质并加载这个URL地址
- 通过DNS解析获取该网站地址对应的IP地址，查询完成后边同浏览器的Cookie、userAgent等信息向网站目的IP发出GET请求。
- 进行HTTP协议会话，浏览器客户端向Web服务器发送报文
- 进入网站后台上的Web服务器处理请求，如Apache、Tomcat、Node.js等服务器
- 进入部署好的后端应用，如PHP、java、JavaScript、Python等后端程序，找到对的请求处理逻辑，这期间可能会读取服务器缓存或查询数据库等。
- 服务器处理请求并回响应报文，此时如果浏览器访问过该页面，缓存上有对应资源，会与服务器最后修改记录对比，一致则返回304，否则返回200和对应的内容
- 浏览器开始下载HTML文档（响应报头状态码为200时）或者从本地缓存读取文件内容（浏览器缓存有效或相应报头状态码为304时）
- 浏览器根据下载接收到的HTML文件解析结构建立DOM(Document Object Model, 文档对象模型)文档树，并根据HTML中的标记请求下载指定的MIME类型文件（如CSS、JavaScript脚本等），同时设置缓存等内容
- 页面开始解析渲染DOM，CSS根据规则解析并结合DOM文档树进行网页内容布局和绘制渲染，JavaScript执行引擎、客户端存储等。下面，我们具体来看一个浏览器的主要结构
</code></pre></div></div></article> <section class="post-meta main-div" data-v-7f7ca342><section class="post-date clearfix" data-v-7f7ca342><span class="create-date" data-v-7f7ca342>
      发布时间 : 2018-07-04
    </span> <span class="update-date" data-v-7f7ca342>
      最后修改 : 2019-06-26
    </span></section> <section class="post-links" data-v-7f7ca342><a href="/posts/2018/06/27/cross-development.html" class="post-link" data-v-7f7ca342>
      上一篇 : 开发中请求接口跨域问题
    </a> <a href="/posts/2018/07/10/component-based.html" class="post-link" data-v-7f7ca342>
      下一篇 : 探索组件化相关课题遇到的问题
    </a></section></section> <div id="post-comments" class="main-div"><!----></div></div></main> <aside class="aside" data-v-0874e876><div class="info-card main-div" data-v-2bd66a30 data-v-0874e876><div class="info-card-header" data-v-2bd66a30><img src="https://www.mamingjuan.cn/assets/img/avatar.jpeg" alt="Glitr" class="info-avatar" data-v-2bd66a30></div> <div class="info-card-body" data-v-2bd66a30><section class="info-nickname" data-v-2bd66a30>
      Glitr
    </section> <section class="info-desc" data-v-2bd66a30>Enjoy coding,<br/>Enjoy life:)</section> <section class="info-contact" data-v-2bd66a30><section data-v-2bd66a30><span title="Beijing City, China" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>Beijing City, China</title><use xlink:href="#icon-location" data-v-2bd66a30 data-v-2bd66a30></use></svg><span class="info-text" data-v-2bd66a30 data-v-2bd66a30>
          Beijing City, China
        </span></span></section> <section data-v-2bd66a30><span title="Secrecy" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>Secrecy</title><use xlink:href="#icon-organization" data-v-2bd66a30 data-v-2bd66a30></use></svg><span class="info-text" data-v-2bd66a30 data-v-2bd66a30>
          Secrecy
        </span></span></section> <section data-v-2bd66a30><a href="mailto:glitteringma@gmail.com" title="glitteringma@gmail.com" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>glitteringma@gmail.com</title><use xlink:href="#icon-email" data-v-2bd66a30 data-v-2bd66a30></use></svg><span class="info-text" data-v-2bd66a30 data-v-2bd66a30>
          glitteringma@gmail.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-2bd66a30><section class="info-sns clearfix" data-v-2bd66a30><a href="https://github.com/happy760690" target="_blank" class="sns-link" data-v-2bd66a30><span title="GitHub: glitzma" class="sns-icon" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1.5em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>GitHub: glitzma</title><use xlink:href="#icon-github" data-v-2bd66a30 data-v-2bd66a30></use></svg></span></a><a href="https://twitter.com/x0BKGuGTNoqZ0F7" target="_blank" class="sns-link" data-v-2bd66a30><span title="Twitter: x0BKGuGTNoqZ0F7" class="sns-icon" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1.5em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>Twitter: x0BKGuGTNoqZ0F7</title><use xlink:href="#icon-twitter" data-v-2bd66a30 data-v-2bd66a30></use></svg></span></a><a href="https://www.instagram.com/glitz9558/?hl=en" target="_blank" class="sns-link" data-v-2bd66a30><span title="Instagram: glitz9558" class="sns-icon" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1.5em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>Instagram: glitz9558</title><use xlink:href="#icon-instagram" data-v-2bd66a30 data-v-2bd66a30></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-0874e876><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span>文章目录</span> <div class="post-nav-toc"><ul><li><a href="/posts/2018/07/04/analysis-of-modern-frontend-technology.html#简介">简介</a></li><li><a href="/posts/2018/07/04/analysis-of-modern-frontend-technology.html#第一章">第一章</a><ul><li><a href="/posts/2018/07/04/analysis-of-modern-frontend-technology.html#_1-1、mvc">1.1、MVC</a></li><li><a href="/posts/2018/07/04/analysis-of-modern-frontend-technology.html#_1-2-mvp">1.2 MVP</a></li><li><a href="/posts/2018/07/04/analysis-of-modern-frontend-technology.html#_1-3-mvvm-模式">1.3 MVVM 模式</a></li><li><a href="/posts/2018/07/04/analysis-of-modern-frontend-technology.html#_1-3-1-数据变更检测示例">1.3.1 数据变更检测示例</a></li><li><a href="/posts/2018/07/04/analysis-of-modern-frontend-technology.html#_1-3-2-脏检测机制">1.3.2 脏检测机制</a></li><li><a href="/posts/2018/07/04/analysis-of-modern-frontend-technology.html#_1-3-3-前端数据对象劫持-hijacking">1.3.3 前端数据对象劫持(Hijacking)</a></li><li><a href="/posts/2018/07/04/analysis-of-modern-frontend-technology.html#_1-3-4-ecmascript-6-proxy">1.3.4 ECMAScript 6 Proxy</a></li></ul></li><li><a href="/posts/2018/07/04/analysis-of-modern-frontend-technology.html#_1-4-virtual-dom-交互模式">1.4 Virtual DOM 交互模式</a><ul><li><a href="/posts/2018/07/04/analysis-of-modern-frontend-technology.html#_1-4-1-virtual-dom设计理念">1.4.1 Virtual DOM设计理念</a></li><li><a href="/posts/2018/07/04/analysis-of-modern-frontend-technology.html#_1-4-2-virtual-dom的核心实现">1.4.2 Virtual DOM的核心实现</a></li></ul></li><li><a href="/posts/2018/07/04/analysis-of-modern-frontend-technology.html#_1-5-mnv-模式">1.5 MNV*模式</a></li><li><a href="/posts/2018/07/04/analysis-of-modern-frontend-technology.html#到这里第一个话题终于说完了">到这里第一个话题终于说完了</a></li><li><a href="/posts/2018/07/04/analysis-of-modern-frontend-technology.html#下面言归正传">下面言归正传</a></li><li><a href="/posts/2018/07/04/analysis-of-modern-frontend-technology.html#_2-浏览器基础应用">2 浏览器基础应用</a></li></ul></div></div> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/posts/2018/07/04/analysis-of-modern-frontend-technology.html#post-comments">
      评论
    </a></div></div></aside></div> <footer class="footer" data-v-e361d3ee><p class="sns-links" data-v-e361d3ee><a href="https://github.com/happy760690" target="_blank" class="sns-link" data-v-e361d3ee><span title="GitHub: glitzma" class="sns-icon" data-v-e361d3ee data-v-e361d3ee><svg class="icon" style="font-size:25px;" data-v-e361d3ee data-v-e361d3ee><title data-v-e361d3ee data-v-e361d3ee>GitHub: glitzma</title><use xlink:href="#icon-github" data-v-e361d3ee data-v-e361d3ee></use></svg></span></a><a href="https://twitter.com/x0BKGuGTNoqZ0F7" target="_blank" class="sns-link" data-v-e361d3ee><span title="Twitter: x0BKGuGTNoqZ0F7" class="sns-icon" data-v-e361d3ee data-v-e361d3ee><svg class="icon" style="font-size:25px;" data-v-e361d3ee data-v-e361d3ee><title data-v-e361d3ee data-v-e361d3ee>Twitter: x0BKGuGTNoqZ0F7</title><use xlink:href="#icon-twitter" data-v-e361d3ee data-v-e361d3ee></use></svg></span></a><a href="https://www.instagram.com/glitz9558/?hl=en" target="_blank" class="sns-link" data-v-e361d3ee><span title="Instagram: glitz9558" class="sns-icon" data-v-e361d3ee data-v-e361d3ee><svg class="icon" style="font-size:25px;" data-v-e361d3ee data-v-e361d3ee><title data-v-e361d3ee data-v-e361d3ee>Instagram: glitz9558</title><use xlink:href="#icon-instagram" data-v-e361d3ee data-v-e361d3ee></use></svg></span></a></p> <p data-v-e361d3ee><span data-v-e361d3ee>Powered by </span> <a href="https://vuepress.vuejs.org" target="_blank" data-v-e361d3ee>
      Vuepress
    </a></p></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app~d0ae3f07.acb7b805.js" defer></script><script src="/assets/js/9.b58e7c8c.js" defer></script><script src="/assets/js/81.68d4ec15.js" defer></script><script src="/assets/js/app~db300d2f.8cf06c55.js" defer></script>
  </body>
</html>
