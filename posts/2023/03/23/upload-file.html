<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>上传下载文件方式总结 | 马明娟</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="This is my blog">
    
    <link rel="preload" href="/assets/css/2.styles.e26ea78c.css" as="style"><link rel="preload" href="/assets/js/app~748942c6.e26ea78c.js" as="script"><link rel="preload" href="/assets/css/1.styles.de89d32b.css" as="style"><link rel="preload" href="/assets/js/app~2a42e354.de89d32b.js" as="script"><link rel="preload" href="/assets/css/styles.0d1d678c.css" as="style"><link rel="preload" href="/assets/js/app~1f20a385.0d1d678c.js" as="script"><link rel="preload" href="/assets/css/10.styles.685e93e4.css" as="style"><link rel="preload" href="/assets/js/10.685e93e4.js" as="script"><link rel="preload" href="/assets/js/50.7cbf3300.js" as="script"><link rel="prefetch" href="/assets/css/11.styles.db3fb87b.css"><link rel="prefetch" href="/assets/css/3.styles.2479901d.css"><link rel="prefetch" href="/assets/css/4.styles.14853dcd.css"><link rel="prefetch" href="/assets/css/5.styles.510e7b60.css"><link rel="prefetch" href="/assets/css/6.styles.3df49180.css"><link rel="prefetch" href="/assets/css/7.styles.4b781894.css"><link rel="prefetch" href="/assets/css/8.styles.40feba35.css"><link rel="prefetch" href="/assets/css/9.styles.2f72d411.css"><link rel="prefetch" href="/assets/js/11.db3fb87b.js"><link rel="prefetch" href="/assets/js/12.e1359aa3.js"><link rel="prefetch" href="/assets/js/13.f1d238b7.js"><link rel="prefetch" href="/assets/js/14.da55c5a9.js"><link rel="prefetch" href="/assets/js/15.6d6d4578.js"><link rel="prefetch" href="/assets/js/16.d3d55c31.js"><link rel="prefetch" href="/assets/js/17.d1124b5c.js"><link rel="prefetch" href="/assets/js/18.4fbc7487.js"><link rel="prefetch" href="/assets/js/19.cb848ea1.js"><link rel="prefetch" href="/assets/js/20.103a21d0.js"><link rel="prefetch" href="/assets/js/21.a1f3d9ef.js"><link rel="prefetch" href="/assets/js/22.e68afee7.js"><link rel="prefetch" href="/assets/js/23.8cf1b22b.js"><link rel="prefetch" href="/assets/js/24.663b8b19.js"><link rel="prefetch" href="/assets/js/25.342bc72e.js"><link rel="prefetch" href="/assets/js/26.7179c0a7.js"><link rel="prefetch" href="/assets/js/27.46f14775.js"><link rel="prefetch" href="/assets/js/28.7afb20e0.js"><link rel="prefetch" href="/assets/js/29.58c20ca7.js"><link rel="prefetch" href="/assets/js/3.2479901d.js"><link rel="prefetch" href="/assets/js/30.5cd1972d.js"><link rel="prefetch" href="/assets/js/31.4cd3dfd6.js"><link rel="prefetch" href="/assets/js/32.8eaf2d9f.js"><link rel="prefetch" href="/assets/js/33.71e761e7.js"><link rel="prefetch" href="/assets/js/34.761eee2c.js"><link rel="prefetch" href="/assets/js/35.6dd74fa0.js"><link rel="prefetch" href="/assets/js/36.ac572cd7.js"><link rel="prefetch" href="/assets/js/37.7183c761.js"><link rel="prefetch" href="/assets/js/38.9ac94c8b.js"><link rel="prefetch" href="/assets/js/39.13de4603.js"><link rel="prefetch" href="/assets/js/4.14853dcd.js"><link rel="prefetch" href="/assets/js/40.6ac8dd39.js"><link rel="prefetch" href="/assets/js/41.2fb47fa7.js"><link rel="prefetch" href="/assets/js/42.9bb7ebd8.js"><link rel="prefetch" href="/assets/js/43.3a74ed6a.js"><link rel="prefetch" href="/assets/js/44.535cf951.js"><link rel="prefetch" href="/assets/js/45.56fac91b.js"><link rel="prefetch" href="/assets/js/46.c7323734.js"><link rel="prefetch" href="/assets/js/47.5f6abd5f.js"><link rel="prefetch" href="/assets/js/48.b8b122b3.js"><link rel="prefetch" href="/assets/js/49.e91b97b8.js"><link rel="prefetch" href="/assets/js/5.510e7b60.js"><link rel="prefetch" href="/assets/js/51.d78456ea.js"><link rel="prefetch" href="/assets/js/52.a67d5dd8.js"><link rel="prefetch" href="/assets/js/6.3df49180.js"><link rel="prefetch" href="/assets/js/7.4b781894.js"><link rel="prefetch" href="/assets/js/8.40feba35.js"><link rel="prefetch" href="/assets/js/9.2f72d411.js">
    <link rel="stylesheet" href="/assets/css/2.styles.e26ea78c.css"><link rel="stylesheet" href="/assets/css/1.styles.de89d32b.css"><link rel="stylesheet" href="/assets/css/styles.0d1d678c.css"><link rel="stylesheet" href="/assets/css/10.styles.685e93e4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-glitzma"><header class="header" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(/assets/img/header-image-03.jpg);" data-v-e4a0ebe0><div data-v-6654f004 data-v-e4a0ebe0><nav class="navbar" data-v-6654f004><div class="container" data-v-6654f004><a href="/" class="router-link-active" data-v-6654f004><span class="navbar-site-name" data-v-6654f004>
          马明娟
        </span></a> <div class="navbar-toggler" data-v-6654f004><svg class="icon" style="font-size:1.2em;" data-v-6654f004 data-v-6654f004><title data-v-6654f004 data-v-6654f004>menu</title><use xlink:href="#icon-menu" data-v-6654f004 data-v-6654f004></use></svg></div> <div class="navbar-links" data-v-6654f004><a href="/" class="navbar-link" data-v-6654f004>
            Home
          </a><a href="/posts/" class="navbar-link router-link-active" data-v-6654f004>
            Search
          </a><a href="/custom-pages/" class="navbar-link" data-v-6654f004>
            About
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-6654f004></div></div> <div class="banner" data-v-e2d7da12 data-v-e4a0ebe0 data-v-e4a0ebe0><div class="container" data-v-e2d7da12><div class="center" data-v-e2d7da12></div></div></div></header> <div class="container clearfix show-aside" data-v-0874e876 data-v-0874e876><main class="main" data-v-0874e876><div class="post" data-v-0874e876 data-v-0874e876><section class="post-meta main-div" data-v-12a4d4fc><section class="post-date clearfix" data-v-12a4d4fc><span class="create-date" data-v-12a4d4fc>
      发布于 : 2023-03-23
    </span> <span class="update-date" data-v-12a4d4fc>
      修改于 : 2023-03-29
    </span></section> <section class="post-links" data-v-12a4d4fc><!----> <a href="/posts/2022/03/10/leetcode-thinking.html" class="post-link" data-v-12a4d4fc>
      上一篇 : 常见的leetCode题目与解题思路
    </a></section></section> <article class="main-div"><div class="post-content content__default"><h1 id="上传下载文件方式总结">上传下载文件方式总结</h1> <h2 id="下载的方式">下载的方式</h2> <h3 id="直接下载的方式">直接下载的方式</h3> <h4 id="_1-通过a标签打开文件">1. 通过A标签打开文件</h4> <p>下载静态资源或者 api 返回文件流，对于异常处理没有什么要求的，都可以使用直接下载的方式。但是仅支持浏览器无法识别的文件。如果是浏览器支持的文件格式（如：txt、jpg、png、mp3）,就不会触发下载，而是直接用浏览器打开文件。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/static/example.json<span class="token punctuation">&quot;</span></span> <span class="token attr-name">download</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>A.json<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_2-通过js生成a标签下载文件衍生版本">2. 通过js生成A标签下载文件衍生版本</h4> <p>通过创建A标签实现下载，但这里顺便提到了通过blob方式下载以及ie浏览器下的兼容下载。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 如果传递了url通过url下载，也可通过blob下载文件
 * 传递的blob对象 eg. var blob = new Blob([content]);
 */</span>
<span class="token keyword">function</span> <span class="token function">download</span><span class="token punctuation">(</span>url <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> fileName <span class="token operator">=</span> <span class="token string">'未知文件'</span><span class="token punctuation">,</span> blob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> href <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      href <span class="token operator">=</span> url
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      href <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建下载的链接</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// IE11 &amp; Edge   </span>
    <span class="token comment">// IE10+</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>msSaveBlob <span class="token operator">&amp;&amp;</span> blob<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// IE hack; see http://msdn.microsoft.com/en-us/library/ie/hh779016.aspx</span>
      navigator<span class="token punctuation">.</span><span class="token function">msSaveBlob</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ieVersion &lt; 10</span>
    <span class="token comment">// ieVersion now returns a boolean for the</span>
    <span class="token comment">// sake of sanity. We just check `msSaveBlob` first.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ieVersion <span class="token operator">&amp;&amp;</span> ieVersion <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> frame <span class="token operator">=</span> <span class="token constant">D</span><span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span><span class="token punctuation">;</span>

      frame<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;text/html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;replace&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      frame<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
      frame<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      frame<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      frame<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">'SaveAs'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>

      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    a<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
    a<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'target'</span><span class="token punctuation">,</span> <span class="token string">'_blank'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*
      * download的属性是HTML5新增的属性
      * href属性的地址必须是非跨域的地址，如果引用的是第三方的网站或者说是前后端分离的项目(调用后台的接口)，这时download就会不起作用。
      * 如果是下载浏览器无法解析的文件，例如.exe,.xlsx..那么浏览器会自动下载，但是如果使用浏览器可以解析的文件，比如.txt,.png,.pdf....浏览器就会采取预览模式
      * 所以，对于.txt,.png,.pdf等的预览功能我们就可以直接不设置download属性(前提是后端响应头的Content-Type: application/octet-stream，如果为application/pdf浏览器则会判断文件为 pdf ，自动执行预览的策略)
      */</span>
    fileName <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'download'</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    a<span class="token punctuation">.</span>href <span class="token operator">=</span> href<span class="token punctuation">;</span>
    <span class="token comment">// 如果想设置编码格式的话，可以这样设置 a.setAttribute('href','data:text/plain;charset=utf-8, ' + encodeURIComponent(textInput)); 请参考 https://www.jiyik.com/tm/xwzj/web_3052.html 或者 https://www.twle.cn/t/19247</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    blob <span class="token operator">&amp;&amp;</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>href<span class="token punctuation">)</span> <span class="token comment">// 释放URL 对象</span>
    a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// IE: &quot;Access is denied&quot;; see: https://connect.microsoft.com/IE/feedback/details/797361/ie-10-treats-blob-url-as-cross-origin-and-denies-access</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>也可以用form形式下载文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> myForm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'form'</span><span class="token punctuation">)</span>
myForm<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>
myForm<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'target'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
myForm<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'method'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">)</span>
myForm<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'action'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>myForm<span class="token punctuation">)</span><span class="token punctuation">;</span>
myForm<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>顺便一提，下载想要的规格的图片</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">downloadImgURL</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">let</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  image<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;crossOrigin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;anonymous&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  image<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span> 
  image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> image<span class="token punctuation">.</span>width<span class="token punctuation">;</span> 
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> image<span class="token punctuation">.</span>height<span class="token punctuation">;</span> 
    <span class="token keyword">let</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>width<span class="token punctuation">,</span> image<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    canvas<span class="token punctuation">.</span><span class="token function">toBlob</span><span class="token punctuation">(</span><span class="token parameter">blob</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
      <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">let</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      a<span class="token punctuation">.</span>download <span class="token operator">=</span> name<span class="token punctuation">;</span> 
      a<span class="token punctuation">.</span>href <span class="token operator">=</span> url<span class="token punctuation">;</span> 
      a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      a<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用完释放URL对象 </span>
      <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-使用js直接下载">3. 使用js直接下载</h4> <p>对于浏览器可以识别的文件格式（txt、jpg、png、mp3），可以通过设置 Content-Disposition，告诉浏览器资源应该被下载到本地。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">URL</span> <span class="token operator">=</span> <span class="token string">'/static/example.json'</span>
<span class="token comment">// 方式1</span>
window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">;</span>
<span class="token comment">// 方式2</span>
window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">URL</span><span class="token punctuation">)</span>
</code></pre></div><p>一般后端后返回下面的头来告诉客户端，要下载的文件是二进制流的形式。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/octet-stream'</span><span class="token punctuation">,</span><span class="token comment">// 告诉浏览器这是一个二进制文件</span>
<span class="token string-property property">'Content-Disposition'</span><span class="token operator">:</span> <span class="token string">'attachment; filename='</span> <span class="token operator">+</span> name<span class="token comment">// 告诉浏览器这是一个需要下载的文件</span>
</code></pre></div><p>在常规的 HTTP 响应中，Content-Disposition 响应头指示回复的内容该以何种形式展示，是以内联的形式（即网页或者页面的一部分），还是以附件的形式下载并保存到本地。</p> <p>语法：</p> <div class="language-js extra-class"><pre class="language-js"><code>Content<span class="token operator">-</span>Disposition<span class="token operator">:</span> inline
Content<span class="token operator">-</span>Disposition<span class="token operator">:</span> attachment
Content<span class="token operator">-</span>Disposition<span class="token operator">:</span> attachment<span class="token punctuation">;</span> filename<span class="token operator">=</span><span class="token string">&quot;filename.jpg&quot;</span>
</code></pre></div><p>它的第一个参数可以是inline或者attachment。如果第一个参数是inline（默认值）则表示展示到网页中或者做为网页展示。如果第一个参数是attachment表示它应该被下载，大部分浏览器会出现一个保存为的对话框，如果提供了filename会用filename填充对话框的文件名。</p> <div class="language- extra-class"><pre class="language-text"><code>Content-Disposition: attachment; filename=&quot;filename.jpg&quot;
</code></pre></div><p>Content-Disposition可以触发“保存为”的对话框</p> <div class="language- extra-class"><pre class="language-text"><code>200 OK
Content-Type: text/html; charset=utf-8
Content-Disposition: attachment; filename=&quot;cool.html&quot;
Content-Length: 22

&lt;HTML&gt;Save me!&lt;/HTML&gt;
</code></pre></div><p>上面的响应，不会做为简单的html处理，大多数浏览器会企图以cool.html保存这个文件</p> <p>在HTML页面中通过POST请求发送Content-Type:multipart/form-data，下面是个例子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">POST</span> <span class="token operator">/</span>test<span class="token punctuation">.</span>html <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>
<span class="token literal-property property">Host</span><span class="token operator">:</span> example<span class="token punctuation">.</span>org
Content<span class="token operator">-</span>Type<span class="token operator">:</span> multipart<span class="token operator">/</span>form<span class="token operator">-</span>data<span class="token punctuation">;</span>boundary<span class="token operator">=</span><span class="token string">&quot;boundary&quot;</span>

<span class="token operator">--</span>boundary
Content<span class="token operator">-</span>Disposition<span class="token operator">:</span> form<span class="token operator">-</span>data<span class="token punctuation">;</span> name<span class="token operator">=</span><span class="token string">&quot;field1&quot;</span>

value1
<span class="token operator">--</span>boundary
Content<span class="token operator">-</span>Disposition<span class="token operator">:</span> form<span class="token operator">-</span>data<span class="token punctuation">;</span> name<span class="token operator">=</span><span class="token string">&quot;field2&quot;</span><span class="token punctuation">;</span> filename<span class="token operator">=</span><span class="token string">&quot;example.txt&quot;</span>

value2
<span class="token operator">--</span>boundary<span class="token operator">--</span>

</code></pre></div><p>关于如何自定义header，大家还是要知道一下的。</p> <p>本质上跟上述的<code>Content-Disposition</code>差不多，只是我们这里不使用默认的header，我们自己自定义一个response header，跟后端决定好编码方式返回，前端直接获取这个自定义header，然后使用对应的解码即可，如使用<code>decodeURIComponent</code>。
但是我们都要知道，在跨域的情况下，前端获取到的header只有默认的6个基本字段：<code>Cache-Control</code>、<code>Content-Language</code>、<code>Content-Type</code>、Expires、<code>Last-Modified</code>、Pragma。
所以你想要获取到别的header，需要后端配合，设置</p> <div class="language-js extra-class"><pre class="language-js"><code>Access<span class="token operator">-</span>Control<span class="token operator">-</span>Expose<span class="token operator">-</span>Headers<span class="token operator">:</span> Content<span class="token operator">-</span>Disposition<span class="token punctuation">,</span> custom<span class="token operator">-</span>header
</code></pre></div><p>这样，前端就能获取到对应暴露的header字段，需要注意的是，<code>Content-Disposition</code>也是需要暴露的。</p> <h3 id="文件流转blob对象下载">文件流转blob对象下载</h3> <p>虽说是讲blob下载，其实主要是讲怎么通过请求获取数据。请求接口的方式可以通过在header中携带token等方式，方便做鉴权操作。</p> <p>方式一，通过axios请求接口</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token string">&quot;download()&quot;</span><span class="token operator">&gt;</span>文件流转blob对象下载<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
 	<span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 		<span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
 			<span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://www.xxx.com/download'</span><span class="token punctuation">,</span>
 			<span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
 			<span class="token literal-property property">responseType</span><span class="token operator">:</span> <span class="token string">'blob'</span><span class="token punctuation">,</span>
 		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 			<span class="token keyword">const</span> fileName <span class="token operator">=</span> res<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>content<span class="token operator">-</span>disposition<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'filename='</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 			<span class="token keyword">const</span> filestream <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">;</span>  <span class="token comment">// 返回的文件流</span>
 			<span class="token comment">// {type: 'application/vnd.ms-excel'}指定对应文件类型为.XLS (.XLS的缩写就为application/vnd.ms-excel)</span>
 			<span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>filestream<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'application/vnd.ms-excel'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 			<span class="token keyword">const</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 			<span class="token keyword">const</span> href <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建下载连接</span>
		    a<span class="token punctuation">.</span>href <span class="token operator">=</span> href<span class="token punctuation">;</span>
		    a<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token function">decodeURL</span><span class="token punctuation">(</span>fileName <span class="token punctuation">)</span><span class="token punctuation">;</span>
		    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
	        a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下载完移除元素</span>
	        window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 释放掉blob对象</span>
 		<span class="token punctuation">}</span><span class="token punctuation">)</span>
 	<span class="token punctuation">}</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

</code></pre></div><p>方式二、通过XMLHttpRequest下载</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>loaded <span class="token operator">/</span> event<span class="token punctuation">.</span>total <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'arraybuffer'</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'readystatechange'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span> <span class="token operator">&amp;</span>amp<span class="token punctuation">;</span><span class="token operator">&amp;</span>amp<span class="token punctuation">;</span> xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取响应头主要获取附件名称</span>
        <span class="token keyword">var</span> contentDisposition <span class="token operator">=</span> xhr<span class="token punctuation">.</span><span class="token function">getResponseHeader</span><span class="token punctuation">(</span><span class="token string">'content-disposition'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取类型类型和编码</span>
        <span class="token keyword">var</span> contentType <span class="token operator">=</span> xhr<span class="token punctuation">.</span><span class="token function">getResponseHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 构造blob对象,具体看头部提供的链接地址</span>
        <span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> contentType
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取文件夹名</span>
        <span class="token keyword">var</span> regex <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">filename=[^;]*</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> matchs <span class="token operator">=</span> contentDisposition<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>matchs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            filename <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>matchs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            filename <span class="token operator">=</span> <span class="token operator">+</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.doc&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">var</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        a<span class="token punctuation">.</span>href <span class="token operator">=</span> url<span class="token punctuation">;</span>
        a<span class="token punctuation">.</span>download <span class="token operator">=</span> filename<span class="token punctuation">;</span>
        a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// dosomething</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>方式三、通过fetch方式下载</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> fileName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;no-cors&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">referrerPolicy</span><span class="token operator">:</span> <span class="token string">&quot;no-referrer&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> aElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          aElement<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;download&quot;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> href <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
          aElement<span class="token punctuation">.</span>href <span class="token operator">=</span> href<span class="token punctuation">;</span>
          aElement<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;_blank&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          aElement<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>方式四、通过FileReader文件流方式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">formData<span class="token punctuation">,</span> url<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 也可以使用POST方式，根据接口</span>
    xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">&quot;blob&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 返回类型blob</span>
    <span class="token comment">// 定义请求完成的处理函数，请求前也可以增加加载框/禁用下载按钮逻辑</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 请求完成</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 返回200</span>
        <span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">;</span>
        <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 转换为base64，可以直接放入a表情href</span>
        reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 转换完成，创建一个a标签用于下载</span>
          <span class="token keyword">var</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          a<span class="token punctuation">.</span>download <span class="token operator">=</span> name <span class="token operator">+</span> <span class="token string">&quot;.xls&quot;</span><span class="token punctuation">;</span>
          a<span class="token punctuation">.</span>href <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
          <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;body&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 修复firefox中无法触发click</span>
          a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
          <span class="token function">$</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 发送ajax请求</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="上传文件的方式">上传文件的方式</h2> <h3 id="_1-传统上传方式">1. 传统上传方式</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>upload-form<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>upload.php<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
　　　<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>upload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>upload<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
　　　<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Upload<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_2-formdata上传">2. formData上传</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 检查是否支持FormData</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>FormData<span class="token punctuation">)</span> <span class="token punctuation">{</span>　
　　<span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

　　<span class="token comment">// 建立一个upload表单项，值为上传的文件</span>
　　formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
　　<span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
　　xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'action'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
　　<span class="token comment">// 定义上传完成后的回调函数</span>
　　xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
　　　　<span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
　　　　　　console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'上传成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
　　　　<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
　　　　　　console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
　　　　<span class="token punctuation">}</span>
　　<span class="token punctuation">}</span><span class="token punctuation">;</span>
　　xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>关于formData不得不说一下，formData.append的参数只有三个，当设置value时只支持字符串类型和Blob类型</p> <p>The field's value. This can be a string or Blob (including subclasses such as File). If none of these are specified the value is converted to a string.</p> <h3 id="_3-拖拽上传">3. 拖拽上传</h3> <p>拖放文件的代码，主要是定义dragover、dragend和drop这三个事件。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>holder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">#holder</span> <span class="token punctuation">{</span>
　　border<span class="token punctuation">:</span> 10px dashed #ccc<span class="token punctuation">;</span>
　　width<span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
　　min-height<span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
　　margin<span class="token punctuation">:</span> 20px auto<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token selector">#holder.hover</span> <span class="token punctuation">{</span>
  　　border<span class="token punctuation">:</span> 10px dashed #0c0<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// 检查浏览器是否支持拖放上传。</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'draggable'</span> <span class="token keyword">in</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
　　<span class="token keyword">var</span> holder <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'holder'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
　　holder<span class="token punctuation">.</span><span class="token function-variable function">ondragover</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'hover'</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
　　holder<span class="token punctuation">.</span><span class="token function-variable function">ondragend</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
　　holder<span class="token punctuation">.</span><span class="token function-variable function">ondrop</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
　　　　event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
　　　　<span class="token keyword">this</span><span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
　　　　<span class="token keyword">var</span> files <span class="token operator">=</span> event<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files<span class="token punctuation">;</span>
　　　　<span class="token comment">// do something with files</span>
　　<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>参考连接：</p> <p>https://juejin.cn/post/6895599073676492807</p> <p>https://www.jianshu.com/p/7636d5c60a8d</p></div></article> <section class="post-meta main-div" data-v-12a4d4fc><section class="post-date clearfix" data-v-12a4d4fc><span class="create-date" data-v-12a4d4fc>
      发布于 : 2023-03-23
    </span> <span class="update-date" data-v-12a4d4fc>
      修改于 : 2023-03-29
    </span></section> <section class="post-links" data-v-12a4d4fc><!----> <a href="/posts/2022/03/10/leetcode-thinking.html" class="post-link" data-v-12a4d4fc>
      上一篇 : 常见的leetCode题目与解题思路
    </a></section></section> <div id="post-comments" class="main-div"><!----></div></div></main> <aside class="aside" data-v-0874e876><div class="info-card main-div" data-v-2bd66a30 data-v-0874e876><div class="info-card-header" data-v-2bd66a30><img src="https://www.mamingjuan.cn/assets/img/avatar.jpeg" alt="Glitr" class="info-avatar" data-v-2bd66a30></div> <div class="info-card-body" data-v-2bd66a30><section class="info-nickname" data-v-2bd66a30>
      Glitr
    </section> <section class="info-desc" data-v-2bd66a30>Enjoy coding,<br/>Enjoy life:)</section> <section class="info-contact" data-v-2bd66a30><section data-v-2bd66a30><span title="Beijing City, China" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>Beijing City, China</title><use xlink:href="#icon-location" data-v-2bd66a30 data-v-2bd66a30></use></svg><span class="info-text" data-v-2bd66a30 data-v-2bd66a30>
          Beijing City, China
        </span></span></section> <section data-v-2bd66a30><span title="Secrecy" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>Secrecy</title><use xlink:href="#icon-organization" data-v-2bd66a30 data-v-2bd66a30></use></svg><span class="info-text" data-v-2bd66a30 data-v-2bd66a30>
          Secrecy
        </span></span></section> <section data-v-2bd66a30><a href="mailto:glitteringma@gmail.com" title="glitteringma@gmail.com" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>glitteringma@gmail.com</title><use xlink:href="#icon-email" data-v-2bd66a30 data-v-2bd66a30></use></svg><span class="info-text" data-v-2bd66a30 data-v-2bd66a30>
          glitteringma@gmail.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-2bd66a30><section class="info-sns clearfix" data-v-2bd66a30><a href="https://github.com/happy760690" target="_blank" class="sns-link" data-v-2bd66a30><span title="GitHub: glitzma" class="sns-icon" data-v-2bd66a30 data-v-2bd66a30><svg class="icon" style="font-size:1.5em;" data-v-2bd66a30 data-v-2bd66a30><title data-v-2bd66a30 data-v-2bd66a30>GitHub: glitzma</title><use xlink:href="#icon-github" data-v-2bd66a30 data-v-2bd66a30></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-0874e876><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span>文章目录</span> <div class="post-nav-toc"><ul><li><a href="/posts/2023/03/23/upload-file.html#下载的方式">下载的方式</a><ul><li><a href="/posts/2023/03/23/upload-file.html#直接下载的方式">直接下载的方式</a></li><li><a href="/posts/2023/03/23/upload-file.html#文件流转blob对象下载">文件流转blob对象下载</a></li></ul></li><li><a href="/posts/2023/03/23/upload-file.html#上传文件的方式">上传文件的方式</a><ul><li><a href="/posts/2023/03/23/upload-file.html#_1-传统上传方式">1. 传统上传方式</a></li><li><a href="/posts/2023/03/23/upload-file.html#_2-formdata上传">2. formData上传</a></li><li><a href="/posts/2023/03/23/upload-file.html#_3-拖拽上传">3. 拖拽上传</a></li></ul></li></ul></div></div> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/posts/2023/03/23/upload-file.html#post-comments">
      评论
    </a></div></div></aside></div> <footer class="footer" data-v-ede90b42><p class="sns-links" data-v-ede90b42><a href="https://github.com/happy760690" target="_blank" class="sns-link" data-v-ede90b42><span title="GitHub: glitzma" class="sns-icon" data-v-ede90b42 data-v-ede90b42><svg class="icon" style="font-size:25px;" data-v-ede90b42 data-v-ede90b42><title data-v-ede90b42 data-v-ede90b42>GitHub: glitzma</title><use xlink:href="#icon-github" data-v-ede90b42 data-v-ede90b42></use></svg></span></a></p> <div class="copyright" data-v-ede90b42>
    © 2014 –
    <span itemprop="copyrightYear" data-v-ede90b42>2023</span> <span class="post-meta-divider" data-v-ede90b42>|</span> <span itemprop="copyrightHolder" class="author" data-v-ede90b42>Glitr</span></div></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app~748942c6.e26ea78c.js" defer></script><script src="/assets/js/10.685e93e4.js" defer></script><script src="/assets/js/50.7cbf3300.js" defer></script><script src="/assets/js/app~2a42e354.de89d32b.js" defer></script><script src="/assets/js/app~1f20a385.0d1d678c.js" defer></script>
  </body>
</html>
