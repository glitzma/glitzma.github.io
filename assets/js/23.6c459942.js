(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{339:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"nginx相关知识"}},[t._v("nginx相关知识")]),t._v(" "),s("h3",{attrs:{id:"系统"}},[t._v("系统")]),t._v(" "),s("p",[t._v("CENTOS>=7.0,位数 X64 CENTOS 7.2")]),t._v(" "),s("h4",{attrs:{id:"nginx优势"}},[t._v("nginx优势")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("IO多路复用 多个描述符的IO操作都能在一个线程里并发交替顺序完成，复用线程."),s("br"),t._v("\nNginx 在启动后，会有一个 master 进程和多个相互独立的 worker 进程。"),s("br"),t._v("\n接收来自外界的信号,向各worker进程发送信号,每个进程都有可能来处理这个连接。"),s("br"),t._v("\nmaster 进程能监控 worker 进程的运行状态，当 worker 进程退出后(异常情况下)，会自动启动新的 worker 进程。"),s("br"),t._v("\nworker 进程数，一般会设置成机器 cpu 核数。因为更多的worker 数，只会导致进程相互竞争 cpu，从而带来不必要的上下文切换。"),s("br"),t._v("\n使用多进程模式，不仅能提高并发率，而且进程之间相互独立，一个 worker 进程挂了不会影响到其他 worker 进程。")])]),t._v(" "),s("li",[s("p",[t._v("CPU亲和 把CPU内核和nginx的工作进程绑定在一起，让每个worker进程固定在一个CPU上执行，从而减少CPU的切换并提高缓存命中率，提高 性能")])]),t._v(" "),s("li",[s("p",[t._v("sendfile 零拷贝传输模式"),s("br"),t._v("\n默认配置下，Nginx 读取本地文件后，在进行网络传输时会先将硬盘文件从硬盘中读取到 Nginx 的文件缓冲区中，操作流程为:硬盘 → 内核文件缓冲区 → 应用缓冲区。然后将 Nginx 文件缓冲区的数据写入网络接口，操作流程：应用缓冲区 → 内核网络缓冲区 → 网络接口。")]),t._v(" "),s("p",[t._v("Nginx 的本地文件在进行网络传输的过程中，经历了上述读取与写入两个操作过程，两次操作都在内核缓冲区中存储了相同的数据。为了提高文件的传输效率，内核提供了零复制技术，该技术支持文件在内核缓冲区内直接交换打开的文件句柄，无须重复复制文件内容到缓冲区，则上述两个操作的流程变为：硬盘 → 内核文件缓冲区 → 内核网络缓冲区 → 网络接口。")]),t._v(" "),s("p",[t._v("零复制技术减少了文件的读写次数，提升了本地文件的网络传输速度。内核缓冲区的默认大小为 4096B。")])])]),t._v(" "),s("h4",{attrs:{id:"nginx版本"}},[t._v("nginx版本")]),t._v(" "),s("ul",[s("li",[t._v("Mainline version 开发版")]),t._v(" "),s("li",[t._v("Stable version 稳定版")]),t._v(" "),s("li",[t._v("Legacy versions 历史版本")])]),t._v(" "),s("p",[s("a",{attrs:{href:"http://nginx.org/en/download.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("nginx下载地址"),s("OutboundLink")],1),t._v(" "),s("a",{attrs:{href:"http://nginx.org/en/linux_packages.html#stable",target:"_blank",rel:"noopener noreferrer"}},[t._v("nginx linux package"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("CentOS下YUM安装"),s("br"),t._v("\n路径：/etc/yum.repos.d/nginx.repo"),s("br"),t._v("\n文件内容：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[nginx]\nname=nginx repo\nbaseurl=http://nginx.org/packages/centos/7/$basearch/\ngpgcheck=0\nenabled=1\n")])])]),s("p",[t._v("命令：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("yum install nginx -y\nnginx -v\nnginx -V\n")])])]),s("h3",{attrs:{id:"配置文件及用途"}},[t._v("配置文件及用途")]),t._v(" "),s("p",[t._v("查看配置文件和目录")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("rpm -ql nginx\n")])])]),s("p",[t._v("配置文件及用途")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("路径")]),t._v(" "),s("th",[t._v("用途")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("配置文件")]),t._v(" "),s("td",[t._v("/etc/logrotate.d/nginx")]),t._v(" "),s("td",[t._v("用于logrotate服务的日志切割")])]),t._v(" "),s("tr",[s("td",[t._v("配置文件")]),t._v(" "),s("td",[t._v("/etc/nginx /etc/nginx/nginx.conf /etc/nginx/conf.d /etc/nginx/conf.d/default.conf")]),t._v(" "),s("td",[t._v("主配置文件")])]),t._v(" "),s("tr",[s("td",[t._v("配置文件")]),t._v(" "),s("td",[t._v("/etc/nginx/fastcgi_params /etc/nginx/scgi_params /etc/nginx/uwsgi_params")]),t._v(" "),s("td",[t._v("cgi配置,fastcgi配置")])]),t._v(" "),s("tr",[s("td",[t._v("配置文件")]),t._v(" "),s("td",[t._v("/etc/nginx/koi-utf /etc/nginx/koi-win /etc/nginx/win-utf")]),t._v(" "),s("td",[t._v("编码转换映射转化文件")])]),t._v(" "),s("tr",[s("td",[t._v("配置文件")]),t._v(" "),s("td",[t._v("/etc/nginx/mime.types")]),t._v(" "),s("td",[t._v("设置http协议的Content-Type与扩展名对应关系")])]),t._v(" "),s("tr",[s("td",[t._v("配置文件")]),t._v(" "),s("td",[t._v("/usr/lib/systemd/system/nginx-debug.service /usr/lib/systemd/system/nginx.service /etc/sysconfig/nginx /etc/sysconfig/nginx-debug")]),t._v(" "),s("td",[t._v("用于配置系统守护进程管理器管理方式")])]),t._v(" "),s("tr",[s("td",[t._v("配置文件")]),t._v(" "),s("td",[t._v("/etc/nginx/modules /usr/lib64/nginx/modules")]),t._v(" "),s("td",[t._v("nginx模块目录")])]),t._v(" "),s("tr",[s("td",[t._v("命令")]),t._v(" "),s("td",[t._v("/usr/share/doc/nginx-1.14.0 /usr/share/doc/nginx-1.14.0/COPYRIGHT")]),t._v(" "),s("td",[t._v("nginx的手册和帮助文件")])]),t._v(" "),s("tr",[s("td",[t._v("目录")]),t._v(" "),s("td",[t._v("/var/cache/nginx")]),t._v(" "),s("td",[t._v("nginx的缓存目录")])]),t._v(" "),s("tr",[s("td",[t._v("目录")]),t._v(" "),s("td",[t._v("/var/log/nginx")]),t._v(" "),s("td",[t._v("nginx的日志目录")])])])]),t._v(" "),s("p",[t._v("安装目录和路径")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--prefix")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/etc/nginx "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装目录")]),t._v("\n--sbin-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/sbin/nginx "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可执行文件")]),t._v("\n--modules-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/lib64/nginx/modules "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装模块")]),t._v("\n--conf-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/etc/nginx/nginx.conf  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置文件路径")]),t._v("\n--error-log-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/log/nginx/error.log  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 错误日志")]),t._v("\n--http-log-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/log/nginx/access.log  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 访问日志")]),t._v("\n--pid-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/run/nginx.pid "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进程ID")]),t._v("\n--lock-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/run/nginx.lock "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 加锁对象")]),t._v("\n")])])]),s("p",[t._v("执行对应模块时，nginx所保留的临时性文件")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("--http-client-body-temp-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/cache/nginx/client_temp "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 客户端请求体临时路径")]),t._v("\n--http-proxy-temp-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/cache/nginx/proxy_temp "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 代理临时路径")]),t._v("\n--http-fastcgi-temp-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/cache/nginx/fastcgi_temp \n--http-uwsgi-temp-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/cache/nginx/uwsgi_temp \n--http-scgi-temp-path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/cache/nginx/scgi_temp \n")])])]),s("p",[t._v("设置nginx进程启动的用户和用户组")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定用户")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--group")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定用户组")]),t._v("\n")])])]),s("p",[t._v("设置额外的参数将被添加到"),s("code",[t._v("CFLAGS")]),t._v("变量,"),s("code",[t._v("CFLAGS")]),t._v("变量用来存放C语言编译时的优化参数")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("--with-cc-opt"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("'-O2 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-g")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-pipe")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Wall")]),t._v(" -Wp,-D_FORTIFY_SOURCE"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-fexceptions")]),t._v(" -fstack-protector-strong \n")])])]),s("p",[t._v("设置链接文件参数，链接系统库。"),s("br"),t._v("\n定义要传递到C链接器命令行的其他选项。"),s("br"),t._v("\nPCRE库，需要指定"),s("code",[t._v('–with-ld-opt="-L /usr/local/lib"')])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("--with-ld-opt"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-Wl,-z,relro -Wl,-z,now -pie'")]),t._v("\n")])])]),s("p",[t._v("其它参数")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("--with-compat \n--with-file-aio \n--with-threads \n--with-http_addition_module \n--with-http_auth_request_module \n--with-http_dav_module \n--with-http_flv_module \n--with-http_gunzip_module \n--with-http_gzip_static_module \n--with-http_mp4_module \n--with-http_random_index_module \n--with-http_realip_module \n--with-http_secure_link_module \n--with-http_slice_module \n--with-http_ssl_module \n--with-http_stub_status_module \n--with-http_sub_module \n--with-http_v2_module \n--with-mail \n--with-mail_ssl_module \n--with-stream \n--with-stream_realip_module \n--with-stream_ssl_module \n--with-stream_ssl_preread_module \n--param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC' \n")])])]),s("p",[t._v("主要的配置文件")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("/etc/nginx/nginx.conf "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 核心配置文件")]),t._v("\n/etc/nginx/conf.d/*.conf "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 包含conf.d目录下面的所有配置文件")]),t._v("\n/etc/nginx/conf.d/default.conf "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认http服务器配置文件")]),t._v("\n")])])]),s("h4",{attrs:{id:"cgi配置文件"}},[t._v("cgi配置文件")]),t._v(" "),s("ul",[s("li",[t._v("CGI是common gateway interface(通用网关接口)")]),t._v(" "),s("li",[t._v("Web Server 通过cgi协议可以把动态的请求传递给如php、jsp、python和perl等应用程序")]),t._v(" "),s("li",[t._v("FastCGI 实际上是增加了一些扩展功能的 CGI ,是 CGI 的改进，描述了客户端和Web服务器程序之间传输数据的一种标准。")]),t._v(" "),s("li",[t._v("SCGI协议是一个CGI（通用网关接口）协议的替代品· 它是一个应用与HTTP服务器的接口标准，类似于FastCGI,但是它设计得更为容易实现")]),t._v(" "),s("li",[t._v("uwsgi是一个Web服务器，它实现了WSGI协议、uwsgi、http等协议")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("路径")]),t._v(" "),s("th",[t._v("用途")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("/etc/nginx/fastcgi_params")]),t._v(" "),s("td",[t._v("fastcgi配置")])]),t._v(" "),s("tr",[s("td",[t._v("/etc/nginx/scgi_params")]),t._v(" "),s("td",[t._v("scgi配置")])]),t._v(" "),s("tr",[s("td",[t._v("/etc/nginx/uwsgi_params")]),t._v(" "),s("td",[t._v("uwsgi配置")])])])]),t._v(" "),s("h4",{attrs:{id:"编码转换映射转化文件"}},[t._v("编码转换映射转化文件")]),t._v(" "),s("ul",[s("li",[t._v("这三个文件都是与编码转换映射文件，用于在输出内容到客户端时，将一种编码转换到另一种编码")]),t._v(" "),s("li",[t._v("koi8-r是斯拉夫文字8位元编码，供俄语及保加利亚语使用。在Unicode未流行之前，KOI8-R 是最为广泛使用的俄语编码，使用率甚至起ISO/IEC 8859-5还高。这3个文件存在是因为作者是俄国人的原因。")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("路径")]),t._v(" "),s("th",[t._v("用途")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("/etc/nginx/koi-utf")]),t._v(" "),s("td",[t._v("koi8-r <--\x3e utf-8")])]),t._v(" "),s("tr",[s("td",[t._v("/etc/nginx/koi-win")]),t._v(" "),s("td",[t._v("koi8-r <--\x3e windows-1251")])]),t._v(" "),s("tr",[s("td",[t._v("/etc/nginx/win-utf")]),t._v(" "),s("td",[t._v("windows-1251 < -- > utf-8")])])])]),t._v(" "),s("h4",{attrs:{id:"扩展名文件"}},[t._v("扩展名文件")]),t._v(" "),s("p",[s("code",[t._v("/etc/nginx/mime.types")]),t._v(" 设置http协议的Content-Type与扩展名对应关系")]),t._v(" "),s("h4",{attrs:{id:"守护进程管理"}},[t._v("守护进程管理")]),t._v(" "),s("p",[t._v("用于配置系统守护进程管理器管理方式")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("路径")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("/usr/lib/systemd/system/nginx-debug.service")])]),t._v(" "),s("tr",[s("td",[t._v("/usr/lib/systemd/system/nginx.service")])]),t._v(" "),s("tr",[s("td",[t._v("/etc/sysconfig/nginx")])]),t._v(" "),s("tr",[s("td",[t._v("/etc/sysconfig/nginx-debug")])])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("systemctl restart nginx.service\n")])])]),s("h4",{attrs:{id:"nginx模块目录"}},[t._v("nginx模块目录")]),t._v(" "),s("p",[s("code",[t._v("/etc/nginx/modules")]),t._v("最基本的共享库和内核模块。"),s("br"),t._v("\n目的是存放用于启动系统和执行root文件系统的命令的如"),s("code",[t._v("/bin")]),t._v("和"),s("code",[t._v("/sbin")]),t._v("的二进制文件的共享库，或者存放32位，或者64位(file命令查看)\n"),s("code",[t._v("/usr/lib64/nginx/modules")]),t._v(" 64位共享库")]),t._v(" "),s("h4",{attrs:{id:"nginx的手册和帮助文件"}},[t._v("nginx的手册和帮助文件")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("路径")]),t._v(" "),s("th",[t._v("用途")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("/usr/share/doc/nginx-1.14.2")]),t._v(" "),s("td",[t._v("帮助文档")])]),t._v(" "),s("tr",[s("td",[t._v("/usr/share/doc/nginx-1.14.0/COPYRIGHT")]),t._v(" "),s("td",[t._v("版权声明")])]),t._v(" "),s("tr",[s("td",[t._v("/usr/share/man/man8/nginx.8.gz")]),t._v(" "),s("td",[t._v("手册")])])])]),t._v(" "),s("h4",{attrs:{id:"nginx服务的启动管理的可执行文件"}},[t._v("nginx服务的启动管理的可执行文件")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("路径")]),t._v(" "),s("th",[t._v("用途")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("/usr/sbin/nginx")]),t._v(" "),s("td",[t._v("可执行命令")])]),t._v(" "),s("tr",[s("td",[t._v("/usr/sbin/nginx-debug")]),t._v(" "),s("td",[t._v("调试执行可执行命令")])])])]),t._v(" "),s("h3",{attrs:{id:"nginx内容配置"}},[t._v("nginx内容配置")]),t._v(" "),s("h4",{attrs:{id:"nginx配置语法"}},[t._v("nginx配置语法")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用#可以添加注释,使用$符号可以使用变量")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置文件由指令与指令块组成,指令块以{}将多条指令组织在一起")]),t._v("\nhttp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# include语句允许把多个配置文件组合起来以提升可维护性    ")]),t._v("\n    include       mime.types"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每条指令以;(分号)结尾，指令与参数之间以空格分隔")]),t._v("\n    default_type  application/octet-stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    sendfile        on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    keepalive_timeout  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        server_name  localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 有些指令可以支持正则表达式        ")]),t._v("\n        location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index  index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        error_page   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  /50x.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /50x.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"全局和服务配置"}},[t._v("全局和服务配置")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("分类")]),t._v(" "),s("th",[t._v("配置项")]),t._v(" "),s("th",[t._v("作用")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("全局")]),t._v(" "),s("td",[t._v("user")]),t._v(" "),s("td",[t._v("设置nginx服务的系统使用用户")])]),t._v(" "),s("tr",[s("td",[t._v("全局")]),t._v(" "),s("td",[t._v("worker_processes")]),t._v(" "),s("td",[t._v("工作进程数,一般和CPU数量相同")])]),t._v(" "),s("tr",[s("td",[t._v("全局")]),t._v(" "),s("td",[t._v("error_log")]),t._v(" "),s("td",[t._v("nginx的错误日志")])]),t._v(" "),s("tr",[s("td",[t._v("全局")]),t._v(" "),s("td",[t._v("pid")]),t._v(" "),s("td",[t._v("nginx服务启动时的pid")])])])]),t._v(" "),s("h4",{attrs:{id:"事件配置"}},[t._v("事件配置")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("分类")]),t._v(" "),s("th",[t._v("配置项")]),t._v(" "),s("th",[t._v("作用")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("events")]),t._v(" "),s("td",[t._v("worker_connections")]),t._v(" "),s("td",[t._v("每个进程允许的最大连接数 10000")])]),t._v(" "),s("tr",[s("td",[t._v("events")]),t._v(" "),s("td",[t._v("use")]),t._v(" "),s("td",[t._v("指定使用哪种模型（select/poll/epoll）,建议让nginx自动选择,linux内核2.6以上一般能使用epoll，提高性能。")])])])]),t._v(" "),s("h4",{attrs:{id:"http配置"}},[t._v("http配置")]),t._v(" "),s("p",[t._v("配置的文件"),s("code",[t._v("/etc/nginx/nginx.conf")]),t._v("，一个HTTP下面可以配置多个server。")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("user  nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置nginx服务的系统使用用户  ")]),t._v("\nworker_processes  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 工作进程数,一般和CPU数量相同 ")]),t._v("\n\nerror_log  /var/log/nginx/error.log warn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx的错误日志  ")]),t._v("\npid        /var/run/nginx.pid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx服务启动时的pid")]),t._v("\n\nevents "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    worker_connections  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每个进程允许的最大连接数 10000")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    include       /etc/nginx/mime.types"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 文件后缀和类型类型的对应关系")]),t._v("\n    default_type  application/octet-stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认content-type")]),t._v("\n\n    log_format  main  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),t._v("\n                      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$status $body_bytes_sent \"$http_referer\" '")]),t._v("\n                      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 日志记录格式")]),t._v("\n\n    access_log  /var/log/nginx/access.log  main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认访问日志")]),t._v("\n\n    sendfile        on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启用sendfile")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#tcp_nopush     on; # 懒发送")]),t._v("\n\n    keepalive_timeout  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 超时时间是65秒")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gzip  on;gzip压缩")]),t._v("\n\n    include /etc/nginx/conf.d/*.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 包含的子配置文件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"server配置"}},[t._v("server配置")]),t._v(" "),s("p",[t._v("文件为"),s("code",[t._v("/etc/nginx/conf.d/default.conf")]),t._v(",一个server下面可以配置多个location。")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监听的端口号")]),t._v("\n    server_name  localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 用域名方式访问的地址")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#charset koi8-r; # 编码")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#access_log  /var/log/nginx/host.access.log  main;  # 访问日志文件和名称")]),t._v("\n\n    location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root   /usr/share/nginx/html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 静态文件根目录")]),t._v("\n        index  index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 首页的索引文件")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error_page  404              /404.html;  # 指定错误页面")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# redirect server error pages to the static page /50x.html")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 把后台错误重定向到静态的50x.html页面")]),t._v("\n    error_page   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  /50x.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /50x.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root   /usr/share/nginx/html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# proxy the PHP scripts to Apache listening on 127.0.0.1:80")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 代理PHP脚本到80端口上的apache服务器")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#location ~ \\.php$ {")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    proxy_pass   http://127.0.0.1;")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 把PHP脚本9000端口上监听的FastCGI服务")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#location ~ \\.php$ {")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    root           html;")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    fastcgi_pass   127.0.0.1:9000;")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    fastcgi_index  index.php;")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    include        fastcgi_params;")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# deny access to .htaccess files, if Apache's document root")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# concurs with nginx's one")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 不允许访问.htaccess文件")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# location ~ /\\.ht {")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     deny  all;")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# }")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"systemd配置"}},[t._v("Systemd配置")]),t._v(" "),s("p",[t._v("系统启动和服务器守护进程管理器，负责在系统启动或运行时，激活系统资源，服务器进程和其他进程，根据管理，字母d是守护进程（daemon）的缩写。")]),t._v(" "),s("h5",{attrs:{id:"配置目录"}},[t._v("配置目录")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("配置目录")]),t._v(" "),s("th",[t._v("用途")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("/usr/lib/systemd/system")]),t._v(" "),s("td",[t._v("每个服务最主要的启动脚本设置，类似于之前的/etc/initd.d")])]),t._v(" "),s("tr",[s("td",[t._v("/run/system/system")]),t._v(" "),s("td",[t._v("系统执行过程中所产生的服务脚本，比上面的目录优先运行")])]),t._v(" "),s("tr",[s("td",[t._v("/etc/system/system")]),t._v(" "),s("td",[t._v("管理员建立的执行脚本，类似于/etc/rc.d/rcN.d/Sxx类的功能，比上面目录优先运行，在三者之中，此目录优先级最高")])])])]),t._v(" "),s("h5",{attrs:{id:"systemctl"}},[t._v("systemctl")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.cnblogs.com/zhuxiangru/p/9414038.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置nginx的systemctl命令"),s("OutboundLink")],1)]),t._v(" "),s("ul",[s("li",[t._v("监视和控制systemd的主要命令是systemctl")]),t._v(" "),s("li",[t._v("该命令可用于查看系统状态和管理系统及服务")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("命令：systemctl  "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" name.service\n启动：service name start –"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" systemctl start name.service\n停止：service name stop –"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" systemctl stop name.service\n重启：service name restart –"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" systemctl restart name.service\n状态：service name status –"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" systemctl status name.service\n")])])]),s("h4",{attrs:{id:"启动和重新加载"}},[t._v("启动和重新加载")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("systemctl restart nginx.service\nsystemctl reload nginx.service\nnginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" reload\n")])])]),s("h4",{attrs:{id:"日志相关"}},[t._v("日志相关")]),t._v(" "),s("p",[t._v("/var/log/nginx/access.log 访问日志\n/var/log/nginx/error.log 错误日志")]),t._v(" "),s("ul",[s("li",[t._v("log_format")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("用法")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("语法")]),t._v(" "),s("td",[t._v("log_format name [escape=default[json] string]")])]),t._v(" "),s("tr",[s("td",[t._v("默认")]),t._v(" "),s("td",[t._v("log_format combined ...")])]),t._v(" "),s("tr",[s("td",[t._v("Context")]),t._v(" "),s("td",[t._v("http")])])])]),t._v(" "),s("p",[s("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_log_module.html#log_format",target:"_blank",rel:"noopener noreferrer"}},[t._v("log_format例子"),s("OutboundLink")],1),s("br"),t._v(" "),s("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_log_module.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ngx_http_log_module"),s("OutboundLink")],1),t._v("\n内置变量")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("名称")]),t._v(" "),s("th",[t._v("含义")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("$remote_addr")]),t._v(" "),s("td",[t._v("客户端地址")])]),t._v(" "),s("tr",[s("td",[t._v("$remote_user")]),t._v(" "),s("td",[t._v("客户端用户名称")])]),t._v(" "),s("tr",[s("td",[t._v("$time_local")]),t._v(" "),s("td",[t._v("访问时间和时区")])]),t._v(" "),s("tr",[s("td",[t._v("$request")]),t._v(" "),s("td",[t._v("请求行")])]),t._v(" "),s("tr",[s("td",[t._v("$status")]),t._v(" "),s("td",[t._v("HTTP请求状态")])]),t._v(" "),s("tr",[s("td",[t._v("$body_bytes_sent\t发送给客户端文件内容大小")]),t._v(" "),s("td")])])]),t._v(" "),s("ul",[s("li",[t._v("HTTP请求变量")])]),t._v(" "),s("p",[t._v("注意要把-转成下划线,比如User-Agent对应于$http_user_agent")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("名称")]),t._v(" "),s("th",[t._v("含义")]),t._v(" "),s("th",[t._v("例子")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("arg_PARAMETER")]),t._v(" "),s("td",[t._v("请求参数")]),t._v(" "),s("td",[t._v("$arg_name")])]),t._v(" "),s("tr",[s("td",[t._v("http_HEADER")]),t._v(" "),s("td",[t._v("请求头")]),t._v(" "),s("td",[t._v("$http_referer $http_host $http_user_agent $http_x_forwarded_for(代理过程)")])]),t._v(" "),s("tr",[s("td",[t._v("sent_http_HEADER")]),t._v(" "),s("td",[t._v("响应头")]),t._v(" "),s("td",[t._v("sent_http_cookie")])])])]),t._v(" "),s("p",[t._v("IP1->IP2(代理)->IP3 会记录IP地址的代理过程")]),t._v(" "),s("p",[t._v("http_x_forwarded_for=Client IP,Proxy(1) IP,Proxy(2) IP")]),t._v(" "),s("p",[t._v("定义日志格式")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 定义一种日志格式 ")]),t._v("\n log_format  main  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),t._v("\n                      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$status $body_bytes_sent \"$http_referer\" '")]),t._v("\n                      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n log_format  zfpx  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$arg_name $http_referer sent_http_date\"'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定写入的文件名和日志格式")]),t._v("\n access_log  /var/log/nginx/access.log  main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    \n")])])]),s("p",[t._v("查看日志")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tail")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" /var/log/nginx/access.log\n\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("221.216")]),t._v(".143.110 - - "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("09/Jun/2018:22:41:18 +0800"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET / HTTP/1.1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("612")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v("\n")])])]),s("h3",{attrs:{id:"核心模块"}},[t._v("核心模块")]),t._v(" "),s("ul",[s("li",[t._v("监控ngin客户端的状态\n模块名："),s("code",[t._v("--with-http_stub_status_module")])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Syntax: stub_status on/off;\nDefault: -\nContext: server->location\n")])])]),s("p",[t._v("实战"),s("br"),t._v("\n文件："),s("code",[t._v("/etc/nginx/conf.d/default.conf")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n+    location /status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n+       stub_status  on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n+    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("systemctl reload nginx.service\n\nhttp://192.171.207.104/status\n\nActive connections: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("            \nserver accepts handled requests  \n "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" \nReading: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" Writing: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" Waiting: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" \n")])])]),s("table",[s("thead",[s("tr",[s("th",[t._v("参数")]),t._v(" "),s("th",[t._v("含义")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("Active")]),t._v(" "),s("td",[t._v("connections")])]),t._v(" "),s("tr",[s("td",[t._v("accepts")]),t._v(" "),s("td",[t._v("总共处理的连接数")])]),t._v(" "),s("tr",[s("td",[t._v("handled")]),t._v(" "),s("td",[t._v("成功创建握手数")])]),t._v(" "),s("tr",[s("td",[t._v("requests")]),t._v(" "),s("td",[t._v("总共处理请求数")])]),t._v(" "),s("tr",[s("td",[t._v("Reading")]),t._v(" "),s("td",[t._v("读取到客户端的Header信息数")])]),t._v(" "),s("tr",[s("td",[t._v("Writing")]),t._v(" "),s("td",[t._v("返回给客户端的Header信息数")])]),t._v(" "),s("tr",[s("td",[t._v("Waiting")]),t._v(" "),s("td",[t._v("开启keep-alive的情况下,这个值等于 active – (reading + writing)")])])])]),t._v(" "),s("ul",[s("li",[t._v("在根目录里随机选择一个主页显示")])]),t._v(" "),s("p",[t._v("模块名："),s("code",[t._v("--with-http_random_index_module")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("Syntax: random_index on/off"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nDefault: off\nContext: location\n")])])]),s("p",[t._v("实战"),s("br"),t._v(" "),s("code",[t._v("/etc/nginx/conf.d/default.conf")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("+    location / {\n+       root /opt/app;\n+       random_index on;\n+    }\n")])])]),s("ul",[s("li",[t._v("内容替换"),s("br"),t._v("\n模块名：--with-http_sub_module")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("文本替换\nSyntax: sub_filter string replacement;\nDefault: --\nContext: http,service,location\n\n只匹配一次\nSyntax: sub_filter_once on|off;\nDefault: off\nContext: http,service,location\n")])])]),s("p",[t._v("实战"),s("br"),t._v("\n文件位置：/etc/nginx/conf.d/default.conf")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root   /usr/share/nginx/html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        index  index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n+        sub_filter "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'world'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mamingjuan'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n+        sub_filter_once off"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("请求限制"),s("br"),t._v("\n模块名"),s("br"),t._v("\n--with-limit_conn_module 连接频率限制"),s("br"),t._v("\n--with-limit_req_module 请求频率限制"),s("br"),t._v("\n一次TCP请求至少产生一个HTTP请求"),s("br"),t._v("\nSYN > SYN,ACK->ACK->REQUEST->RESPONSE->FIN->ACK->FIN->ACK")])]),t._v(" "),s("p",[t._v("ab")]),t._v(" "),s("p",[t._v("Apache的ab命令模拟多线程并发请求，测试服务器负载压力，也可以测试nginx、lighthttp、IIS等其它Web服务器的压力。\n其中-n 总共的请求数、-c 并发的请求数。")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("ab "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("40")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" http://127.0.0.1/\n")])])]),s("p",[t._v("请求限制"),s("br"),t._v("\n模块：limit_req_zone")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以以IP为key zone为空间的名称 size为申请空间的大小")]),t._v("\nSyntax: limit_req_zone key "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("zone")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("name:size "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rate")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   \nDefault: --\nContext: http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("定义在server以外"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("模块：limit_req")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# zone名称 number限制的数量")]),t._v("\nSyntax: limit_req  "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("zone")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("burst"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("number"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nodelay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nDefault: --\nContext: http,server,location\n")])])]),s("p",[t._v("案例")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("limit_req_zone "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$binary_remote_addr")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("zone")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("req_zone:1m "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rate")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("1r/s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  location /"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      limit_req req_zone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 缓存区队列burst=3个,不延期，即每秒最多可处理rate+burst个.同时处理rate个")]),t._v("\n      limit_req "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("zone")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("req_zone "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("burst")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" nodelay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("$binary_remote_addr 表示远程的IP地址"),s("br"),t._v("\nzone=req_zone:10m 表示一个内存区域大小为10m,并且设定了名称为req_zone"),s("br"),t._v("\nrate=1r/s 表示请求的速率是1秒1个请求")]),t._v(" "),s("p",[t._v("zone=req_zone 表示这个参数对应的全局设置就是req_zone的那个内存区域")]),t._v(" "),s("p",[t._v("burst=3 表示请求队列的长度"),s("br"),t._v("\nnodelay 表示不延时")]),t._v(" "),s("p",[t._v("连接限制")]),t._v(" "),s("p",[t._v("模块：limit_conn_zone")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以以IP为key zone为空间的名称 size为申请空间的大小")]),t._v("\nSyntax: limit_conn_zone key "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("zone")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("name:size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   \nDefault: --\nContext: http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("定义在server以外"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("模块：limit_conn")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# zone名称 number限制的数量")]),t._v("\nSyntax: limit_conn  zone number"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nDefault: --\nContext: http,server,location\n")])])]),s("p",[t._v("案例")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("limit_conn_zone "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$binanry_remote_addr")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("zone")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("conn_zone:1m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  location /"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      limit_conn conn_zone "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("表明以ip为key，来限制每个ip访问文件时候，最多只能有一个在线，否则其余的都要返回不可用")]),t._v(" "),s("ul",[s("li",[t._v("访问控制"),s("br"),t._v("\n基于IP的访问控制 -http_access_module"),s("br"),t._v("\n基于用户的信任登录 -http_auth_basic_module")])]),t._v(" "),s("p",[t._v("模块：http_access_module")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("Syntax: allow address"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("all"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nDefault: --\nContext: http,server,location,limit_except\n\n\nSyntax: deny address"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("CIDR"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("all"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nDefault: --\nContext: http,server,location,limit_except\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n+ location ~ ^/admin.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n+      deny "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.171")]),t._v(".207.100"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n+      allow all"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n+    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("    \n\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n+ location ~ ^/admin.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n+    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_x_forwarded_for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("~* "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^8\\.8\\.8\\.8"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n+       "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("403")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n+    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n")])])]),s("table",[s("thead",[s("tr",[s("th",[t._v("符号")]),t._v(" "),s("th",[t._v("含义")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("=")]),t._v(" "),s("td",[t._v("严格匹配。如果这个查询匹配，那么将停止搜索并立即处理此请求。")])]),t._v(" "),s("tr",[s("td",[t._v("~")]),t._v(" "),s("td",[t._v("为区分大小写匹配(可用正则表达式)")])]),t._v(" "),s("tr",[s("td",[t._v("!~")]),t._v(" "),s("td",[t._v("为区分大小写不匹配")])]),t._v(" "),s("tr",[s("td",[t._v("~*")]),t._v(" "),s("td",[t._v("为不区分大小写匹配(可用正则表达式)")])]),t._v(" "),s("tr",[s("td",[t._v("!~*")]),t._v(" "),s("td",[t._v("为不区分大小写不匹配")])]),t._v(" "),s("tr",[s("td",[t._v("^~")]),t._v(" "),s("td",[t._v("如果把这个前缀用于一个常规字符串,那么告诉nginx 如果路径匹配那么不测试正则表达式。")])])])]),t._v(" "),s("p",[t._v("模块：http_auth_basic_module")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("Syntax: auth_basic string"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("off"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nDefault: auth_basic off"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nContext: http,server,location,limit_except\n\nSyntax: auth_basic_user_file "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nDefault: -"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nContext: http,server,location,limit_except\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("htpasswd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" /etc/nginx/users.conf zhangsan\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server {\n+    auth_basic '请登录';\n+    auth_basic_user_file /etc/nginx/users.conf;\n")])])]),s("h3",{attrs:{id:"静态资源web服务"}},[t._v("静态资源Web服务")]),t._v(" "),s("p",[t._v("静态资源：一般客户端发送请求到web服务器，web服务器从内存在取到相应的文件，返回给客户端，客户端解析并渲染显示出来。"),s("br"),t._v("\n动态资源：一般客户端请求的动态资源，先将请求交于web容器，web容器连接数据库，数据库处理数据之后，将内容交给web服务器，web服务器返回给客户端解析渲染处理。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("种类")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("浏览器渲染")]),t._v(" "),s("td",[t._v("HTML、CSS、JS")])]),t._v(" "),s("tr",[s("td",[t._v("图片")]),t._v(" "),s("td",[t._v("JPEG、GIF、PNG")])]),t._v(" "),s("tr",[s("td",[t._v("视频")]),t._v(" "),s("td",[t._v("FLV、MPEG")])]),t._v(" "),s("tr",[s("td",[t._v("下载文件")]),t._v(" "),s("td",[t._v("Word、Excel")])])])]),t._v(" "),s("h4",{attrs:{id:"cdn"}},[t._v("CDN")]),t._v(" "),s("p",[t._v("CDN的全称是Content Delivery Network，即内容分发网络。"),s("br"),t._v("\nCDN系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。其目的是使用户可就近取得所需内容，解决 Internet网络拥挤的状况，提高用户访问网站的响应速度。")]),t._v(" "),s("h4",{attrs:{id:"配置语法"}},[t._v("配置语法")]),t._v(" "),s("p",[t._v("sendfile不经过用户内核发送文件")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("种类")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("语法")]),t._v(" "),s("td",[t._v("sendfile on / off")])]),t._v(" "),s("tr",[s("td",[t._v("默认")]),t._v(" "),s("td",[t._v("sendfile off;")])]),t._v(" "),s("tr",[s("td",[t._v("上下文")]),t._v(" "),s("td",[t._v("http,server,location,if in location")])])])]),t._v(" "),s("p",[t._v("tcp_nopush 在sendfile开启的情况下，提高网络包的传输效率")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("种类")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("语法")]),t._v(" "),s("td",[t._v("tcp_nopush on / off")])]),t._v(" "),s("tr",[s("td",[t._v("默认")]),t._v(" "),s("td",[t._v("tcp_nopush off;")])]),t._v(" "),s("tr",[s("td",[t._v("上下文")]),t._v(" "),s("td",[t._v("http,server,location")])])])]),t._v(" "),s("p",[t._v("tcp_nodelay 在keepalive连接下，提高网络包的传输实时性")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("种类")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("语法")]),t._v(" "),s("td",[t._v("tcp_nodelay on / off")])]),t._v(" "),s("tr",[s("td",[t._v("默认")]),t._v(" "),s("td",[t._v("tcp_nodelay on;")])]),t._v(" "),s("tr",[s("td",[t._v("上下文")]),t._v(" "),s("td",[t._v("http,server,location")])])])]),t._v(" "),s("p",[t._v("gzip 压缩文件可以节约带宽和提高网络传输效率")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("种类")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("语法")]),t._v(" "),s("td",[t._v("gzip on / off")])]),t._v(" "),s("tr",[s("td",[t._v("默认")]),t._v(" "),s("td",[t._v("gzip off;")])]),t._v(" "),s("tr",[s("td",[t._v("上下文")]),t._v(" "),s("td",[t._v("http,server,location")])])])]),t._v(" "),s("p",[t._v("gzip_comp_level 压缩比率越高，文件被压缩的体积越小")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("种类")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("语法")]),t._v(" "),s("td",[t._v("gzip_comp_level level")])]),t._v(" "),s("tr",[s("td",[t._v("默认")]),t._v(" "),s("td",[t._v("gzip_comp_level 1;")])]),t._v(" "),s("tr",[s("td",[t._v("上下文")]),t._v(" "),s("td",[t._v("http,server,location")])])])]),t._v(" "),s("p",[t._v("gzip_http_version 压缩HTTP版本")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("种类")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("语法")]),t._v(" "),s("td",[t._v("gzip_http_version 1.0/1.1")])]),t._v(" "),s("tr",[s("td",[t._v("默认")]),t._v(" "),s("td",[t._v("gzip_http_version 1.1;")])]),t._v(" "),s("tr",[s("td",[t._v("上下文")]),t._v(" "),s("td",[t._v("http,server,location")])])])]),t._v(" "),s("p",[t._v("http_gzip-static_module 先找磁盘上找同名的.gz这个文件是否存在,节约CPU的压缩时间和性能损耗")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("种类")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("语法")]),t._v(" "),s("td",[t._v("gzip_static on/off")])]),t._v(" "),s("tr",[s("td",[t._v("默认")]),t._v(" "),s("td",[t._v("gzip_static off;")])]),t._v(" "),s("tr",[s("td",[t._v("上下文")]),t._v(" "),s("td",[t._v("http,server,location")])])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("    location ~ .*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("jpg"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("png"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("gif"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v(" off"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭压缩")]),t._v("\n        root /data/www/images"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    location ~ .*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("js"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("css"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v(" on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启用压缩")]),t._v("\n        gzip_min_length 1k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 只压缩超过1K的文件")]),t._v("\n        gzip_http_version "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启用gzip压缩所需的HTTP最低版本")]),t._v("\n        gzip_comp_level "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 压缩级别，压缩比率越高，文件被压缩的体积越小")]),t._v("\n        gzip_types  text/css application/javascript"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进行压缩的文件类型")]),t._v("\n        root /data/www/html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    location ~ ^/download "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        gzip_static on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启用压缩")]),t._v("\n        tcp_nopush on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 不要着急发，攒一波再发")]),t._v("\n        root /data/www"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注意此处目录是`/data/www`而不是`/data/www/download`")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n")])])]),s("h3",{attrs:{id:"浏览器缓存"}},[t._v("浏览器缓存")]),t._v(" "),s("p",[t._v("校验本地缓存是否过期")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("种类")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("检验是否过期")]),t._v(" "),s("td",[t._v("Expires、Cache-Control(max-age)")])]),t._v(" "),s("tr",[s("td",[t._v("Etag")]),t._v(" "),s("td",[t._v("Etag")])]),t._v(" "),s("tr",[s("td",[t._v("Last-Modified")]),t._v(" "),s("td",[t._v("Last-Modified")])])])]),t._v(" "),s("p",[t._v("expires"),s("br"),t._v("\n添加Cache-Control、Expires头")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("种类")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("语法")]),t._v(" "),s("td",[t._v("expires time")])]),t._v(" "),s("tr",[s("td",[t._v("默认")]),t._v(" "),s("td",[t._v("expires off;")])])])]),t._v(" "),s("p",[t._v("上下文\thttp,server,location")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("location ~ .*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("jpg"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("png"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("gif"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        expires 24h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"跨域"}},[t._v("跨域")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("种类")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("语法")]),t._v(" "),s("td",[t._v("add_header name value")])]),t._v(" "),s("tr",[s("td",[t._v("默认")]),t._v(" "),s("td",[t._v("add_header --;")])]),t._v(" "),s("tr",[s("td",[t._v("上下文")]),t._v(" "),s("td",[t._v("http,server,location")])])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("location ~ .*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(".json$ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        add_header Access-Control-Allow-Origin http://localhost:3000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        root /data/json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" xhr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://47.104.184.134/users.json'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onreadystatechange")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseText"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nxhr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"防盗链"}},[t._v("防盗链")]),t._v(" "),s("p",[t._v("防止网站资源被盗用、保证信息安全、防止流量过量、区别哪些请求是非正常的用户请求\n使用"),s("code",[t._v("http_refer")]),t._v("防盗链")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("种类")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("语法")]),t._v(" "),s("td",[t._v("valid_referers none\tblock\tserver_names\tstring...")])]),t._v(" "),s("tr",[s("td",[t._v("默认")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td",[t._v("上下文")]),t._v(" "),s("td",[t._v("server,location")])])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("location ~ .*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("jpg"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("png"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("gif"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        expires 1h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v(" off"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        gzip_http_version "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        gzip_comp_level "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        gzip_types image/jpeg image/png image/gif"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# none没有refer blocked非正式HTTP请求 特定IP")]),t._v("\n+       valid_referers none blocked "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("47.104")]),t._v(".184.134"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n+       "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$invalid_referer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证通过为0，不通过为1")]),t._v("\n+           "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("403")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n+       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        root /data/images"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('-e, --referer       Referer URL (H)\ncurl -e "http://www.baidu.com" http://192.171.207.104/girl.jpg\ncurl -e "192.171.207.100" http://192.171.207.104/girl.jpg\n')])])]),s("h3",{attrs:{id:"代理服务"}},[t._v("代理服务")]),t._v(" "),s("p",[t._v("正向代理即是客户端代理, 代理客户端, 服务端不知道实际发起请求的客户端."),s("br"),t._v("\n反向代理即是服务端代理, 代理服务端, 客户端不知道实际提供服务的服务端.")]),t._v(" "),s("p",[t._v("配置")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("种类")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("语法")]),t._v(" "),s("td",[t._v("proxy_pass URL")])]),t._v(" "),s("tr",[s("td",[t._v("默认")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td",[t._v("上下文")]),t._v(" "),s("td",[t._v("server,location")])])])]),t._v(" "),s("p",[t._v("反向代理"),s("br"),t._v("\n反向代理（Reverse Proxy）实际运行方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器。"),s("br"),t._v("\n反向代理的作用："),s("br"),t._v("\n（1）保证内网的安全，阻止web攻击，大型网站，通常将反向代理作为公网访问地址，Web服务器是内网")]),t._v(" "),s("p",[t._v("（2）负载均衡，通过反向代理服务器来优化网站的负载")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("resolver "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8.8")]),t._v(".8.8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 谷歌的域名解析地址")]),t._v("\nlocation ~ ^/api "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# $http_host 要访问的主机名 $request_uri请求路径")]),t._v("\n    proxy_pass http://127.0.0.1:3000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("按"),s("code",[t._v("Win+R")]),t._v("系统热键打开运行窗口，输入"),s("code",[t._v("ipconfig /flushdns")]),t._v("命令后按回车，就可以清空电脑的DNS缓存")]),t._v(" "),s("p",[t._v("正向代理")]),t._v(" "),s("p",[t._v("正向代理类似一个跳板机，代理访问外部资源。"),s("br"),t._v("\n正向代理的用途："),s("br"),t._v("\n（1）访问原来无法访问的资源，如google"),s("br"),t._v("\n（2） 可以做缓存，加速访问资源"),s("br"),t._v("\n（3）对客户端访问授权，上网进行认证"),s("br"),t._v("\n（4）代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        proxy_pass http://"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_host")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"负载均衡"}},[t._v("负载均衡")]),t._v(" "),s("p",[t._v("使用集群是网站解决高并发、海量数据问题的常用手段。"),s("br"),t._v("\n当一台服务器的处理能力、存储空间不足时，不要企图去换更强大的服务器，对大型网站而言，不管多么强大的服务器，都满足不了网站持续增长的业务需求。"),s("br"),t._v("\n这种情况下，更恰当的做法是增加一台服务器分担原有服务器的访问及存储压力。通过负载均衡调度服务器，将来自浏览器的访问请求分发到应用服务器集群中的任何一台服务器上，如果有更多的用户，就在集群中加入更多的应用服务器，使应用服务器的负载压力不再成为整个网站的瓶颈。")]),t._v(" "),s("p",[t._v("upstream")]),t._v(" "),s("p",[t._v("nginx把请求转发到后台的一组upstream服务池"),s("br"),t._v("\nNginx可以配置代理多台服务器，当一台服务器宕机之后，仍能保持系统可用。")]),t._v(" "),s("ol",[s("li",[t._v("轮询(weight)")])]),t._v(" "),s("p",[t._v("指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。默认当weight不指定时，各服务器weight相同，每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("upstream bakend {\n    server 192.168.1.10 weight=1;\n    server 192.168.1.11 weight=2;\n}\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("ip_hash")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("种类")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("语法")]),t._v(" "),s("td",[t._v("upstream name {}")])]),t._v(" "),s("tr",[s("td",[t._v("默认")]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td",[t._v("上下文")]),t._v(" "),s("td",[t._v("http")])])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("upstream mamingjuan "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ip_hash"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server localhost:3000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server localhost:4000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server localhost:5000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        proxy_pass http://mamingjuan"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("后端服务器调试状态")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("状态")]),t._v(" "),s("th",[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("down")]),t._v(" "),s("td",[t._v("不参与负载均衡")])]),t._v(" "),s("tr",[s("td",[t._v("backup")]),t._v(" "),s("td",[t._v("备份的服务器")])]),t._v(" "),s("tr",[s("td",[t._v("max_fails")]),t._v(" "),s("td",[t._v("允许请求失败的次数")])]),t._v(" "),s("tr",[s("td",[t._v("fail_timeout")]),t._v(" "),s("td",[t._v("经过max_fails失败后，服务暂停的时间")])]),t._v(" "),s("tr",[s("td",[t._v("max_conns")]),t._v(" "),s("td",[t._v("限制最大的接收的连接数")])])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("upstream mamingjuan "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  server localhost:3000 down"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server localhost:4000 backup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server localhost:5000 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("max_fails")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("fail_timeout")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("10s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("分配方式")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("种类")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("轮询（默认）")]),t._v(" "),s("td",[t._v("每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。")])]),t._v(" "),s("tr",[s("td",[t._v("weight(加权轮询)")]),t._v(" "),s("td",[t._v("指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。")])]),t._v(" "),s("tr",[s("td",[t._v("ip_hash")]),t._v(" "),s("td",[t._v("每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。")])]),t._v(" "),s("tr",[s("td",[t._v("url_hash（第三方）")]),t._v(" "),s("td",[t._v("按访问的URL地址来分配 请求，每个URL都定向到同一个后端 服务器上(缓存)")])]),t._v(" "),s("tr",[s("td",[t._v("fair（第三方）")]),t._v(" "),s("td",[t._v("按后端服务器的响应时间来分配请求，响应时间短的优先分配。")])]),t._v(" "),s("tr",[s("td",[t._v("least_conn")]),t._v(" "),s("td",[t._v("最小连接数，哪个连接少就分给谁")])]),t._v(" "),s("tr",[s("td",[t._v("自定义hash")]),t._v(" "),s("td",[t._v("hash自定义key")])])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("upstream mamingjuan{\n  ip_hash;\n  server 127.0.0.1:3000;\n}\n\n\nupstream mamingjuan{\n  least_conn;\n  server 127.0.0.1:3000;\n}\n\n\nupstream mamingjuan{\n  url_hash;\n  server 127.0.0.1:3000;\n}\n\n\nupstream mamingjuan{\n  fair;\n  server 127.0.0.1:3000;\n}\n\n\nupstream mamingjuan{\n  hash $request_uri;\n  server 127.0.0.1:3000;\n}\n")])])]),s("h3",{attrs:{id:"缓存"}},[t._v("缓存")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://blog.csdn.net/dengjiexian123/article/details/53386586",target:"_blank",rel:"noopener noreferrer"}},[t._v("nginx代理缓存"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 缓存路径 目录层级 缓存空间名称和大小 失效时间为7天 最大容量为10g")]),t._v("\n    proxy_cache_path /data/nginx/cache "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("levels")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":2 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("keys_zone")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("cache:100m "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("inactive")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("60m "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("max_size")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("10g"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n")])])]),s("ul",[s("li",[t._v("proxy_cache_path 缓存文件路径")]),t._v(" "),s("li",[t._v("levels 设置缓存文件目录层次；levels=1:2 表示两级目录")]),t._v(" "),s("li",[t._v("keys_zone 设置缓存名字和共享内存大小")]),t._v(" "),s("li",[t._v("inactive 在指定时间内没人访问则被删除")]),t._v(" "),s("li",[t._v("max_size 最大缓存空间，如果缓存空间满，默认覆盖掉缓存时间最长的资源。")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),t._v(" ~ ^/cache/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("login"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("logout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nocache")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       proxy_pass http://mamingjuan"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    location ~ ^/cache/ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        proxy_cache cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        proxy_cache_valid  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("206")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("304")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("302")]),t._v(" 60m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对哪些状态码缓存，过期时间为60分钟")]),t._v("\n        proxy_cache_key "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 缓存的维度")]),t._v("\n        proxy_no_cache "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$nocache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        proxy_set_header Host "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$server_port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置头")]),t._v("\n        proxy_set_header X-Real-IP "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置头")]),t._v("\n        proxy_set_header   X-Forwarded-For "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置头")]),t._v("\n        proxy_pass http://127.0.0.1:6000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("proxy_cache tmp-test 使用名为tmp-test的对应缓存配置")]),t._v(" "),s("li",[t._v("proxy_cache_valid 200 206 304 301 302 10d; 对httpcode为200…的缓存10天")]),t._v(" "),s("li",[t._v("proxy_cache_key $uri 定义缓存唯一key,通过唯一key来进行hash存取")]),t._v(" "),s("li",[t._v("proxy_set_header 自定义http header头，用于发送给后端真实服务器。")]),t._v(" "),s("li",[t._v("proxy_pass 指代理后转发的路径，注意是否需要最后的/")])]),t._v(" "),s("h3",{attrs:{id:"rewrite"}},[t._v("rewrite")]),t._v(" "),s("p",[t._v("可以实现url重写及重定向。用途包括URL页面跳转、兼容旧版本、SEO优化(伪静态)、维护(后台维护、流量转发)、安全(伪静态)")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("语法\trewrite regex replacement [flag]\n默认\t-\n上下文\tserver,location,if\n")])])]),s("p",[t._v("解释：\nregex 正则表达式指的是要被改写的路径"),s("br"),t._v("\nreplacement 目标要替换成哪个URL"),s("br"),t._v("\nflag 标识")]),t._v(" "),s("p",[t._v("实战")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("rewrite ^(.*)$ /www/reparing.html break;\n")])])]),s("p",[t._v("正则表达式就不在细讲了与javascript正则内容差不多。")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("if"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_user_agent")]),t._v(" ~ MSIE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  rewrite ^"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(".*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ /msie/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("pcretest")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("wget https://ftp.pcre.org/pub/pcre/pcre-8.13.tar.gz\ntar -xzvf  pcre-8.13.tar.gz\ncd pcre-8.13\n./configure --enable-utf8  \nmake\nmake install\npcretest\n")])])]),s("p",[t._v("flag"),s("br"),t._v("\n标志位是标识规则对应的类型")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("flag")]),t._v(" "),s("th",[t._v("含义")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("last")]),t._v(" "),s("td",[t._v("先匹配自己的location,然后通过rewrite规则新建一个请求再次请求服务端")])]),t._v(" "),s("tr",[s("td",[t._v("break")]),t._v(" "),s("td",[t._v("先匹配自己的location,然后生命周期会在当前的location结束,不再进行后续的匹配")])]),t._v(" "),s("tr",[s("td",[t._v("redirect")]),t._v(" "),s("td",[t._v("返回302昨时重定向,以后还会请求这个服务器")])]),t._v(" "),s("tr",[s("td",[t._v("permanent")]),t._v(" "),s("td",[t._v("返回301永久重定向,以后会直接请求永久重定向后的域名")])])])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("location ~ ^/break "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     rewrite ^/break /test "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     proxy_pass http://127.0.0.1:3000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nlocation ~ ^/last "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      rewrite ^/last /test last"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nlocation /test "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      default_type application/json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"code":0,"msg":"success"}\'')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-vL")]),t._v(" http://192.168.20.150/redirect\n\nlocation ~ ^/redirect "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n rewrite ^/redirect http://www.baidu.com redirect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n rewrite ^/redirect http://www.baidu.com permanent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("rewrite优先级")]),t._v(" "),s("ul",[s("li",[t._v("先执行server中的rewrite指令")]),t._v(" "),s("li",[t._v("执行location匹配")]),t._v(" "),s("li",[t._v("再执行location中的rewrite")])]),t._v(" "),s("p",[t._v("location中的优先级")]),t._v(" "),s("ul",[s("li",[t._v("等号类型（=）的优先级最高。一旦匹配成功，则不再查找其他匹配项。")]),t._v(" "),s("li",[t._v("^~类型表达式。一旦匹配成功，则不再查找其他匹配项。")]),t._v(" "),s("li",[t._v("正则表达式类型（~ ~*）的优先级次之。如果有多个location的正则能匹配的话，则使用正则表达式最长的那个。")]),t._v(" "),s("li",[t._v("常规字符串匹配类型按前缀匹配")])])])}),[],!1,null,null,null);s.default=e.exports}}]);