(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{364:function(t,n,a){"use strict";a.r(n);var s=a(2),e=Object(s.a)({},(function(){var t=this,n=t._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"微前端调研"}},[t._v("微前端调研")]),t._v(" "),n("p",[t._v("主流框架：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("qiankun（乾坤）\nqiankun 是蚂蚁金融科技基于微前端架构的云产品统一接入平台，基于 single-spa 的微前端实现库，旨在帮助大家能更简单、无痛的构建一个生产可用微前端架构系统。")])]),t._v(" "),n("li",[n("p",[t._v("micro-app\nmicro-app是由京东前端团队推出的一款微前端框架，它借鉴了WebComponent的思想，通过js沙箱、样式隔离、元素隔离、路由隔离模拟实现了ShadowDom的隔离特性，并结合CustomElement将微前端封装成一个类WebComponent组件，从而实现微前端的组件化渲染，旨在降低上手难度、提升工作效率。和技术栈无关，也不和业务绑定，可以用于任何前端框架。")])]),t._v(" "),n("li",[n("p",[t._v("wujie（无界）\n无界微前端解决方案源于腾讯的低代码平台，是一款基于 Web Components + iframe 微前端框架，具备成本低、速度快、原生隔离、功能强等一系列优点。")])])]),t._v(" "),n("h4",{attrs:{id:"iframe方案"}},[t._v("iframe方案")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("特点\n接入比较简单\n隔离非常稳完美\n\n不足\ndom割裂感严重，弹框只能在iframe，而且有滚动条\n通讯非常麻烦，而且刷新iframe url状态丢失\n前进后退按钮无效\n")])])]),n("h4",{attrs:{id:"qiankun方案"}},[t._v("qiankun方案")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("特点\nhtml entry 的方式引入子应用，相比 js entry 极大的降低了应用改造的成本；\n完备的沙箱方案，js 沙箱做了 SnapshotSandbox、LegacySandbox、ProxySandbox 三套渐进增强方案，css 沙箱做了 strictStyleIsolation、experimentalStyleIsolation 两套适用不同场景的方案；\n做了静态资源预加载能力；\n\n不足\n适配成本比较高，工程化、生命周期、静态资源路径、路由等都要做一系列的适配工作；\ncss 沙箱采用严格隔离会有各种问题，js 沙箱在某些场景下执行性能下降严重；\n无法同时激活多个子应用，也不支持子应用保活；\n无法支持 vite 等 esmodule 脚本运行；\n")])])]),n("p",[t._v("底层原理 js沙箱使用的是proxy进行快照然后用用 with(window){} 包裹起来 with内的window其实就是proxy.window 我们声明变量 var name = '小满' 实际这个变量挂到了proxy.window 并不是真正的window css沙箱原理 第一个就是shadowDom隔离 第二个类似于Vue的scoped。")]),t._v(" "),n("p",[t._v("qiankun中js 沙箱做了 SnapshotSandbox、LegacySandbox、ProxySandbox 三套渐进增强方案的处理方式，")]),t._v(" "),n("ol",[n("li",[t._v("把主应用的 window 对象做浅拷贝，将 window 的键值对存成一个 Hash Map。之后无论微应用对 window 做任何改动，当要在恢复环境时，把这个 Hash Map 又应用到 window 上就可以了。")]),t._v(" "),n("li",[t._v("LegacySandbox 沙箱与 SnapshotSanbox沙箱实现思路差不多，都是通过记录新增或改变的属性，从而实现对环境的还原和隔离。但是LegacySandbox与SnapshotSanbox的对比方式略有不同，LegacySandbox使用es6的Proxy创建一个window的proxy对象，所有调用window.xxx的操作，都代理到proxy上，并且在这上面进行一系列记录属性变更的操作，这也是LegacySandbox比SnapshotSanbox性能高的原因。不支持多实例，在同一个页面，同时激活多个子应用可能会有异常。因为无法监听对window的更改，是哪一个子应用进行的，所以异常会难以排查。")]),t._v(" "),n("li",[t._v("ProxySanbox沙箱，会把当前 window 的一些原生属性（如document, location等）拷贝出来，单独放在一个对象上，这个对象也称为fakeWindow，它会为每个子应用分配一个fakeWidnow。支持多实例，在同一个页面，可以同时激活多个子应用。每个子应用使用独立的fakewindow。")])]),t._v(" "),n("ul",[n("li",[t._v("将主应用中的window原生属性进行浅拷贝，放在一个对象（fakeWindow）上")]),t._v(" "),n("li",[t._v("为每一个子应用分配一个fakeWindow，作为子应用的window")]),t._v(" "),n("li",[t._v("子应用访问和改写window对象属性时，都会被拦截")]),t._v(" "),n("li",[t._v("当子应用中新增\\改写window上的属性时：如果改变的是原生属性(location、document等)，则修改window，如果不是，则修改fakewindow")]),t._v(" "),n("li",[t._v("当子应用读取window上的属性时：如果读取的时原生属性(location,document等),则读取window,如果不是，则访问fakewindow上的属性")])]),t._v(" "),n("h4",{attrs:{id:"micro-app-方案"}},[t._v("micro-app 方案")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("特点\n使用 webcomponet 加载子应用相比 single-spa 这种注册监听方案更加优雅；\n复用经过大量项目验证过 qiankun 的沙箱机制也使得框架更加可靠；\n组件式的 api 更加符合使用习惯，支持子应用保活；\n降低子应用改造的成本，提供静态资源预加载能力；\n\n不足\n接入成本较 qiankun 有所降低，但是路由依然存在依赖； （虚拟路由已解决）\n多应用激活后无法保持各子应用的路由状态，刷新后全部丢失； （虚拟路由已解决）\ncss 沙箱依然无法绝对的隔离，js 沙箱做全局变量查找缓存，性能有所优化；\n支持 vite 运行，但必须使用 plugin 改造子应用，且 js 代码没办法做沙箱隔离；\n对于不支持 webcompnent 的浏览器没有做降级处理；\n")])])]),n("p",[t._v("底层原理 js隔离跟qiankun类似也是使用proxy + with，css隔离自定义前缀类似于scoped")]),t._v(" "),n("h4",{attrs:{id:"emp-方案"}},[t._v("EMP 方案")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("特点\nwebpack 联邦编译可以保证所有子应用依赖解耦；\n应用间去中心化的调用、共享模块；\n模块远程 ts 支持；\n\n不足\n对 webpack 强依赖，老旧项目不友好；\n没有有效的 css 沙箱和 js 沙箱，需要靠用户自觉；\n子应用保活、多应用激活无法实现；\n主、子应用的路由可能发生冲突；\n")])])]),n("p",[t._v("底层原理 这个东西有点类似于拆包，也可以叫模块共享，例如React有个模块可以共享给Vue项目用Vue2的组件可以共享给Vue3用。")]),t._v(" "),n("h4",{attrs:{id:"无界-方案"}},[t._v("无界 方案")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("特点\n接入简单只需要四五行代码\n不需要针对vite额外处理\n预加载\n应用保活机制\n\n不足\n隔离js使用一个空的iframe进行隔离\n子应用axios需要自行适配\niframe沙箱的src设置了主应用的host，初始化iframe的时候需要等待iframe的location.orign从'about:blank'初始化为主应用的host，这个采用的计时器去等待的不是很优雅。\n")])])]),n("p",[t._v("底层原理 使用shadowDom 隔离css，js使用空的iframe隔离，通讯使用的是proxy")]),t._v(" "),n("h3",{attrs:{id:"虚拟路由"}},[t._v("虚拟路由")]),t._v(" "),n("p",[t._v("虚拟路由系统与浏览器的路由行为一致，它通过自定义 location 和 history 等核心路由 API，重写了 popState 和 hashChange 事件，拦截路由导航和事件，并提供了一系列自定义 API，模拟了在浏览器环境下的 Web 应用程序的渲染、跳转和返回等路由行为。子应用程序在这个虚拟路由系统中运行，与基座应用程序的路由相互隔离，从而避免相互影响，并增强了子应用程序与基座应用程序之间的交互能力。通过虚拟路由系统，基座应用程序可以方便地获取子应用程序的路由信息并控制子应用程序的跳转，子应用程序的路由信息会作为参数同步到浏览器地址上。此外，虚拟路由系统还提供了许多功能，帮助开发人员提高工作效率。")]),t._v(" "),n("h3",{attrs:{id:"web-components"}},[t._v("web components")]),t._v(" "),n("p",[t._v("web components 生命周期\nWeb组件的生命周期可以概括为：创建、使用、销毁。")]),t._v(" "),n("ol",[n("li",[t._v("创建：")])]),t._v(" "),n("p",[t._v("constructor()： 创建组件实例时调用，可以用来设置默认属性、创建Shadow DOM等。")]),t._v(" "),n("p",[t._v("connectedCallback()： 组件被添加到DOM时调用。")]),t._v(" "),n("p",[t._v("adoptedCallback()： 组件从一个文档转移到另一个文档时调用。")]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[t._v("使用：")])]),t._v(" "),n("p",[t._v("属性变化的响应函数： 当自定义组件的属性发生变化时，会调用attributeChangedCallback(name, oldValue, newValue)。")]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[t._v("销毁：")])]),t._v(" "),n("p",[t._v("disconnectedCallback()： 组件从DOM中移除时调用。")]),t._v(" "),n("p",[t._v("以下是一个简单的Web组件示例，演示了这些生命周期钩子的使用：")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyElement")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HTMLElement")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建时的设置")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("attachShadow")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("mode")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'open'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n \n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connectedCallback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当组件被添加到页面时的操作")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shadowRoot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("textContent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Web Component is connected!'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n \n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("disconnectedCallback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当组件被移除时的操作")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shadowRoot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("textContent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Web Component is disconnected!'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n \n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("attributeChangedCallback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldValue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newValue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当组件的属性发生变化时的操作")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shadowRoot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("textContent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("Attribute ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v(" changed from ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("oldValue"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v(" to ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("newValue"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n \n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("observedAttributes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回需要观察的属性数组")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'my-attribute'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义一个新的自定义元素")]),t._v("\ncustomElements"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("define")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'my-element'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" MyElement"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("my-element")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("my-attribute")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("initial"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("my-element")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n")])])]),n("p",[t._v('当这个元素被添加到页面时，connectedCallback会被调用，显示"Web Component is connected!"。')]),t._v(" "),n("p",[t._v("当属性my-attribute变化时，attributeChangedCallback会被调用，显示新的属性值。")]),t._v(" "),n("p",[t._v('当元素从DOM中移除时，disconnectedCallback会被调用，显示"Web Component is disconnected!"。')])])}),[],!1,null,null,null);n.default=e.exports}}]);